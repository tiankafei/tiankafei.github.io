(window.webpackJsonp=window.webpackJsonp||[]).push([[109],{463:function(a,s,e){"use strict";e.r(s);var t=e(42),r=Object(t.a)({},(function(){var a=this,s=a.$createElement,e=a._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[e("h1",{attrs:{id:"elasticsearch学习笔记"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#elasticsearch学习笔记"}},[a._v("#")]),a._v(" Elasticsearch学习笔记")]),a._v(" "),e("h2",{attrs:{id:"帮助文档"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#帮助文档"}},[a._v("#")]),a._v(" 帮助文档")]),a._v(" "),e("h3",{attrs:{id:"中文官方文档-较老"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#中文官方文档-较老"}},[a._v("#")]),a._v(" 中文官方文档（较老）")]),a._v(" "),e("div",{staticClass:"language-http extra-class"},[e("pre",{pre:!0,attrs:{class:"language-http"}},[e("code",[e("span",{pre:!0,attrs:{class:"token header-name keyword"}},[a._v("https:")]),a._v("//www.elastic.co/guide/cn/elasticsearch/guide/current/getting-started.html#getting-started\n")])])]),e("h3",{attrs:{id:"英文最新文档-较新"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#英文最新文档-较新"}},[a._v("#")]),a._v(" 英文最新文档（较新）")]),a._v(" "),e("div",{staticClass:"language-http extra-class"},[e("pre",{pre:!0,attrs:{class:"language-http"}},[e("code",[e("span",{pre:!0,attrs:{class:"token header-name keyword"}},[a._v("https:")]),a._v("//www.elastic.co/guide/en/elasticsearch/reference/7.10/getting-started.html\n")])])]),e("h2",{attrs:{id:"es核心概念和原理"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#es核心概念和原理"}},[a._v("#")]),a._v(" ES核心概念和原理")]),a._v(" "),e("h3",{attrs:{id:"什么是搜索"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#什么是搜索"}},[a._v("#")]),a._v(" 什么是搜索")]),a._v(" "),e("p",[a._v("百度、垂直搜索（站内搜索）。搜索：通过一个"),e("strong",[a._v("关键词")]),a._v("或一段描述，得到你想要（相关度高）的结果")]),a._v(" "),e("h3",{attrs:{id:"如何实现搜索功能"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#如何实现搜索功能"}},[a._v("#")]),a._v(" 如何实现搜索功能")]),a._v(" "),e("p",[a._v("关系型数据库：性能差、不可靠、结果不准确（相关度低）")]),a._v(" "),e("h3",{attrs:{id:"倒排索引、lucene和全文检索"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#倒排索引、lucene和全文检索"}},[a._v("#")]),a._v(" 倒排索引、"),e("code",[a._v("Lucene")]),a._v("和全文检索")]),a._v(" "),e("ol",[e("li",[a._v("倒排索引的数据结构（存储的数据）\n"),e("ol",[e("li",[a._v("包含这个关键词的"),e("code",[a._v("document list")])]),a._v(" "),e("li",[a._v("关键词在每个doc中出现的次数"),e("code",[a._v("TF term frequency")])]),a._v(" "),e("li",[a._v("关键词在整个索引中出现的次数"),e("code",[a._v("IDF inverse doc frequency")]),a._v("（值越大，代表相关度越低）")]),a._v(" "),e("li",[a._v("关键词在当前"),e("code",[a._v("doc")]),a._v("中出现的次数")]),a._v(" "),e("li",[a._v("每个"),e("code",[a._v("doc")]),a._v("的长度，越长相关度越低")]),a._v(" "),e("li",[a._v("包含这个关键词的所有"),e("code",[a._v("doc")]),a._v("的平均长度")])])]),a._v(" "),e("li",[e("code",[a._v("Lucene")]),a._v("："),e("code",[a._v("jar")]),a._v("包，帮我们创建倒排索引，提供了复杂的"),e("code",[a._v("API")])]),a._v(" "),e("li",[a._v("如果用"),e("code",[a._v("Luncene")]),a._v("做集群，会有哪些问题\n"),e("ul",[e("li",[a._v("节点一旦宕机，节点数据丢失，后果不堪设想，可用性差")]),a._v(" "),e("li",[a._v("自己维护，麻烦（自己创建管理索引），单台节点的承载请求的能里是有限的，需要人工做负载。")])])])]),a._v(" "),e("p",[e("img",{attrs:{src:"/images/%E5%80%92%E6%8E%92%E7%B4%A2%E5%BC%95.png",alt:"倒排索引"}})]),a._v(" "),e("h3",{attrs:{id:"倒排索引的特点"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#倒排索引的特点"}},[a._v("#")]),a._v(" 倒排索引的特点")]),a._v(" "),e("ol",[e("li",[a._v("倒排索引的数据量 > 原始数据量")]),a._v(" "),e("li",[a._v("倒排索引做的是完全匹配，不需要全表扫描")]),a._v(" "),e("li",[a._v("倒排索引记录着这个词出现在原始数据的那个主键，根据主键去原始数据中查询是很快的")])]),a._v(" "),e("h3",{attrs:{id:"elasticsearch"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#elasticsearch"}},[a._v("#")]),a._v(" Elasticsearch")]),a._v(" "),e("ol",[e("li",[a._v("特点\n"),e("ul",[e("li",[a._v("分布式")]),a._v(" "),e("li",[a._v("高性能")]),a._v(" "),e("li",[a._v("高可用")]),a._v(" "),e("li",[a._v("可伸缩")]),a._v(" "),e("li",[a._v("易维护")])])]),a._v(" "),e("li",[a._v("优点\n"),e("ul",[e("li",[a._v("面向开发者友好，屏蔽了Lucene的复杂特性，集群自动发现（cluster discovery）")]),a._v(" "),e("li",[a._v("自动维护数据在多个节点上的建立")]),a._v(" "),e("li",[a._v("会帮我们做搜索请求的负载均衡")]),a._v(" "),e("li",[a._v("自动维护冗余副本，保证了部分节点宕机的情况下仍然不会有任何数据丢失")]),a._v(" "),e("li",[e("code",[a._v("ES")]),a._v("基于"),e("code",[a._v("Lucene")]),a._v("提供了很多高级功能：复合查询、聚合分析、基于地理位置等")]),a._v(" "),e("li",[a._v("对于大公司，可以构建几百台服务器的大型分布式集群，处理PB级别数据；对于小公司，开箱即用，门槛低上手简单")]),a._v(" "),e("li",[a._v("相比传统数据库，提供了全文检索，同义词处理（美丽的 cls > 漂亮的 cls），相关度排名。聚合分析以及海量数据的近实时（NTR）处理，这些传统数据库完全做不到")])])]),a._v(" "),e("li",[a._v("应用领域\n"),e("ul",[e("li",[a._v("百度（全文检索，高亮、搜索推荐）")]),a._v(" "),e("li",[a._v("各大网站的用户行为日志（用户点击、浏览、收藏、评论）")]),a._v(" "),e("li",[a._v("BI（business Intelligence商业智能），数据分析，数据挖掘统计")]),a._v(" "),e("li",[a._v("Github：代码托管平台，几千亿行代码")]),a._v(" "),e("li",[a._v("ELK：Elasticsearch（数据存储）、Logstash（日志采集）、Kibana（可视化）")])])])]),a._v(" "),e("h3",{attrs:{id:"es-核心概念"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#es-核心概念"}},[a._v("#")]),a._v(" ES 核心概念")]),a._v(" "),e("ol",[e("li",[e("code",[a._v("cluster")]),a._v("（集群）：每个集群至少包含两个节点")]),a._v(" "),e("li",[e("code",[a._v("node")]),a._v("：集群中的每个节点，一个节点不代表一台服务器")]),a._v(" "),e("li",[e("code",[a._v("field")]),a._v("：一个数据字段，与"),e("code",[a._v("index")]),a._v("和"),e("code",[a._v("type")]),a._v("一起，可以定位一个"),e("code",[a._v("doc")])]),a._v(" "),e("li",[e("code",[a._v("document")]),a._v("："),e("code",[a._v("es")]),a._v("最小的数据单元，通常是以"),e("code",[a._v("json")]),a._v("的形式存储的")]),a._v(" "),e("li",[e("code",[a._v("type")]),a._v("：逻辑上的数据分类，"),e("code",[a._v("es7.x")]),a._v("中删除了"),e("code",[a._v("type")]),a._v("的概念")]),a._v(" "),e("li",[e("code",[a._v("index")]),a._v("：一类相同或者类似的"),e("code",[a._v("doc")]),a._v("，比如一个员工索引，商品索引")]),a._v(" "),e("li",[e("code",[a._v("shard")]),a._v("分片：P分片，R副本\n"),e("ul",[e("li",[a._v("一个"),e("code",[a._v("index")]),a._v("包含多个"),e("code",[a._v("shard")]),a._v("，默认5个分片，默认每个分片分配一个副本，分片的数量在创建索引的时候设置，如果想修改，需要重建索引")]),a._v(" "),e("li",[a._v("每个"),e("code",[a._v("shard")]),a._v("都是一个"),e("code",[a._v("lucene")]),a._v("实例，有完整的创建索引的处理请求能力")]),a._v(" "),e("li",[a._v("es会自动在"),e("code",[a._v("nodes")]),a._v("上为我们做"),e("code",[a._v("shard")]),a._v("均衡")]),a._v(" "),e("li",[a._v("一个"),e("code",[a._v("doc")]),a._v("是不可能同时存在与多个分片中的，但是可以存在于多个副本中")]),a._v(" "),e("li",[a._v("分片和对应的副本不能同时存在于同一个节点，所以最低的可用配置是两个节点，互为主备")])])])]),a._v(" "),e("h2",{attrs:{id:"环境安装"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#环境安装"}},[a._v("#")]),a._v(" 环境安装")]),a._v(" "),e("h3",{attrs:{id:"docker-安装配置-es"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#docker-安装配置-es"}},[a._v("#")]),a._v(" docker 安装配置 es")]),a._v(" "),e("h4",{attrs:{id:"拉取镜像"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#拉取镜像"}},[a._v("#")]),a._v(" 拉取镜像")]),a._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[a._v("docker pull elasticsearch:7.6.2\n")])])]),e("h4",{attrs:{id:"启动es"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#启动es"}},[a._v("#")]),a._v(" 启动es")]),a._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[a._v("docker run -d -p "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("9200")]),a._v(":9200 -p "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("9300")]),a._v(":9300 --restart"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("always -e "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"discovery.type=single-node"')]),a._v(" --name"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("elasticsearch elasticsearch:7.6.2\n")])])]),e("h4",{attrs:{id:"修改配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#修改配置"}},[a._v("#")]),a._v(" 修改配置")]),a._v(" "),e("ol",[e("li",[e("p",[a._v("进入容器")]),a._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[a._v("docker "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("exec")]),a._v(" -it elasticsearch "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("bash")]),a._v("\n")])])])]),a._v(" "),e("li",[e("p",[a._v("vi config/elasticsearch.yml")]),a._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[a._v("cluster.name: "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"my-application"')]),a._v("\nnode.name: "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"node-1"')]),a._v("\nnetwork.host: "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("0.0")]),a._v(".0.0\n")])])])]),a._v(" "),e("li",[e("p",[a._v("重启容器")]),a._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[a._v("docker restart elasticsearch\n")])])])])]),a._v(" "),e("h4",{attrs:{id:"访问地址"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#访问地址"}},[a._v("#")]),a._v(" 访问地址")]),a._v(" "),e("div",{staticClass:"language-http extra-class"},[e("pre",{pre:!0,attrs:{class:"language-http"}},[e("code",[e("span",{pre:!0,attrs:{class:"token header-name keyword"}},[a._v("http:")]),a._v("//<IP>:<PORT>\n"),e("span",{pre:!0,attrs:{class:"token header-name keyword"}},[a._v("http:")]),a._v("//192.168.21.123:9200/\n")])])]),e("h3",{attrs:{id:"docker-安装配置-kibana"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#docker-安装配置-kibana"}},[a._v("#")]),a._v(" docker 安装配置 kibana")]),a._v(" "),e("h4",{attrs:{id:"拉取镜像-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#拉取镜像-2"}},[a._v("#")]),a._v(" 拉取镜像")]),a._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[a._v("docker pull kibana:7.6.2\n")])])]),e("h4",{attrs:{id:"启动kibana"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#启动kibana"}},[a._v("#")]),a._v(" 启动kibana")]),a._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[a._v("docker run -d -p "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("5601")]),a._v(":5601 --restart"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("always --name kibana kibana:7.6.2\n")])])]),e("h4",{attrs:{id:"出现的问题修改配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#出现的问题修改配置"}},[a._v("#")]),a._v(" 出现的问题修改配置")]),a._v(" "),e("ol",[e("li",[e("p",[a._v("如果出现以下页面：Kibana server is not ready yet，说明Kibana没有找到ES节点")])]),a._v(" "),e("li",[e("p",[a._v("进入容器")]),a._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[a._v("docker "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("exec")]),a._v(" -it kibana "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("bash")]),a._v("\n")])])])]),a._v(" "),e("li",[e("p",[a._v("vi config/kibana.yml")]),a._v(" "),e("div",{staticClass:"language-yaml extra-class"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# ** THIS IS AN AUTO-GENERATED FILE **")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#")]),a._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Default Kibana configuration for docker target")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("server.name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" kibana\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("server.host")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"0"')]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("elasticsearch.hosts")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"http://192.168.21.123:9200"')]),a._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("xpack.monitoring.ui.container.elasticsearch.enabled")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[a._v("true")]),a._v("\n")])])])]),a._v(" "),e("li",[e("p",[a._v("重启容器")]),a._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[a._v("docker restart kibana\n")])])])])]),a._v(" "),e("h4",{attrs:{id:"访问地址-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#访问地址-2"}},[a._v("#")]),a._v(" 访问地址")]),a._v(" "),e("div",{staticClass:"language-http extra-class"},[e("pre",{pre:!0,attrs:{class:"language-http"}},[e("code",[e("span",{pre:!0,attrs:{class:"token header-name keyword"}},[a._v("http:")]),a._v("//<IP>:<PORT>\n"),e("span",{pre:!0,attrs:{class:"token header-name keyword"}},[a._v("http:")]),a._v("//192.168.21.123:5601/\n")])])])])}),[],!1,null,null,null);s.default=r.exports}}]);