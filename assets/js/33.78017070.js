(window.webpackJsonp=window.webpackJsonp||[]).push([[33],{379:function(a,t,s){"use strict";s.r(t);var n=s(42),e=Object(n.a)({},(function(){var a=this,t=a.$createElement,s=a._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"jvm入门到精通"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#jvm入门到精通"}},[a._v("#")]),a._v(" JVM入门到精通")]),a._v(" "),s("h2",{attrs:{id:"虚拟机基础概念"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#虚拟机基础概念"}},[a._v("#")]),a._v(" 虚拟机基础概念")]),a._v(" "),s("h3",{attrs:{id:"java-从编码到执行"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#java-从编码到执行"}},[a._v("#")]),a._v(" Java 从编码到执行")]),a._v(" "),s("p",[s("img",{attrs:{src:"/images/java%E4%BB%8E%E7%BC%96%E7%A0%81%E5%88%B0%E6%89%A7%E8%A1%8C.png",alt:"java从编码到执行"}})]),a._v(" "),s("h3",{attrs:{id:"jvm跨平台"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#jvm跨平台"}},[a._v("#")]),a._v(" JVM跨平台")]),a._v(" "),s("blockquote",[s("p",[a._v("JVM跟Java无关，关键的原因就是class，任何语言只要能编译成class，符合class文件的规范，就可以在JVM虚拟机上执行。")])]),a._v(" "),s("p",[s("img",{attrs:{src:"/images/JVM%E8%B7%A8%E5%B9%B3%E5%8F%B0.png",alt:"JVM跨平台"}})]),a._v(" "),s("h3",{attrs:{id:"jvm是一种规范"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#jvm是一种规范"}},[a._v("#")]),a._v(" JVM是一种规范")]),a._v(" "),s("blockquote",[s("p",[a._v("是一台虚拟的计算机")])]),a._v(" "),s("h3",{attrs:{id:"javac的过程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#javac的过程"}},[a._v("#")]),a._v(" Javac的过程")]),a._v(" "),s("blockquote",[s("p",[a._v("编译原理：")]),a._v(" "),s("p",[a._v("源码 -> 词法分析器 -> token流 -> 语法分析器 -> 抽象语法树 -> ByteCode -> 字节码生成器 -> 注解抽象语法树 -> 语义分析器")])]),a._v(" "),s("h3",{attrs:{id:"常见的jvm实现"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#常见的jvm实现"}},[a._v("#")]),a._v(" 常见的JVM实现")]),a._v(" "),s("blockquote",[s("p",[a._v("Hotspot：oracle官方")]),a._v(" "),s("p",[a._v("TaobaoVM：hostpot深度定制版")]),a._v(" "),s("p",[a._v("Jrockit：BEA，曾经号称世界上最快的JVM，被oracle收购，合并与Hotspot")]),a._v(" "),s("p",[a._v("LiquidVM：直接针对硬件（底层没有操作系统）")]),a._v(" "),s("p",[a._v("J9 -IBM")]),a._v(" "),s("p",[a._v("azul zing：最新垃圾回收的业界标杆")]),a._v(" "),s("blockquote",[s("p",[a._v("垃圾回收号称1ms实现，Hotspot吸收了其优点，升级到后来的ZGC")])]),a._v(" "),s("p",[a._v("Microsoft VM")])]),a._v(" "),s("h3",{attrs:{id:"jdk-jre-jvm的区别"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#jdk-jre-jvm的区别"}},[a._v("#")]),a._v(" JDK JRE JVM的区别")]),a._v(" "),s("p",[s("img",{attrs:{src:"/images/JDK-JRE-JVM.png",alt:"JDK-JRE-JVM"}})]),a._v(" "),s("h2",{attrs:{id:"class文件结构"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#class文件结构"}},[a._v("#")]),a._v(" class文件结构")]),a._v(" "),s("h3",{attrs:{id:"class文件二进制文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#class文件二进制文件"}},[a._v("#")]),a._v(" class文件二进制文件")]),a._v(" "),s("p",[s("img",{attrs:{src:"/images/class%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%96%87%E4%BB%B6%E7%A4%BA%E4%BE%8B.png",alt:"class二进制文件示例"}})]),a._v(" "),s("h3",{attrs:{id:"class文件解析"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#class文件解析"}},[a._v("#")]),a._v(" class文件解析")]),a._v(" "),s("p",[s("img",{attrs:{src:"/images/class%E6%96%87%E4%BB%B6%E8%A7%A3%E6%9E%90.png",alt:"class文件解析"}})]),a._v(" "),s("h3",{attrs:{id:"class文件查看方法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#class文件查看方法"}},[a._v("#")]),a._v(" class文件查看方法")]),a._v(" "),s("ul",[s("li",[a._v("javap -v class文件名")]),a._v(" "),s("li",[a._v("JBE（可以直接修改）")]),a._v(" "),s("li",[a._v("JClassLib（IDEA插件之一）")])]),a._v(" "),s("h3",{attrs:{id:"class文件结构-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#class文件结构-2"}},[a._v("#")]),a._v(" class文件结构")]),a._v(" "),s("p",[s("img",{attrs:{src:"/images/java1.8%E7%B1%BB%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F%E7%AC%AC%E4%B8%80%E7%89%88.png",alt:"java1.8类文件格式第一版"}})]),a._v(" "),s("h2",{attrs:{id:"class文件内存加载过程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#class文件内存加载过程"}},[a._v("#")]),a._v(" class文件内存加载过程")]),a._v(" "),s("p",[s("img",{attrs:{src:"/images/class%E6%96%87%E4%BB%B6%E5%8A%A0%E8%BD%BD%E5%88%B0%E5%86%85%E5%AD%98.png",alt:"class文件加载到内存"}})]),a._v(" "),s("ol",[s("li",[a._v("loading:class文件被加载到内存")]),a._v(" "),s("li",[a._v("linking:\n"),s("ol",[s("li",[a._v("verification:校验加载进来的class是否符合标准(前面四个字节是“cafe babe”等)")]),a._v(" "),s("li",[a._v("preparation:class静态变量赋默认值(数值型默认值为0)")]),a._v(" "),s("li",[a._v("resolution:class文件的常量池用到的那些符号引用转换为直接的内存地址，可以直接访问到")])])]),a._v(" "),s("li",[a._v("initializing:静态变量赋值为初始值\n"),s("ul",[s("li",[a._v("JVM规范并没有规定何时加载。Hotspot默认懒加载")]),a._v(" "),s("li",[a._v("但是严格规定了什么时候必须初始化\n"),s("ol",[s("li",[a._v("new getstatic putstatic invokestatic指定，访问final变量除外")]),a._v(" "),s("li",[a._v("java.lang.reflect对类进行反射调用时")]),a._v(" "),s("li",[a._v("初始化子类的时候，父类首先初始化")]),a._v(" "),s("li",[a._v("虚拟机启动时，被执行的主类必须初始化")]),a._v(" "),s("li",[a._v("动态语言支持java.lang.invoke.MethodHandle解析的结果为REF_getstatic REF_putstatic REF_invokestatic的方法句柄时，该类必须初始化")])])])])])]),a._v(" "),s("h3",{attrs:{id:"loading"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#loading"}},[a._v("#")]),a._v(" loading")]),a._v(" "),s("blockquote",[s("p",[a._v("JVM中的所有的calss都是被类加载器加载到内存的（ClassLoader）")])]),a._v(" "),s("p",[s("img",{attrs:{src:"/images/%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8.png",alt:"类加载器"}})]),a._v(" "),s("h4",{attrs:{id:"类加载过程-双亲委派"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#类加载过程-双亲委派"}},[a._v("#")]),a._v(" 类加载过程:双亲委派")]),a._v(" "),s("p",[s("img",{attrs:{src:"/images/%E7%B1%BB%E5%8A%A0%E8%BD%BD%E8%BF%87%E7%A8%8B.png",alt:"类加载过程"}})]),a._v(" "),s("h4",{attrs:{id:"为什么要双亲委派"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#为什么要双亲委派"}},[a._v("#")]),a._v(" 为什么要双亲委派")]),a._v(" "),s("ol",[s("li",[a._v("主要是为了安全:自己定义一个java.lang.String类")]),a._v(" "),s("li",[a._v("一个类只加载一次，减少资源浪费")])]),a._v(" "),s("h4",{attrs:{id:"如何打破双亲委派"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#如何打破双亲委派"}},[a._v("#")]),a._v(" 如何打破双亲委派")]),a._v(" "),s("ol",[s("li",[a._v("重写loadClass()方法")])]),a._v(" "),s("h4",{attrs:{id:"何时打破过双亲委派"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#何时打破过双亲委派"}},[a._v("#")]),a._v(" 何时打破过双亲委派")]),a._v(" "),s("ol",[s("li",[a._v("JDK1.2之前，自定义ClassLoader都必须重写loadClass()方法")]),a._v(" "),s("li",[a._v("ThreadContextClassLoader可以实现基础类调用实现类代码，通过thread.setContextClassLoader指定")]),a._v(" "),s("li",[a._v("热启动，热部署\n"),s("ul",[s("li",[a._v("osgi tomcat都有自己的模块指定ClassLoader（可以加载同一类库的不同版本）")])])])]),a._v(" "),s("h4",{attrs:{id:"自定义类加载器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#自定义类加载器"}},[a._v("#")]),a._v(" 自定义类加载器")]),a._v(" "),s("ol",[s("li",[a._v("继承ClassLoader")]),a._v(" "),s("li",[a._v("重写模板方法findClass，调用defineClass")]),a._v(" "),s("li",[a._v("自定义类加载器加载自加密的class\n"),s("ol",[s("li",[a._v("防止反编译")]),a._v(" "),s("li",[a._v("防止篡改")])])])]),a._v(" "),s("h4",{attrs:{id:"classloader源码解析"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#classloader源码解析"}},[a._v("#")]),a._v(" ClassLoader源码解析")]),a._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("protected")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Class")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("?")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("loadClass")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("String")]),a._v(" name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("boolean")]),a._v(" resolve"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("throws")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ClassNotFoundException")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("synchronized")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("getClassLoadingLock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// First, check if the class has already been loaded")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Class")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("?")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v(" c "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("findLoadedClass")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("c "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("==")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("long")]),a._v(" t0 "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("System")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("nanoTime")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("try")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n                "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("parent "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("!=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n                    c "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" parent"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("loadClass")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("false")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n                "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("else")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n                    c "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("findBootstrapClassOrNull")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n                "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("catch")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ClassNotFoundException")]),a._v(" e"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// ClassNotFoundException thrown if class not found")]),a._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// from the non-null parent class loader")]),a._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("c "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("==")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// If still not found, then invoke findClass in order")]),a._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// to find the class.")]),a._v("\n                "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("long")]),a._v(" t1 "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("System")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("nanoTime")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n                c "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("findClass")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// this is the defining class loader; record the stats")]),a._v("\n                "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("PerfCounter")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("getParentDelegationTime")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("addTime")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("t1 "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v(" t0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n                "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("PerfCounter")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("getFindClassTime")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("addElapsedTimeFrom")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("t1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n                "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("PerfCounter")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("getFindClasses")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("increment")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("resolve"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n            "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("resolveClass")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("c"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v(" c"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v('/**\n * Finds the class with the specified <a href="#binary-name">binary name</a>.\n * This method should be overridden by class loader implementations that\n * follow the delegation model for loading classes, and will be invoked by\n * the {@link #loadClass loadClass} method after checking the\n * parent class loader for the requested class.\n * @implSpec The default implementation throws {@code ClassNotFoundException}.\n * @param  name\n *         The <a href="#binary-name">binary name</a> of the class\n * @return  The resulting {@code Class} object\n * @throws  ClassNotFoundException\n *          If the class could not be found\n * @since  1.2\n */')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("protected")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Class")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("?")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("findClass")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("String")]),a._v(" name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("throws")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ClassNotFoundException")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("throw")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ClassNotFoundException")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),s("h4",{attrs:{id:"混合加载模式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#混合加载模式"}},[a._v("#")]),a._v(" 混合加载模式")]),a._v(" "),s("blockquote",[s("ul",[s("li",[s("p",[a._v("-Xmixed 默认为混合模式")]),a._v(" "),s("p",[a._v("开始解释执行，启动速度较快，对热点代码实行检测和编译")])]),a._v(" "),s("li",[s("p",[a._v("-Xint")]),a._v(" "),s("p",[a._v("使用解释模式，启动很快，执行稍慢")])]),a._v(" "),s("li",[s("p",[a._v("-Xcomp")]),a._v(" "),s("p",[a._v("使用纯编译模式，执行很快，启动很慢")])])])]),a._v(" "),s("ul",[s("li",[a._v("解释器\n"),s("ul",[s("li",[a._v("bytecode intepreter")])])]),a._v(" "),s("li",[a._v("JIT\n"),s("ul",[s("li",[a._v("just In-Time compiler")])])]),a._v(" "),s("li",[a._v("混合模式\n"),s("ul",[s("li",[a._v("混合使用解释器 + 热点代码编译")]),a._v(" "),s("li",[a._v("起始阶段采用解释执行")]),a._v(" "),s("li",[a._v("热点代码检测:-XX:CompileThreshold=10000\n"),s("ol",[s("li",[a._v("多次被调用的方法（方法计数器：检测方法执行频率）")]),a._v(" "),s("li",[a._v("多次被调用的循环（循环计数器：检测循环执行效率）")]),a._v(" "),s("li",[a._v("进行编译")])])])])])]),a._v(" "),s("h3",{attrs:{id:"linking"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#linking"}},[a._v("#")]),a._v(" linking")]),a._v(" "),s("h4",{attrs:{id:"verification"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#verification"}},[a._v("#")]),a._v(" verification")]),a._v(" "),s("ol",[s("li",[a._v("验证文件是否符合JVM标准规范")])]),a._v(" "),s("h4",{attrs:{id:"preparation"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#preparation"}},[a._v("#")]),a._v(" preparation")]),a._v(" "),s("ol",[s("li",[a._v("静态成员变量赋默认值")])]),a._v(" "),s("h4",{attrs:{id:"resolution"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#resolution"}},[a._v("#")]),a._v(" resolution")]),a._v(" "),s("ol",[s("li",[a._v("将类、方法、属性等符号引用解析为直接引用")]),a._v(" "),s("li",[a._v("常量池中的各种符号引用解析为指针、偏移量等内存地址的直接引用")])]),a._v(" "),s("h3",{attrs:{id:"initializing"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#initializing"}},[a._v("#")]),a._v(" initializing")]),a._v(" "),s("ol",[s("li",[a._v("调用类的初始化代码"),s("init")],1)]),a._v(" "),s("h2",{attrs:{id:"运行时内存结构"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#运行时内存结构"}},[a._v("#")]),a._v(" 运行时内存结构")]),a._v(" "),s("h3",{attrs:{id:"硬件层"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#硬件层"}},[a._v("#")]),a._v(" 硬件层")]),a._v(" "),s("h4",{attrs:{id:"存储器的层次结构"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#存储器的层次结构"}},[a._v("#")]),a._v(" 存储器的层次结构")]),a._v(" "),s("p",[s("img",{attrs:{src:"/images/%E5%AD%98%E5%82%A8%E5%99%A8%E7%9A%84%E5%B1%82%E6%AC%A1%E6%9C%BA%E6%9E%84.png",alt:"存储器的层次机构"}})]),a._v(" "),s("p",[a._v("CPU:内存 = 1:100；内存:磁盘 = 1:100000")]),a._v(" "),s("h4",{attrs:{id:"多核cpu一致性的硬件层支持"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#多核cpu一致性的硬件层支持"}},[a._v("#")]),a._v(" 多核CPU一致性的硬件层支持")]),a._v(" "),s("p",[s("img",{attrs:{src:"/images/%E5%A4%9A%E6%A0%B8CPU%E4%B8%80%E8%87%B4%E6%80%A7%E7%9A%84%E7%A1%AC%E4%BB%B6%E5%B1%82%E6%94%AF%E6%8C%81.png",alt:"多核CPU一致性的硬件层支持"}})]),a._v(" "),s("p",[a._v("总线锁会锁住总线，使得其他CPU甚至不能访问内存中其他的地址，因而效率较低")]),a._v(" "),s("h4",{attrs:{id:"缓存行"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#缓存行"}},[a._v("#")]),a._v(" 缓存行")]),a._v(" "),s("blockquote",[s("p",[a._v("读取缓存以cache line为基本单位，目前时64个字节")])]),a._v(" "),s("p",[a._v("![cache line 的概念，缓存行对齐 伪共享](/images/cache line 的概念，缓存行对齐 伪共享.png)")]),a._v(" "),s("h4",{attrs:{id:"各种各样的缓存一致性协议"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#各种各样的缓存一致性协议"}},[a._v("#")]),a._v(" 各种各样的缓存一致性协议")]),a._v(" "),s("blockquote",[s("p",[a._v("现在CPU的数据一致性实现 = 缓存锁(MESI...) + 总线锁")])]),a._v(" "),s("ol",[s("li",[s("p",[a._v("MSI")])]),a._v(" "),s("li",[s("p",[a._v("MESI：（"),s("code",[a._v("Intel")]),a._v("的CPU所采用的缓存一致性协议）")]),a._v(" "),s("ul",[s("li",[a._v("Modified，更改过就标记为这个状态")]),a._v(" "),s("li",[a._v("Exclusive，独享就标记为这个状态")]),a._v(" "),s("li",[a._v("Shared，我读的时候，别人也在读，就标记为这个状态")]),a._v(" "),s("li",[a._v("Invalid，我读的时候，别的CPU已经改过了，就标记为这个状态")])]),a._v(" "),s("p",[s("img",{attrs:{src:"/images/MESI%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%E5%8D%8F%E8%AE%AE.png",alt:"MESI缓存一致性协议"}})]),a._v(" "),s("p",[s("font",{attrs:{color:"red"}},[s("strong",[a._v("有些无法被缓存的数据，或者跨越多个缓存行的数据依然必须使用总线锁")])])],1)]),a._v(" "),s("li",[s("p",[a._v("MOSI")])]),a._v(" "),s("li",[s("p",[a._v("Synapse")])]),a._v(" "),s("li",[s("p",[a._v("Firefly")])]),a._v(" "),s("li",[s("p",[a._v("Dragon")])])]),a._v(" "),s("h4",{attrs:{id:"cpu合并写技术"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#cpu合并写技术"}},[a._v("#")]),a._v(" CPU合并写技术")]),a._v(" "),s("p",[a._v("CPU为了提高指令执行效率，会再一条指令执行过程中（比如去内存读取数据慢了100倍），去同时执行另一条指令。（前提是，两条指定没有依赖关系）")]),a._v(" "),s("p",[a._v("https://www.cnblogs.com/liushaodong/p/4777308.html")]),a._v(" "),s("p",[a._v("写操作也可以进行合并")]),a._v(" "),s("h4",{attrs:{id:"乱序执行的证明"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#乱序执行的证明"}},[a._v("#")]),a._v(" 乱序执行的证明")]),a._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[a._v("\n")])])]),s("h4",{attrs:{id:"如何保证特定情况下的有序性-x86"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#如何保证特定情况下的有序性-x86"}},[a._v("#")]),a._v(" 如何保证特定情况下的有序性（x86）")]),a._v(" "),s("p",[a._v("有序性保障：CPU内存屏障（CPU的汇编指令）")]),a._v(" "),s("p",[a._v("sfence:在sfence指令前的写操作当必须在sfence指令后的写操作前完成。")]),a._v(" "),s("p",[a._v("ifence:在ifence指令前的读操作当必须在ifence指令后的读操作前完成。")]),a._v(" "),s("p",[a._v("mfence:在mfence指令前的读写操作当必须在mfence指令后的读写操作前完成。")]),a._v(" "),s("p",[a._v("lock指令，cmpxchg")]),a._v(" "),s("h3",{attrs:{id:"jvm层"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#jvm层"}},[a._v("#")]),a._v(" JVM层")]),a._v(" "),s("h4",{attrs:{id:"如何保证特定情况下的有序性"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#如何保证特定情况下的有序性"}},[a._v("#")]),a._v(" 如何保证特定情况下的有序性")]),a._v(" "),s("ol",[s("li",[s("p",[a._v("LoadLoad屏障")]),a._v(" "),s("p",[a._v("对于这样的语句：Load1;LoadLoad;Load2")]),a._v(" "),s("p",[a._v("在Load2及后续读取操作要读取的数据访问前，保证Load1要读取的数据读取完毕。")])]),a._v(" "),s("li",[s("p",[a._v("StoreStore屏障")]),a._v(" "),s("p",[a._v("对于这样的语句：Store1;StoreStore;Store2")]),a._v(" "),s("p",[a._v("在Store2及后续写入操作执行前，保证Store1的写入操作对其它处理器可见。")])]),a._v(" "),s("li",[s("p",[a._v("LoadStore屏障")]),a._v(" "),s("p",[a._v("对于这样的语句：Load1;LoadStore;Store2")]),a._v(" "),s("p",[a._v("在Store2及后续写入操作被刷出前，保证Load1要读取的数据被读取完毕。")])]),a._v(" "),s("li",[s("p",[a._v("StoreLoad屏障")]),a._v(" "),s("p",[a._v("对于这样的语句：Store1;StoreLoad;Load2")]),a._v(" "),s("p",[a._v("在Load2及后续所有读取操作执行前，保证Store1的写入对其它处理器可见。")])])]),a._v(" "),s("h5",{attrs:{id:"volatile指令的实现细节"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#volatile指令的实现细节"}},[a._v("#")]),a._v(" volatile指令的实现细节")]),a._v(" "),s("ol",[s("li",[s("p",[a._v("字节码层面 (ACC_VOLATILE访问修饰符)")]),a._v(" "),s("p",[a._v("只是在属性的访问修饰符后面加了一个"),s("code",[a._v("[volatile]")])])]),a._v(" "),s("li",[s("p",[a._v("JVM层面")]),a._v(" "),s("blockquote",[s("p",[a._v("StoreStoreBarrier")])])])]),a._v(" "),s("blockquote",[s("p",[a._v("volatile 写操作")]),a._v(" "),s("p",[a._v("StoreLoadBarrier")])]),a._v(" "),s("blockquote",[s("p",[a._v("LoadLoadBarrier")]),a._v(" "),s("p",[a._v("volatile 读操作")]),a._v(" "),s("p",[a._v("LoadStoreBarrier")])]),a._v(" "),s("ol",{attrs:{start:"3"}},[s("li",[s("p",[a._v("操作系统及硬件层面")]),a._v(" "),s("p",[a._v("使用"),s("code",[a._v("hsdis")]),a._v("观察汇编码，lock指令 xxx 执行 xxx 指令的时候保证对内存区域加锁")]),a._v(" "),s("p",[a._v("hsdis -> HotSpot Dis Assembler")]),a._v(" "),s("p",[a._v("https://blog.csdn.net/qq_26222859/article/details/52235930")]),a._v(" "),s("p",[a._v("windows 使用"),s("code",[a._v("lock")]),a._v("指令实现")])])]),a._v(" "),s("h5",{attrs:{id:"synchronized指令的实现细节"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#synchronized指令的实现细节"}},[a._v("#")]),a._v(" synchronized指令的实现细节")]),a._v(" "),s("ol",[s("li",[s("p",[a._v("字节码层面 (ACC_VOLATILE访问修饰符)")]),a._v(" "),s("p",[a._v("如果在方法上使用synchronized，则会在方面的访问修饰符后面加一个"),s("code",[a._v("[synchronized]")])]),a._v(" "),s("p",[a._v("如果在方法块上使用synchronized，则会在字节码层面增加相关指令：monitorenter,monitorexit")]),a._v(" "),s("p",[s("img",{attrs:{src:"/images/synchronized%E5%AD%97%E8%8A%82%E7%A0%81%E7%BC%96%E8%AF%91%E6%95%88%E6%9E%9C.png",alt:"synchronized字节码编译效果"}})]),a._v(" "),s("p",[a._v("为什么会有两条"),s("code",[a._v("monitorexit")]),a._v("，包含正常退出和异常退出。")])]),a._v(" "),s("li",[s("p",[a._v("JVM层面")]),a._v(" "),s("p",[a._v("C\\C++调用了操作系统提供的同步机制")])]),a._v(" "),s("li",[s("p",[a._v("操作系统及硬件层面")]),a._v(" "),s("p",[a._v("https://blog.csdn.net/21aspnet/article/details/88571740")]),a._v(" "),s("p",[a._v("X86：lock cmpxchg xxxx")])])]),a._v(" "),s("h3",{attrs:{id:"object对象的内存布局"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#object对象的内存布局"}},[a._v("#")]),a._v(" Object对象的内存布局")]),a._v(" "),s("h2",{attrs:{id:"jvm常用指令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#jvm常用指令"}},[a._v("#")]),a._v(" JVM常用指令")]),a._v(" "),s("h2",{attrs:{id:"jvm调优"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#jvm调优"}},[a._v("#")]),a._v(" JVM调优")]),a._v(" "),s("h2",{attrs:{id:"垃圾回收算法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#垃圾回收算法"}},[a._v("#")]),a._v(" 垃圾回收算法")]),a._v(" "),s("h2",{attrs:{id:"jvm调优实战"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#jvm调优实战"}},[a._v("#")]),a._v(" JVM调优实战")]),a._v(" "),s("h2",{attrs:{id:"jvm常见参数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#jvm常见参数"}},[a._v("#")]),a._v(" JVM常见参数")])])}),[],!1,null,null,null);t.default=e.exports}}]);