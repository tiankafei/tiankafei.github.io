(window.webpackJsonp=window.webpackJsonp||[]).push([[33],{379:function(a,s,t){"use strict";t.r(s);var n=t(42),e=Object(n.a)({},(function(){var a=this,s=a.$createElement,t=a._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"jvm入门到精通"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#jvm入门到精通"}},[a._v("#")]),a._v(" JVM入门到精通")]),a._v(" "),t("h2",{attrs:{id:"虚拟机基础概念"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#虚拟机基础概念"}},[a._v("#")]),a._v(" 虚拟机基础概念")]),a._v(" "),t("h3",{attrs:{id:"java-从编码到执行"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#java-从编码到执行"}},[a._v("#")]),a._v(" Java 从编码到执行")]),a._v(" "),t("p",[t("img",{attrs:{src:"/images/java%E4%BB%8E%E7%BC%96%E7%A0%81%E5%88%B0%E6%89%A7%E8%A1%8C.png",alt:"java从编码到执行"}})]),a._v(" "),t("h3",{attrs:{id:"jvm跨平台"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#jvm跨平台"}},[a._v("#")]),a._v(" JVM跨平台")]),a._v(" "),t("blockquote",[t("p",[a._v("JVM跟Java无关，关键的原因就是class，任何语言只要能编译成class，符合class文件的规范，就可以在JVM虚拟机上执行。")])]),a._v(" "),t("p",[t("img",{attrs:{src:"/images/JVM%E8%B7%A8%E5%B9%B3%E5%8F%B0.png",alt:"JVM跨平台"}})]),a._v(" "),t("h3",{attrs:{id:"jvm是一种规范"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#jvm是一种规范"}},[a._v("#")]),a._v(" JVM是一种规范")]),a._v(" "),t("blockquote",[t("p",[a._v("是一台虚拟的计算机")])]),a._v(" "),t("h3",{attrs:{id:"javac的过程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#javac的过程"}},[a._v("#")]),a._v(" Javac的过程")]),a._v(" "),t("blockquote",[t("p",[a._v("编译原理：")]),a._v(" "),t("p",[a._v("源码 -> 词法分析器 -> token流 -> 语法分析器 -> 抽象语法树 -> ByteCode -> 字节码生成器 -> 注解抽象语法树 -> 语义分析器")])]),a._v(" "),t("h3",{attrs:{id:"常见的jvm实现"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#常见的jvm实现"}},[a._v("#")]),a._v(" 常见的JVM实现")]),a._v(" "),t("blockquote",[t("p",[a._v("Hotspot：oracle官方")]),a._v(" "),t("p",[a._v("TaobaoVM：hostpot深度定制版")]),a._v(" "),t("p",[a._v("Jrockit：BEA，曾经号称世界上最快的JVM，被oracle收购，合并与Hotspot")]),a._v(" "),t("p",[a._v("LiquidVM：直接针对硬件（底层没有操作系统）")]),a._v(" "),t("p",[a._v("J9 -IBM")]),a._v(" "),t("p",[a._v("azul zing：最新垃圾回收的业界标杆")]),a._v(" "),t("blockquote",[t("p",[a._v("垃圾回收号称1ms实现，Hotspot吸收了其优点，升级到后来的ZGC")])]),a._v(" "),t("p",[a._v("Microsoft VM")])]),a._v(" "),t("h3",{attrs:{id:"jdk-jre-jvm的区别"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#jdk-jre-jvm的区别"}},[a._v("#")]),a._v(" JDK JRE JVM的区别")]),a._v(" "),t("p",[t("img",{attrs:{src:"/images/JDK-JRE-JVM.png",alt:"JDK-JRE-JVM"}})]),a._v(" "),t("h2",{attrs:{id:"class文件结构"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#class文件结构"}},[a._v("#")]),a._v(" class文件结构")]),a._v(" "),t("h3",{attrs:{id:"class文件二进制文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#class文件二进制文件"}},[a._v("#")]),a._v(" class文件二进制文件")]),a._v(" "),t("p",[t("img",{attrs:{src:"/images/class%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%96%87%E4%BB%B6%E7%A4%BA%E4%BE%8B.png",alt:"class二进制文件示例"}})]),a._v(" "),t("h3",{attrs:{id:"class文件解析"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#class文件解析"}},[a._v("#")]),a._v(" class文件解析")]),a._v(" "),t("p",[t("img",{attrs:{src:"/images/class%E6%96%87%E4%BB%B6%E8%A7%A3%E6%9E%90.png",alt:"class文件解析"}})]),a._v(" "),t("h3",{attrs:{id:"class文件查看方法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#class文件查看方法"}},[a._v("#")]),a._v(" class文件查看方法")]),a._v(" "),t("ul",[t("li",[a._v("javap -v class文件名")]),a._v(" "),t("li",[a._v("JBE（可以直接修改）")]),a._v(" "),t("li",[a._v("JClassLib（IDEA插件之一）")])]),a._v(" "),t("h3",{attrs:{id:"class文件结构-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#class文件结构-2"}},[a._v("#")]),a._v(" class文件结构")]),a._v(" "),t("p",[t("img",{attrs:{src:"/images/java1.8%E7%B1%BB%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F%E7%AC%AC%E4%B8%80%E7%89%88.png",alt:"java1.8类文件格式第一版"}})]),a._v(" "),t("h2",{attrs:{id:"class文件内存加载过程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#class文件内存加载过程"}},[a._v("#")]),a._v(" class文件内存加载过程")]),a._v(" "),t("p",[t("img",{attrs:{src:"/images/class%E6%96%87%E4%BB%B6%E5%8A%A0%E8%BD%BD%E5%88%B0%E5%86%85%E5%AD%98.png",alt:"class文件加载到内存"}})]),a._v(" "),t("ol",[t("li",[a._v("loading:class文件被加载到内存")]),a._v(" "),t("li",[a._v("linking:\n"),t("ol",[t("li",[a._v("verification:校验加载进来的class是否符合标准(前面四个字节是“cafe babe”等)")]),a._v(" "),t("li",[a._v("preparation:class静态变量赋默认值(数值型默认值为0)")]),a._v(" "),t("li",[a._v("resolution:class文件的常量池用到的那些符号引用转换为直接的内存地址，可以直接访问到")])])]),a._v(" "),t("li",[a._v("initializing:静态变量赋值为初始值\n"),t("ul",[t("li",[a._v("JVM规范并没有规定何时加载。Hotspot默认懒加载")]),a._v(" "),t("li",[a._v("但是严格规定了什么时候必须初始化\n"),t("ol",[t("li",[a._v("new getstatic putstatic invokestatic指定，访问final变量除外")]),a._v(" "),t("li",[a._v("java.lang.reflect对类进行反射调用时")]),a._v(" "),t("li",[a._v("初始化子类的时候，父类首先初始化")]),a._v(" "),t("li",[a._v("虚拟机启动时，被执行的主类必须初始化")]),a._v(" "),t("li",[a._v("动态语言支持java.lang.invoke.MethodHandle解析的结果为REF_getstatic REF_putstatic REF_invokestatic的方法句柄时，该类必须初始化")])])])])])]),a._v(" "),t("h3",{attrs:{id:"loading"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#loading"}},[a._v("#")]),a._v(" loading")]),a._v(" "),t("blockquote",[t("p",[a._v("JVM中的所有的calss都是被类加载器加载到内存的（ClassLoader）")])]),a._v(" "),t("p",[t("img",{attrs:{src:"/images/%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8.png",alt:"类加载器"}})]),a._v(" "),t("h4",{attrs:{id:"类加载过程-双亲委派"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#类加载过程-双亲委派"}},[a._v("#")]),a._v(" 类加载过程:双亲委派")]),a._v(" "),t("p",[t("img",{attrs:{src:"/images/%E7%B1%BB%E5%8A%A0%E8%BD%BD%E8%BF%87%E7%A8%8B.png",alt:"类加载过程"}})]),a._v(" "),t("h4",{attrs:{id:"为什么要双亲委派"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#为什么要双亲委派"}},[a._v("#")]),a._v(" 为什么要双亲委派")]),a._v(" "),t("ol",[t("li",[a._v("主要是为了安全:自己定义一个java.lang.String类")]),a._v(" "),t("li",[a._v("一个类只加载一次，减少资源浪费")])]),a._v(" "),t("h4",{attrs:{id:"如何打破双亲委派"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#如何打破双亲委派"}},[a._v("#")]),a._v(" 如何打破双亲委派")]),a._v(" "),t("ol",[t("li",[a._v("重写loadClass()方法")])]),a._v(" "),t("h4",{attrs:{id:"何时打破过双亲委派"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#何时打破过双亲委派"}},[a._v("#")]),a._v(" 何时打破过双亲委派")]),a._v(" "),t("ol",[t("li",[a._v("JDK1.2之前，自定义ClassLoader都必须重写loadClass()方法")]),a._v(" "),t("li",[a._v("ThreadContextClassLoader可以实现基础类调用实现类代码，通过thread.setContextClassLoader指定")]),a._v(" "),t("li",[a._v("热启动，热部署\n"),t("ul",[t("li",[a._v("osgi tomcat都有自己的模块指定ClassLoader（可以加载同一类库的不同版本）")])])])]),a._v(" "),t("h4",{attrs:{id:"自定义类加载器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#自定义类加载器"}},[a._v("#")]),a._v(" 自定义类加载器")]),a._v(" "),t("ol",[t("li",[a._v("继承ClassLoader")]),a._v(" "),t("li",[a._v("重写模板方法findClass，调用defineClass")]),a._v(" "),t("li",[a._v("自定义类加载器加载自加密的class\n"),t("ol",[t("li",[a._v("防止反编译")]),a._v(" "),t("li",[a._v("防止篡改")])])])]),a._v(" "),t("h4",{attrs:{id:"classloader源码解析"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#classloader源码解析"}},[a._v("#")]),a._v(" ClassLoader源码解析")]),a._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("protected")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Class")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("?")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("loadClass")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("String")]),a._v(" name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("boolean")]),a._v(" resolve"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("throws")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ClassNotFoundException")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("synchronized")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("getClassLoadingLock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// First, check if the class has already been loaded")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Class")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("?")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v(" c "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("findLoadedClass")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("c "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("==")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("long")]),a._v(" t0 "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("nanoTime")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("try")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("parent "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("!=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n                    c "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" parent"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("loadClass")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("else")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n                    c "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("findBootstrapClassOrNull")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("catch")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ClassNotFoundException")]),a._v(" e"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// ClassNotFoundException thrown if class not found")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// from the non-null parent class loader")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("c "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("==")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// If still not found, then invoke findClass in order")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// to find the class.")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("long")]),a._v(" t1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("nanoTime")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n                c "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("findClass")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// this is the defining class loader; record the stats")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("PerfCounter")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("getParentDelegationTime")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("addTime")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("t1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v(" t0"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("PerfCounter")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("getFindClassTime")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("addElapsedTimeFrom")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("t1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("PerfCounter")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("getFindClasses")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("increment")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("resolve"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("resolveClass")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v(" c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v('/**\n * Finds the class with the specified <a href="#binary-name">binary name</a>.\n * This method should be overridden by class loader implementations that\n * follow the delegation model for loading classes, and will be invoked by\n * the {@link #loadClass loadClass} method after checking the\n * parent class loader for the requested class.\n * @implSpec The default implementation throws {@code ClassNotFoundException}.\n * @param  name\n *         The <a href="#binary-name">binary name</a> of the class\n * @return  The resulting {@code Class} object\n * @throws  ClassNotFoundException\n *          If the class could not be found\n * @since  1.2\n */')]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("protected")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Class")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("?")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("findClass")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("String")]),a._v(" name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("throws")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ClassNotFoundException")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("throw")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ClassNotFoundException")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),t("h4",{attrs:{id:"混合加载模式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#混合加载模式"}},[a._v("#")]),a._v(" 混合加载模式")]),a._v(" "),t("blockquote",[t("ul",[t("li",[t("p",[a._v("-Xmixed 默认为混合模式")]),a._v(" "),t("p",[a._v("开始解释执行，启动速度较快，对热点代码实行检测和编译")])]),a._v(" "),t("li",[t("p",[a._v("-Xint")]),a._v(" "),t("p",[a._v("使用解释模式，启动很快，执行稍慢")])]),a._v(" "),t("li",[t("p",[a._v("-Xcomp")]),a._v(" "),t("p",[a._v("使用纯编译模式，执行很快，启动很慢")])])])]),a._v(" "),t("ul",[t("li",[a._v("解释器\n"),t("ul",[t("li",[a._v("bytecode intepreter")])])]),a._v(" "),t("li",[a._v("JIT\n"),t("ul",[t("li",[a._v("just In-Time compiler")])])]),a._v(" "),t("li",[a._v("混合模式\n"),t("ul",[t("li",[a._v("混合使用解释器 + 热点代码编译")]),a._v(" "),t("li",[a._v("起始阶段采用解释执行")]),a._v(" "),t("li",[a._v("热点代码检测:-XX:CompileThreshold=10000\n"),t("ol",[t("li",[a._v("多次被调用的方法（方法计数器：检测方法执行频率）")]),a._v(" "),t("li",[a._v("多次被调用的循环（循环计数器：检测循环执行效率）")]),a._v(" "),t("li",[a._v("进行编译")])])])])])]),a._v(" "),t("h3",{attrs:{id:"linking"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#linking"}},[a._v("#")]),a._v(" linking")]),a._v(" "),t("h4",{attrs:{id:"verification"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#verification"}},[a._v("#")]),a._v(" verification")]),a._v(" "),t("ol",[t("li",[a._v("验证文件是否符合JVM标准规范")])]),a._v(" "),t("h4",{attrs:{id:"preparation"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#preparation"}},[a._v("#")]),a._v(" preparation")]),a._v(" "),t("ol",[t("li",[a._v("静态成员变量赋默认值")])]),a._v(" "),t("h4",{attrs:{id:"resolution"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#resolution"}},[a._v("#")]),a._v(" resolution")]),a._v(" "),t("ol",[t("li",[a._v("将类、方法、属性等符号引用解析为直接引用")]),a._v(" "),t("li",[a._v("常量池中的各种符号引用解析为指针、偏移量等内存地址的直接引用")])]),a._v(" "),t("h3",{attrs:{id:"initializing"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#initializing"}},[a._v("#")]),a._v(" initializing")]),a._v(" "),t("ol",[t("li",[a._v("调用类的初始化代码"),t("init")],1)]),a._v(" "),t("h2",{attrs:{id:"运行时内存结构"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#运行时内存结构"}},[a._v("#")]),a._v(" 运行时内存结构")]),a._v(" "),t("h3",{attrs:{id:"硬件层"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#硬件层"}},[a._v("#")]),a._v(" 硬件层")]),a._v(" "),t("h4",{attrs:{id:"存储器的层次结构"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#存储器的层次结构"}},[a._v("#")]),a._v(" 存储器的层次结构")]),a._v(" "),t("p",[t("img",{attrs:{src:"/images/%E5%AD%98%E5%82%A8%E5%99%A8%E7%9A%84%E5%B1%82%E6%AC%A1%E6%9C%BA%E6%9E%84.png",alt:"存储器的层次机构"}})]),a._v(" "),t("p",[a._v("CPU:内存 = 1:100；内存:磁盘 = 1:100000")]),a._v(" "),t("h4",{attrs:{id:"多核cpu一致性的硬件层支持"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#多核cpu一致性的硬件层支持"}},[a._v("#")]),a._v(" 多核CPU一致性的硬件层支持")]),a._v(" "),t("p",[t("img",{attrs:{src:"/images/%E5%A4%9A%E6%A0%B8CPU%E4%B8%80%E8%87%B4%E6%80%A7%E7%9A%84%E7%A1%AC%E4%BB%B6%E5%B1%82%E6%94%AF%E6%8C%81.png",alt:"多核CPU一致性的硬件层支持"}})]),a._v(" "),t("p",[a._v("总线锁会锁住总线，使得其他CPU甚至不能访问内存中其他的地址，因而效率较低")]),a._v(" "),t("h4",{attrs:{id:"缓存行"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#缓存行"}},[a._v("#")]),a._v(" 缓存行")]),a._v(" "),t("blockquote",[t("p",[a._v("读取缓存以cache line为基本单位，目前时64个字节")])]),a._v(" "),t("p",[a._v("![cache line 的概念，缓存行对齐 伪共享](/images/cache line 的概念，缓存行对齐 伪共享.png)")]),a._v(" "),t("h4",{attrs:{id:"各种各样的缓存一致性协议"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#各种各样的缓存一致性协议"}},[a._v("#")]),a._v(" 各种各样的缓存一致性协议")]),a._v(" "),t("blockquote",[t("p",[a._v("现在CPU的数据一致性实现 = 缓存锁(MESI...) + 总线锁")])]),a._v(" "),t("ol",[t("li",[t("p",[a._v("MSI")])]),a._v(" "),t("li",[t("p",[a._v("MESI：（"),t("code",[a._v("Intel")]),a._v("的CPU所采用的缓存一致性协议）")]),a._v(" "),t("ul",[t("li",[a._v("Modified，更改过就标记为这个状态")]),a._v(" "),t("li",[a._v("Exclusive，独享就标记为这个状态")]),a._v(" "),t("li",[a._v("Shared，我读的时候，别人也在读，就标记为这个状态")]),a._v(" "),t("li",[a._v("Invalid，我读的时候，别的CPU已经改过了，就标记为这个状态")])]),a._v(" "),t("p",[t("img",{attrs:{src:"/images/MESI%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%E5%8D%8F%E8%AE%AE.png",alt:"MESI缓存一致性协议"}})]),a._v(" "),t("p",[t("font",{attrs:{color:"red"}},[t("strong",[a._v("有些无法被缓存的数据，或者跨越多个缓存行的数据依然必须使用总线锁")])])],1)]),a._v(" "),t("li",[t("p",[a._v("MOSI")])]),a._v(" "),t("li",[t("p",[a._v("Synapse")])]),a._v(" "),t("li",[t("p",[a._v("Firefly")])]),a._v(" "),t("li",[t("p",[a._v("Dragon")])])]),a._v(" "),t("h4",{attrs:{id:"cpu合并写技术"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#cpu合并写技术"}},[a._v("#")]),a._v(" CPU合并写技术")]),a._v(" "),t("p",[a._v("CPU为了提高指令执行效率，会再一条指令执行过程中（比如去内存读取数据慢了100倍），去同时执行另一条指令。（前提是，两条指定没有依赖关系）")]),a._v(" "),t("p",[a._v("https://www.cnblogs.com/liushaodong/p/4777308.html")]),a._v(" "),t("p",[a._v("写操作也可以进行合并")]),a._v(" "),t("h4",{attrs:{id:"乱序执行的证明"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#乱序执行的证明"}},[a._v("#")]),a._v(" 乱序执行的证明")]),a._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[a._v("\n")])])]),t("h4",{attrs:{id:"如何保证特定情况下的有序性-x86"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#如何保证特定情况下的有序性-x86"}},[a._v("#")]),a._v(" 如何保证特定情况下的有序性（x86）")]),a._v(" "),t("p",[a._v("有序性保障：CPU内存屏障（CPU的汇编指令）")]),a._v(" "),t("p",[a._v("sfence:在sfence指令前的写操作当必须在sfence指令后的写操作前完成。")]),a._v(" "),t("p",[a._v("ifence:在ifence指令前的读操作当必须在ifence指令后的读操作前完成。")]),a._v(" "),t("p",[a._v("mfence:在mfence指令前的读写操作当必须在mfence指令后的读写操作前完成。")]),a._v(" "),t("p",[a._v("lock指令，cmpxchg")]),a._v(" "),t("h3",{attrs:{id:"jvm层"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#jvm层"}},[a._v("#")]),a._v(" JVM层")]),a._v(" "),t("h4",{attrs:{id:"如何保证特定情况下的有序性"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#如何保证特定情况下的有序性"}},[a._v("#")]),a._v(" 如何保证特定情况下的有序性")]),a._v(" "),t("ol",[t("li",[t("p",[a._v("LoadLoad屏障")]),a._v(" "),t("p",[a._v("对于这样的语句：Load1;LoadLoad;Load2")]),a._v(" "),t("p",[a._v("在Load2及后续读取操作要读取的数据访问前，保证Load1要读取的数据读取完毕。")])]),a._v(" "),t("li",[t("p",[a._v("StoreStore屏障")]),a._v(" "),t("p",[a._v("对于这样的语句：Store1;StoreStore;Store2")]),a._v(" "),t("p",[a._v("在Store2及后续写入操作执行前，保证Store1的写入操作对其它处理器可见。")])]),a._v(" "),t("li",[t("p",[a._v("LoadStore屏障")]),a._v(" "),t("p",[a._v("对于这样的语句：Load1;LoadStore;Store2")]),a._v(" "),t("p",[a._v("在Store2及后续写入操作被刷出前，保证Load1要读取的数据被读取完毕。")])]),a._v(" "),t("li",[t("p",[a._v("StoreLoad屏障")]),a._v(" "),t("p",[a._v("对于这样的语句：Store1;StoreLoad;Load2")]),a._v(" "),t("p",[a._v("在Load2及后续所有读取操作执行前，保证Store1的写入对其它处理器可见。")])])]),a._v(" "),t("h5",{attrs:{id:"volatile指令的实现细节"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#volatile指令的实现细节"}},[a._v("#")]),a._v(" volatile指令的实现细节")]),a._v(" "),t("ol",[t("li",[t("p",[a._v("字节码层面 (ACC_VOLATILE访问修饰符)")]),a._v(" "),t("p",[a._v("只是在属性的访问修饰符后面加了一个"),t("code",[a._v("[volatile]")])])]),a._v(" "),t("li",[t("p",[a._v("JVM层面")]),a._v(" "),t("blockquote",[t("p",[a._v("StoreStoreBarrier")])])])]),a._v(" "),t("blockquote",[t("p",[a._v("volatile 写操作")]),a._v(" "),t("p",[a._v("StoreLoadBarrier")])]),a._v(" "),t("blockquote",[t("p",[a._v("LoadLoadBarrier")]),a._v(" "),t("p",[a._v("volatile 读操作")]),a._v(" "),t("p",[a._v("LoadStoreBarrier")])]),a._v(" "),t("ol",{attrs:{start:"3"}},[t("li",[t("p",[a._v("操作系统及硬件层面")]),a._v(" "),t("p",[a._v("使用"),t("code",[a._v("hsdis")]),a._v("观察汇编码，lock指令 xxx 执行 xxx 指令的时候保证对内存区域加锁")]),a._v(" "),t("p",[a._v("hsdis -> HotSpot Dis Assembler")]),a._v(" "),t("p",[a._v("https://blog.csdn.net/qq_26222859/article/details/52235930")]),a._v(" "),t("p",[a._v("windows 使用"),t("code",[a._v("lock")]),a._v("指令实现")])])]),a._v(" "),t("h5",{attrs:{id:"synchronized指令的实现细节"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#synchronized指令的实现细节"}},[a._v("#")]),a._v(" synchronized指令的实现细节")]),a._v(" "),t("ol",[t("li",[t("p",[a._v("字节码层面 (ACC_VOLATILE访问修饰符)")]),a._v(" "),t("p",[a._v("如果在方法上使用synchronized，则会在方面的访问修饰符后面加一个"),t("code",[a._v("[synchronized]")])]),a._v(" "),t("p",[a._v("如果在方法块上使用synchronized，则会在字节码层面增加相关指令：monitorenter,monitorexit")]),a._v(" "),t("p",[t("img",{attrs:{src:"/images/synchronized%E5%AD%97%E8%8A%82%E7%A0%81%E7%BC%96%E8%AF%91%E6%95%88%E6%9E%9C.png",alt:"synchronized字节码编译效果"}})]),a._v(" "),t("p",[a._v("为什么会有两条"),t("code",[a._v("monitorexit")]),a._v("，包含正常退出和异常退出。")])]),a._v(" "),t("li",[t("p",[a._v("JVM层面")]),a._v(" "),t("p",[a._v("C\\C++调用了操作系统提供的同步机制")])]),a._v(" "),t("li",[t("p",[a._v("操作系统及硬件层面")]),a._v(" "),t("p",[a._v("https://blog.csdn.net/21aspnet/article/details/88571740")]),a._v(" "),t("p",[a._v("X86：lock cmpxchg xxxx")])])]),a._v(" "),t("h3",{attrs:{id:"java并发内存模型"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#java并发内存模型"}},[a._v("#")]),a._v(" Java并发内存模型")]),a._v(" "),t("p",[t("img",{attrs:{src:"/images/Java%E5%B9%B6%E5%8F%91%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B.png",alt:"Java并发内存模型"}})]),a._v(" "),t("h3",{attrs:{id:"java8大原子操作-虚拟机规范-已弃用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#java8大原子操作-虚拟机规范-已弃用"}},[a._v("#")]),a._v(" Java8大原子操作（虚拟机规范，已弃用）")]),a._v(" "),t("blockquote",[t("p",[a._v("最新的JSR-133已经放弃这种描述，但是JMM没有变化。《深入理解Java虚拟机》P364")])]),a._v(" "),t("ol",[t("li",[a._v("lock：主内存，标识变量为线程独占")]),a._v(" "),t("li",[a._v("unlock：主内存，解锁线程独占变量")]),a._v(" "),t("li",[a._v("read：主内存，读取内容到工作内存")]),a._v(" "),t("li",[a._v("load：工作内存，read后的值放入线程本地变量副本")]),a._v(" "),t("li",[a._v("use：工作内存，传值给执行引擎")]),a._v(" "),t("li",[a._v("assign：工作内存，执行引擎结果赋值给线程本地变量")]),a._v(" "),t("li",[a._v("store：工作内存，存值到主内存给write备用")]),a._v(" "),t("li",[a._v("write：主内存，写变量值")])]),a._v(" "),t("h3",{attrs:{id:"hanppens-before原则"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#hanppens-before原则"}},[a._v("#")]),a._v(" hanppens-before原则")]),a._v(" "),t("ol",[t("li",[a._v("程序次序规则：同一个线程内，按照代码出现的顺序，前面的代码先行于后面的代码，准确的说是控制流顺序，因为要考虑到分支和循环结构。")]),a._v(" "),t("li",[a._v("管程锁定规则：一个unlock操作先行发生于后面（时间上）对同一个锁的lock操作。")]),a._v(" "),t("li",[a._v("volatile变量规则：对一个volatile变量的写操作先行发生于后面（时间上）对这个变量的读操作。")]),a._v(" "),t("li",[a._v("线程启动规则：Thread的start()方法先行发生于这个线程的每一个操作。")]),a._v(" "),t("li",[a._v("线程终止规则：线程的所有操作都先行与此线程的终止检测。可以通过Thread.join()方法结束、Thread.isAlive()的返回值等手段检测线程的终止。")]),a._v(" "),t("li",[a._v("线程中断规则：对线程interrupt()方法的调用先行发生于被中断线程的代码检测到中断事件的发生，可以通过Thread.interrupt()方法检测线程是否中断。")]),a._v(" "),t("li",[a._v("对象终结规则：一个对象的初始化完成先行于发生它的finalize()方法的开始。")]),a._v(" "),t("li",[a._v("传递性：如果操作A先行于操作B，操作B先行于操作C，那么操作A先行于操作C。")])]),a._v(" "),t("h3",{attrs:{id:"as-if-serial"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#as-if-serial"}},[a._v("#")]),a._v(" as if serial")]),a._v(" "),t("p",[a._v("不管如果重排序，单线程执行结果不会改变。")]),a._v(" "),t("h2",{attrs:{id:"object对象的内存布局"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#object对象的内存布局"}},[a._v("#")]),a._v(" Object对象的内存布局")]),a._v(" "),t("h4",{attrs:{id:"_1-请解释以下对象的创建过程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-请解释以下对象的创建过程"}},[a._v("#")]),a._v(" 1. 请解释以下对象的创建过程？")]),a._v(" "),t("h5",{attrs:{id:"_1-class加载到内存的过程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-class加载到内存的过程"}},[a._v("#")]),a._v(" 1. class加载到内存的过程")]),a._v(" "),t("ol",[t("li",[a._v("class loading")]),a._v(" "),t("li",[a._v("class linking（verification,preparation,resolution)")]),a._v(" "),t("li",[a._v("class initializing")])]),a._v(" "),t("h5",{attrs:{id:"_2-new对象的过程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-new对象的过程"}},[a._v("#")]),a._v(" 2. new对象的过程")]),a._v(" "),t("ol",[t("li",[a._v("申请对象内存")]),a._v(" "),t("li",[a._v("成员变量赋默认值")]),a._v(" "),t("li",[a._v("调用构造方法"),t("init",[t("ol",[t("li",[a._v("成员变量顺序赋初始值")]),a._v(" "),t("li",[a._v("执行构造方法语句(先调用super)")])])])],1)]),a._v(" "),t("h4",{attrs:{id:"_2-对象在内存中的存储布局"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-对象在内存中的存储布局"}},[a._v("#")]),a._v(" 2. 对象在内存中的存储布局？")]),a._v(" "),t("h5",{attrs:{id:"观察虚拟机的配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#观察虚拟机的配置"}},[a._v("#")]),a._v(" 观察虚拟机的配置")]),a._v(" "),t("blockquote",[t("p",[a._v("对象的大小具体跟虚拟机的实现以及虚拟机的设置都很有关系。")]),a._v(" "),t("p",[t("img",{attrs:{src:"/images/%E8%A7%82%E5%AF%9F%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%9A%84%E9%85%8D%E7%BD%AE.png",alt:"观察虚拟机的配置"}})])]),a._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[a._v("java "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("XX"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("PrintCommandLineFlags")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("version\n\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("C")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("\\"),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Users")]),a._v("\\tiankafei"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("java "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("XX"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("PrintCommandLineFlags")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("version\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("XX"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("InitialHeapSize")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("16777216")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("XX"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("MaxHeapSize")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("268435456")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("XX"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("PrintCommandLineFlags")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("XX"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("UseLargePagesIndividualAllocation")]),a._v("\njava version "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"1.8.0_261"')]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Java")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("TM"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" SE "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Runtime")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Environment")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("build "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1.8")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v(".0_261")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("b12"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Java")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("HotSpot")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("TM"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Client")]),a._v(" VM "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("build "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("25.261")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("b12"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" mixed mode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])])]),t("h5",{attrs:{id:"普通对象"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#普通对象"}},[a._v("#")]),a._v(" 普通对象")]),a._v(" "),t("ol",[t("li",[a._v("对象头：mardword 8")]),a._v(" "),t("li",[a._v("ClassPointer指针：-XX:+UseCompressedClassPointers为4字节 不开启为8字节")]),a._v(" "),t("li",[a._v("实例数据\n"),t("ul",[t("li",[a._v("引用类型：-XX:+UseCompressedOops为4字节 不开启为8字节")]),a._v(" "),t("li",[a._v("Oops：Ordinary Object Pointers")])])]),a._v(" "),t("li",[a._v("Padding对齐，8的倍数")])]),a._v(" "),t("h5",{attrs:{id:"数组对象"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#数组对象"}},[a._v("#")]),a._v(" 数组对象")]),a._v(" "),t("ol",[t("li",[a._v("对象头：mardwork 8")]),a._v(" "),t("li",[a._v("ClassPointer指针同上")]),a._v(" "),t("li",[a._v("数组长度：4个字节")]),a._v(" "),t("li",[a._v("数组数据")]),a._v(" "),t("li",[a._v("Padding对齐，8的倍数")])]),a._v(" "),t("h4",{attrs:{id:"_3-对象头具体包括什么"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-对象头具体包括什么"}},[a._v("#")]),a._v(" 3. 对象头具体包括什么？")]),a._v(" "),t("p",[a._v("hotspot源码的实现")]),a._v(" "),t("p",[t("img",{attrs:{src:"/images/java%E5%AF%B9%E8%B1%A1%E5%A4%B401.png",alt:"java对象头01"}})]),a._v(" "),t("p",[a._v("表格展示")]),a._v(" "),t("p",[t("img",{attrs:{src:"/images/java%E5%AF%B9%E8%B1%A1%E5%A4%B402.png",alt:"java对象头02"}})]),a._v(" "),t("p",[t("font",{attrs:{color:"red"}},[t("strong",[a._v("当一个对象计算过identityHashCode之后，不能进入偏向锁状态")])])],1),a._v(" "),t("ol",[t("li",[a._v("https://cloud.tencent.com/developer/article/1480590")]),a._v(" "),t("li",[a._v("https://cloud.tencent.com/developer/article/1484167")]),a._v(" "),t("li",[a._v("https://cloud.tencent.com/developer/article/1485795")]),a._v(" "),t("li",[a._v("https://cloud.tencent.com/developer/article/1482500")])]),a._v(" "),t("h4",{attrs:{id:"_4-对象怎么定位"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-对象怎么定位"}},[a._v("#")]),a._v(" 4. 对象怎么定位？")]),a._v(" "),t("p",[a._v("https://blog.csdn.net/clover_lily/article/details/80095580")]),a._v(" "),t("ol",[t("li",[a._v("句柄池")]),a._v(" "),t("li",[a._v("直接指针")])]),a._v(" "),t("h4",{attrs:{id:"_5-对象怎么分配"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-对象怎么分配"}},[a._v("#")]),a._v(" 5. 对象怎么分配？")]),a._v(" "),t("p",[t("img",{attrs:{src:"/images/%E5%AF%B9%E8%B1%A1%E5%88%86%E9%85%8D%E8%BF%87%E7%A8%8B.png",alt:"对象分配过程"}})]),a._v(" "),t("h4",{attrs:{id:"_6-object-o-new-object-在内存中占用多少字节"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-object-o-new-object-在内存中占用多少字节"}},[a._v("#")]),a._v(" 6. Object o = new Object() 在内存中占用多少字节？")]),a._v(" "),t("h5",{attrs:{id:"自定义agnet-1-8"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#自定义agnet-1-8"}},[a._v("#")]),a._v(" 自定义Agnet（1.8）")]),a._v(" "),t("ol",[t("li",[t("p",[a._v("创建文件TiankafeiAgent")]),a._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("package")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token namespace"}},[a._v("org"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("tiankafei"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("agent")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("import")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token namespace"}},[a._v("java"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("lang"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("instrument"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")])]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Instrumentation")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("/**\n * @author tiankafei\n * @since 1.0\n **/")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("TiankafeiAgent")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("private")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("static")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Instrumentation")]),a._v(" inst"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("static")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("void")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("premain")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("String")]),a._v(" agentArgs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Instrumentation")]),a._v(" _inst"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        inst "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" _inst"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("static")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("long")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sizeOf")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Object")]),a._v(" o"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v(" inst"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("getObjectSize")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("o"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])])]),a._v(" "),t("li",[t("p",[a._v("src目录下创建META-INF/MANIFEST.MF")]),a._v(" "),t("div",{staticClass:"language-txt extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("Manifest-Version: 1.0\nCreated-By: tiankafei\nPremain-Class: org.tiankafei.agent.TiankafeiAgent\n\n")])])]),t("p",[a._v("注意Premain-Class这行必须是新的一行（回车 + 换行），确认idea不能有任何错误提示")])]),a._v(" "),t("li",[t("p",[a._v("打包jar文件")])]),a._v(" "),t("li",[t("p",[a._v("在需要使用该Agent Jar的项目中引入该Jar包")]),a._v(" "),t("p",[a._v("project structure -> project settings -> library 添加该jar包")])]),a._v(" "),t("li",[t("p",[a._v("运行时需要该Agent Jar的类，加入参数（VM options）：")]),a._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("javaagent"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("agent的jar包绝对路径\n")])])])]),a._v(" "),t("li",[t("p",[a._v("如何使用该类")]),a._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("package")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token namespace"}},[a._v("org"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("tiankafei"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("base")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("import")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token namespace"}},[a._v("org"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("tiankafei"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("agent"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")])]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("TiankafeiAgent")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("/**\n * @author tiankafei\n * @since 1.0\n **/")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("TestAgent")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("static")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("void")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("main")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" args"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("TiankafeiAgent")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sizeOf")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Object")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("TiankafeiAgent")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sizeOf")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("TiankafeiAgent")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sizeOf")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("P")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("private")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("static")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("P")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//8 _markword")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//4 _oop指针")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),a._v(" id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("         "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//4")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("String")]),a._v(" name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//4")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),a._v(" age"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("        "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//4")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("byte")]),a._v(" b1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("        "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//1")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("byte")]),a._v(" b2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("        "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//1")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Object")]),a._v(" o"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("       "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//4")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("byte")]),a._v(" b3"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("        "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//1")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),t("p",[a._v("输出结果：")]),a._v(" "),t("div",{staticClass:"language-txt extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("16\n16\n32\n")])])])])]),a._v(" "),t("h5",{attrs:{id:"分析对象大小-16"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#分析对象大小-16"}},[a._v("#")]),a._v(" 分析对象大小-16")]),a._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("XX"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("UseCompressedClassPointers")]),a._v("\n")])])]),t("ol",[t("li",[a._v("对象头"),t("code",[a._v("markword")]),a._v("占8个字节")]),a._v(" "),t("li",[a._v("class指针"),t("code",[a._v("class pointer")]),a._v("占8个字节，当开启"),t("code",[a._v("-XX:+UseCompressedClassPointers")]),a._v("时，class指针会被压缩成4个字节")]),a._v(" "),t("li",[a._v("padding对齐，占了4个字节（对齐不一定时4个字节，）")])]),a._v(" "),t("h5",{attrs:{id:"分析数组大小-16"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#分析数组大小-16"}},[a._v("#")]),a._v(" 分析数组大小-16")]),a._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("XX"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("UseCompressedClassPointers")]),a._v("\n")])])]),t("ol",[t("li",[a._v("对象头"),t("code",[a._v("markword")]),a._v("占8个字节")]),a._v(" "),t("li",[a._v("class指针"),t("code",[a._v("class pointer")]),a._v("占8个字节，当开启"),t("code",[a._v("-XX:+UseCompressedClassPointers")]),a._v("时，class指针会被压缩成4个字节")]),a._v(" "),t("li",[a._v("数组长度4个字节")]),a._v(" "),t("li",[a._v("padding对齐，0个字节（上面的大小已经时对齐的了，故padding对齐为0个字节）")])]),a._v(" "),t("h5",{attrs:{id:"分析数组大小-24-关闭usecompressedclasspointers"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#分析数组大小-24-关闭usecompressedclasspointers"}},[a._v("#")]),a._v(" 分析数组大小-24（关闭UseCompressedClassPointers）")]),a._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("XX"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("UseCompressedClassPointers")]),a._v("\n")])])]),t("ol",[t("li",[a._v("对象头"),t("code",[a._v("markword")]),a._v("占8个字节")]),a._v(" "),t("li",[a._v("class指针"),t("code",[a._v("class pointer")]),a._v("占8个字节")]),a._v(" "),t("li",[a._v("数组长度4个字节")]),a._v(" "),t("li",[a._v("padding对齐，4个字节")])]),a._v(" "),t("h5",{attrs:{id:"分析对象大小-带属性的对象"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#分析对象大小-带属性的对象"}},[a._v("#")]),a._v(" 分析对象大小（带属性的对象）")]),a._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("private")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("static")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("P")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    \t\t\t   "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//8 _markword")]),a._v("\n    \t\t\t   "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//4 _oop指针")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),a._v(" id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("         "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//4")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("String")]),a._v(" name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//4（引用类型默认占用8个字节，当开启-XX:+UseCompressedOops时会被压缩成4个字节）")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),a._v(" age"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("        "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//4")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("byte")]),a._v(" b1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("        "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//1")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("byte")]),a._v(" b2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("        "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//1")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Object")]),a._v(" o"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("       "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//4")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("byte")]),a._v(" b3"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("        "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//1")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),t("blockquote",[t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Oops")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" ordinary object pointers（普通对象指针）\n")])])])]),a._v(" "),t("ol",[t("li",[a._v("引用类型占用大小：默认为8个字节，当开启"),t("code",[a._v("-XX:+UseCompressedOops")]),a._v("时会被压缩成4个字节。")])]),a._v(" "),t("h2",{attrs:{id:"java运行时数据区"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#java运行时数据区"}},[a._v("#")]),a._v(" Java运行时数据区")]),a._v(" "),t("p",[t("img",{attrs:{src:"/images/Java%E8%BF%90%E8%A1%8C%E6%97%B6%E6%95%B0%E6%8D%AE%E5%8C%BA.png",alt:"Java运行时数据区"}})]),a._v(" "),t("h3",{attrs:{id:"_1-program-counter-pc程序计数器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-program-counter-pc程序计数器"}},[a._v("#")]),a._v(" 1. Program Counter：PC程序计数器")]),a._v(" "),t("p",[a._v("存放下一条指令位置的内存区域")]),a._v(" "),t("p",[a._v("虚拟机的运行，类似于这样的循环：")]),a._v(" "),t("p",[a._v("while( not end ){")]),a._v(" "),t("p",[a._v("取PC中的位置，找到对应位置的指令；")]),a._v(" "),t("p",[a._v("执行该指令；")]),a._v(" "),t("p",[a._v("PC++；")]),a._v(" "),t("p",[a._v("}")]),a._v(" "),t("h3",{attrs:{id:"_2-jvm-stack"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-jvm-stack"}},[a._v("#")]),a._v(" 2. JVM Stack")]),a._v(" "),t("p",[a._v("JVM虚拟机管理的栈")]),a._v(" "),t("p",[a._v("自己的方法对应的栈帧，"),t("strong",[a._v("每个线程对应一个栈，每个方法对应一个栈帧。")])]),a._v(" "),t("h4",{attrs:{id:"栈帧frame包含的内容"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#栈帧frame包含的内容"}},[a._v("#")]),a._v(" 栈帧Frame包含的内容")]),a._v(" "),t("ol",[t("li",[t("p",[a._v("Local Variables：本地变量（局部变量）")])]),a._v(" "),t("li",[t("p",[a._v("Operand Stacks：操作数栈")]),a._v(" "),t("p",[a._v("对于long的处理（store and load），多数虚拟机的实现都是原子的，JLS17.7，没有必要加volatile")])]),a._v(" "),t("li",[t("p",[a._v("Dynamic Linking：动态链接")]),a._v(" "),t("p",[a._v("https://blog.csdn.net/qq_41813060/article/details/88379473")]),a._v(" "),t("p",[a._v("jvms 2.6.3")]),a._v(" "),t("p",[a._v("运行时常量池里面的符号链接。如果没有解析，就动态解析；如果已经解析了，就直接使用。")])]),a._v(" "),t("li",[t("p",[a._v("Return Address：a()->b()，方法a调用了方法b()，b方法的返回值放在什么地方。")])])]),a._v(" "),t("h3",{attrs:{id:"_3-native-method-stacks"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-native-method-stacks"}},[a._v("#")]),a._v(" 3. Native Method Stacks")]),a._v(" "),t("p",[a._v("本地方法栈，一般使用C\\C++写的，或者通过JNI调用Java自己的方法，一般涉及不到，也没法调优，没有办法去管理它。")]),a._v(" "),t("h3",{attrs:{id:"_4-direct-memory"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-direct-memory"}},[a._v("#")]),a._v(" 4. Direct Memory")]),a._v(" "),t("p",[a._v("直接内存：NIO。Java的内存一般是由JVM管理的，但是为了增加性能，在JDK1.4之后，增加了NIO，可以直接访问操作系统的内存的，这部分内存归操作系统进行管理。Zero Copy！！！")]),a._v(" "),t("h3",{attrs:{id:"_5-method-area-逻辑的概念"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-method-area-逻辑的概念"}},[a._v("#")]),a._v(" 5. Method Area：逻辑的概念")]),a._v(" "),t("blockquote",[t("p",[a._v("思考：如何证明1.7字符串常量位于Perm，而1.8位于Heap?")]),a._v(" "),t("p",[a._v("提示：结合GC，一直创建字符常量，观察堆和MetaSpace的情况。")])]),a._v(" "),t("h4",{attrs:{id:"perm-space-1-8"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#perm-space-1-8"}},[a._v("#")]),a._v(" Perm Space（<1.8）")]),a._v(" "),t("ol",[t("li",[a._v("字符串常量位于Perm Space")]),a._v(" "),t("li",[a._v("FGC不会清理")]),a._v(" "),t("li",[a._v("大小启动的时候指定，不能变")])]),a._v(" "),t("h4",{attrs:{id:"meta-space-1-8"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#meta-space-1-8"}},[a._v("#")]),a._v(" Meta Space（>1.8）")]),a._v(" "),t("ol",[t("li",[a._v("字符串常量位于堆")]),a._v(" "),t("li",[a._v("会触发FGC清理")]),a._v(" "),t("li",[a._v("不设定的话，最大就是物理内存")])]),a._v(" "),t("h3",{attrs:{id:"_6-run-time-constant-pool"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-run-time-constant-pool"}},[a._v("#")]),a._v(" 6. Run-Time Constant Pool")]),a._v(" "),t("p",[a._v("class字节码中的常量池存放在这里")]),a._v(" "),t("h3",{attrs:{id:"_7-heap"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_7-heap"}},[a._v("#")]),a._v(" 7. Heap")]),a._v(" "),t("p",[a._v("堆内存")]),a._v(" "),t("h3",{attrs:{id:"_8-总结-线程共享区域"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_8-总结-线程共享区域"}},[a._v("#")]),a._v(" 8.总结：线程共享区域")]),a._v(" "),t("p",[t("img",{attrs:{src:"/images/%E7%BA%BF%E7%A8%8B%E5%85%B1%E4%BA%AB%E6%95%B0%E6%8D%AE%E5%8C%BA.png",alt:"线程共享数据区"}})]),a._v(" "),t("h2",{attrs:{id:"jvm常用指令集"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#jvm常用指令集"}},[a._v("#")]),a._v(" JVM常用指令集")]),a._v(" "),t("blockquote",[t("ol",[t("li",[a._v("基于栈的指令集")]),a._v(" "),t("li",[a._v("基于寄存器的指令集（hotspot的local variable table类似于寄存器）")])])]),a._v(" "),t("h3",{attrs:{id:"_1-示例性demo"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-示例性demo"}},[a._v("#")]),a._v(" 1. 示例性demo")]),a._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("TestIPulsPlus")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("static")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("void")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("main")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" args"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),a._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("8")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        i "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" i"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("++")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//        i = ++i;")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n输出结果：\n"),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("8")]),a._v("\n字节码如下：\n "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v(" bipush "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("8")]),a._v("\t\t\t\t\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 8压栈")]),a._v("\n "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v(" istore_1\t\t\t\t\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 把栈顶上的值出栈，放在局部变量表中下标为1的位置")]),a._v("\n "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("3")]),a._v(" iload_1\t\t\t\t\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 把局部变量表下标为1位置上的值压栈")]),a._v("\n "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("4")]),a._v(" iinc "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v(" by "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v("\t\t\t\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 把局部变量表下标为1上的数+1")]),a._v("\n "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("7")]),a._v(" istore_1\t\t\t\t\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 把栈顶上的值出栈，放在局部变量表中下标为1的位置")]),a._v("\n "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("8")]),a._v(" getstatic #"),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("java"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("lang"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("out"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("11")]),a._v(" iload_1\n"),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("12")]),a._v(" invokevirtual #"),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("3")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("java"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("io"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("PrintStream")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("println"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("15")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v("\n")])])]),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("TestIPulsPlus")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("static")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("void")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("main")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" args"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),a._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("8")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//        i = i++;")]),a._v("\n        i "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("++")]),a._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n输出结果：\n"),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("9")]),a._v("\n字节码如下：\n "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v(" bipush "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("8")]),a._v("\t\t\t\t\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 8压栈")]),a._v("\n "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v(" istore_1\t\t\t\t\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 把栈顶上的值出栈，放在局部变量表中下标为1的位置")]),a._v("\n "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("3")]),a._v(" iinc "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v(" by "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v("\t\t\t\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 把局部变量表下标为1上的数+1")]),a._v("\n "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("6")]),a._v(" iload_1\t\t\t\t\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 把局部变量表下标为1位置上的值压栈")]),a._v("\n "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("7")]),a._v(" istore_1\t\t\t\t\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 把栈顶上的值出栈，放在局部变量表中下标为1的位置")]),a._v("\n "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("8")]),a._v(" getstatic #"),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("java"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("lang"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("out"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("11")]),a._v(" iload_1\n"),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("12")]),a._v(" invokevirtual #"),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("3")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("java"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("io"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("PrintStream")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("println"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("15")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v("\n")])])]),t("blockquote",[t("p",[a._v("非静态方法的第一个局部变量表存储的是this。")])]),a._v(" "),t("h3",{attrs:{id:"_2-常用指令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-常用指令"}},[a._v("#")]),a._v(" 2. 常用指令")]),a._v(" "),t("ol",[t("li",[a._v("iadd：弹出两个int类型的数据执行相加，然后把结果入栈顶")]),a._v(" "),t("li",[a._v("new：在堆内存构造一个对象(默认值)，对象地址会压栈，")]),a._v(" "),t("li",[a._v("dup：复制对象地址放在栈顶，")]),a._v(" "),t("li",[a._v("invokeSpecial：执行特殊的方法：可以直接定位的，不需要多态的方法，"),t("init",[a._v("和private的方法。当执行构造方法时会把栈顶的对象地址弹出，然后调用构造方法并赋值给堆里面的具体对象，此时这个对象才算时构造完成。此时栈里面仍然有一个指向堆对象地址的值。")])],1),a._v(" "),t("li",[a._v("invokeVirtual：调用对象的具体方法")]),a._v(" "),t("li",[a._v("invokeStatic：调用具体的静态方法")]),a._v(" "),t("li",[a._v("invokeInterface：通过接口调用的方法")]),a._v(" "),t("li",[a._v("invokeDynamic：Lambda表达式，反射，其他动态语言scala、kotlin，Cglib，ASM，动态产生的calss会用到的指令。")]),a._v(" "),t("li",[a._v("pop：弹出栈顶的值扔掉")]),a._v(" "),t("li",[a._v("if_icmpne n：比较，如果不等，则跳到n的位置继续执行")]),a._v(" "),t("li",[t("init",[a._v("：构造方法")])],1),a._v(" "),t("li",[t("clinit",[a._v("：静态语句块")])],1)]),a._v(" "),t("p",[t("img",{attrs:{src:"/images/%E5%B8%B8%E7%94%A8%E6%8C%87%E4%BB%A4%E7%BB%83%E4%B9%A0.png",alt:"常用指令练习"}})]),a._v(" "),t("p",[t("img",{attrs:{src:"/images/%E9%80%92%E5%BD%92%E8%B0%83%E7%94%A8%E7%9A%84%E6%96%B9%E6%B3%95%E6%A0%88%E5%B8%A7.png",alt:"递归调用的方法栈帧"}})]),a._v(" "),t("h2",{attrs:{id:"jvm调优理论"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#jvm调优理论"}},[a._v("#")]),a._v(" JVM调优理论")]),a._v(" "),t("h3",{attrs:{id:"_1-垃圾"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-垃圾"}},[a._v("#")]),a._v(" 1. 垃圾")]),a._v(" "),t("blockquote",[t("p",[a._v("没有引用指向的任何对象就叫做垃圾")])]),a._v(" "),t("p",[t("strong",[a._v("Java VS C++：")])]),a._v(" "),t("ul",[t("li",[a._v("Java\n"),t("ol",[t("li",[a._v("GC处理垃圾")]),a._v(" "),t("li",[a._v("开发效率高，执行效率低")])])]),a._v(" "),t("li",[a._v("C++\n"),t("ol",[t("li",[a._v("手工处理垃圾")]),a._v(" "),t("li",[a._v("忘记回收\n"),t("ul",[t("li",[a._v("内存泄漏")])])]),a._v(" "),t("li",[a._v("回收多次\n"),t("ul",[t("li",[a._v("非法访问")])])]),a._v(" "),t("li",[a._v("开发效率低，执行效率高")])])])]),a._v(" "),t("h3",{attrs:{id:"_2-垃圾定位算法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-垃圾定位算法"}},[a._v("#")]),a._v(" 2. 垃圾定位算法")]),a._v(" "),t("h4",{attrs:{id:"_1-引用计数-reference-count"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-引用计数-reference-count"}},[a._v("#")]),a._v(" 1. 引用计数：reference count")]),a._v(" "),t("blockquote",[t("p",[a._v("没有引用指向它的时候，就是垃圾；不能解决循环引用的问题")])]),a._v(" "),t("h4",{attrs:{id:"_2-根可达算法-root-searching"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-根可达算法-root-searching"}},[a._v("#")]),a._v(" "),t("font",{attrs:{color:"red"}},[a._v("2. 根可达算法：root searching")])],1),a._v(" "),t("blockquote",[t("p",[a._v("从根对象开始寻找，不能被引用到的对象就是垃圾")])]),a._v(" "),t("p",[t("img",{attrs:{src:"/images/%E6%A0%B9%E5%8F%AF%E8%BE%BE%E7%AE%97%E6%B3%95.png",alt:"根可达算法"}})]),a._v(" "),t("p",[a._v("根对象种类：")]),a._v(" "),t("ol",[t("li",[a._v("main方法开始执行时的线程栈的变量")]),a._v(" "),t("li",[a._v("静态变量")]),a._v(" "),t("li",[a._v("常量池引用的对象")]),a._v(" "),t("li",[a._v("JNI指针，调用C/C++方法引用的对象")])]),a._v(" "),t("p",[a._v("换句话说：")]),a._v(" "),t("ol",[t("li",[a._v("jvm stack")]),a._v(" "),t("li",[a._v("native method")]),a._v(" "),t("li",[a._v("run-time constant pool")]),a._v(" "),t("li",[a._v("static references in method area")]),a._v(" "),t("li",[a._v("Clazz")])]),a._v(" "),t("h3",{attrs:{id:"_3-垃圾回收算法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-垃圾回收算法"}},[a._v("#")]),a._v(" "),t("font",{attrs:{color:"red"}},[a._v("3. 垃圾回收算法")])],1),a._v(" "),t("h4",{attrs:{id:"_1-mark-sweep-标记清除"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-mark-sweep-标记清除"}},[a._v("#")]),a._v(" 1. Mark-Sweep（标记清除）")]),a._v(" "),t("p",[t("img",{attrs:{src:"/images/%E5%9E%83%E5%9C%BE%E5%AE%9A%E4%BD%8D%E7%AE%97%E6%B3%95-%E6%A0%87%E8%AE%B0%E6%B8%85%E9%99%A4%E7%AE%97%E6%B3%95.png",alt:"垃圾定位算法-标记清除算法"}})]),a._v(" "),t("p",[a._v("优点：")]),a._v(" "),t("ul",[t("li",[a._v("直接把标记为垃圾的对象清空即可，算法比较简单")]),a._v(" "),t("li",[a._v("当存活对象比较多的情况下，效率比较高")])]),a._v(" "),t("p",[a._v("缺点：")]),a._v(" "),t("ul",[t("li",[a._v("需要经过两次扫描（第一遍标记，第二遍清除），执行效率偏低")]),a._v(" "),t("li",[a._v("容易产生碎片")])]),a._v(" "),t("h4",{attrs:{id:"_2-copying-拷贝"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-copying-拷贝"}},[a._v("#")]),a._v(" 2. Copying（拷贝）")]),a._v(" "),t("p",[t("img",{attrs:{src:"/images/%E5%9E%83%E5%9C%BE%E5%AE%9A%E4%BD%8D%E7%AE%97%E6%B3%95-%E6%8B%B7%E8%B4%9D%E6%B8%85%E9%99%A4%E7%AE%97%E6%B3%95.png",alt:"垃圾定位算法-拷贝清除算法"}})]),a._v(" "),t("p",[a._v("优点：")]),a._v(" "),t("ul",[t("li",[a._v("适用于存活对象较少的情况")]),a._v(" "),t("li",[a._v("只扫描一次，效率提高")]),a._v(" "),t("li",[a._v("没有碎片")])]),a._v(" "),t("p",[a._v("缺点：")]),a._v(" "),t("ul",[t("li",[a._v("空间浪费")]),a._v(" "),t("li",[a._v("移动复制对象")]),a._v(" "),t("li",[a._v("需要调整对象引用")])]),a._v(" "),t("h4",{attrs:{id:"_3-mark-compact-标记压缩"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-mark-compact-标记压缩"}},[a._v("#")]),a._v(" 3. Mark-Compact（标记压缩）")]),a._v(" "),t("p",[t("img",{attrs:{src:"/images/%E5%9E%83%E5%9C%BE%E5%AE%9A%E4%BD%8D%E7%AE%97%E6%B3%95-%E6%A0%87%E8%AE%B0%E5%8E%8B%E7%BC%A9%E7%AE%97%E6%B3%95.png",alt:"垃圾定位算法-标记压缩算法"}})]),a._v(" "),t("p",[a._v("优点：")]),a._v(" "),t("ul",[t("li",[a._v("不会产生碎片，")]),a._v(" "),t("li",[a._v("方便对象分配")]),a._v(" "),t("li",[a._v("不会产生内存减半")])]),a._v(" "),t("p",[a._v("缺点：")]),a._v(" "),t("ul",[t("li",[a._v("扫描两次")]),a._v(" "),t("li",[a._v("需要移动对象")]),a._v(" "),t("li",[a._v("执行效率偏低")])]),a._v(" "),t("h3",{attrs:{id:"_4-jvm内存分代模型"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-jvm内存分代模型"}},[a._v("#")]),a._v(" 4. JVM内存分代模型")]),a._v(" "),t("blockquote",[t("p",[a._v("用于分代垃圾回收算法")])]),a._v(" "),t("p",[t("img",{attrs:{src:"/images/%E5%A0%86%E5%86%85%E5%AD%98%E9%80%BB%E8%BE%91%E5%88%86%E5%8C%BA.png",alt:"堆内存逻辑分区"}})]),a._v(" "),t("h4",{attrs:{id:"_1-部分垃圾回收器使用的模型"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-部分垃圾回收器使用的模型"}},[a._v("#")]),a._v(" 1. 部分垃圾回收器使用的模型")]),a._v(" "),t("ol",[t("li",[a._v("不分代模型\n"),t("ul",[t("li",[a._v("Epsilon（用于做调试用的，起到一个占位符的作用）")]),a._v(" "),t("li",[a._v("ZGC")]),a._v(" "),t("li",[a._v("Shenandoah")])])]),a._v(" "),t("li",[a._v("逻辑分代，物理不分代\n"),t("ul",[t("li",[a._v("G1")])])]),a._v(" "),t("li",[a._v("逻辑分代，物理也分代\n"),t("ul",[t("li",[a._v("其他")])])])]),a._v(" "),t("h4",{attrs:{id:"_2-新生代-老年代"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-新生代-老年代"}},[a._v("#")]),a._v(" 2. 新生代 + 老年代 +")]),a._v(" "),t("blockquote",[t("p",[a._v("永久代（1.7）Perm Generation/元数据区（1.8）Metaspace")])]),a._v(" "),t("ol",[t("li",[a._v("永久代：元数据-Class")]),a._v(" "),t("li",[a._v("永久代必须制定大小限制，元数据可以设置，也可以不设置，无上限（受限于物理内存）")]),a._v(" "),t("li",[a._v("字符串常量1.7 永久代，1.8在堆")]),a._v(" "),t("li",[a._v("Method Area逻辑概念：永久代、元数据")])]),a._v(" "),t("h4",{attrs:{id:"_3-新生代-eden-2个suvivor区"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-新生代-eden-2个suvivor区"}},[a._v("#")]),a._v(" 3. 新生代 = Eden + 2个suvivor区")]),a._v(" "),t("ol",[t("li",[a._v("YGC回收之后，大多数的对象会被回收，或者的进入s0")]),a._v(" "),t("li",[a._v("再次YGC，活着的对象 Eden + s0 -> s1")]),a._v(" "),t("li",[a._v("再次YGC，Eden + s1 -> s0")]),a._v(" "),t("li",[a._v("年龄足够 -> 老年代（15 CMS 6）")]),a._v(" "),t("li",[a._v("s区装不下 -> 老年代")])]),a._v(" "),t("h4",{attrs:{id:"_4-老年代"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-老年代"}},[a._v("#")]),a._v(" 4. 老年代")]),a._v(" "),t("ol",[t("li",[a._v("顽固分子")]),a._v(" "),t("li",[a._v("老年代满了 FGC（Full GC）")])]),a._v(" "),t("h4",{attrs:{id:"_5-gc-teunring-generation"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-gc-teunring-generation"}},[a._v("#")]),a._v(" 5. GC Teunring（Generation）")]),a._v(" "),t("p",[t("img",{attrs:{src:"/images/GC%E6%A6%82%E5%BF%B5.png",alt:"GC概念"}})]),a._v(" "),t("ol",[t("li",[a._v("尽量减少FGC")]),a._v(" "),t("li",[a._v("MinorGC = YGC：在年轻代空间耗尽时触发：-Xmn")]),a._v(" "),t("li",[a._v("MajorGC = FGC：在老年代无法继续分配空间时触发，新生代老年代同时进行回收：-Xms  -Xmx")])]),a._v(" "),t("h4",{attrs:{id:"_6-一个对象从出生到消亡的历程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-一个对象从出生到消亡的历程"}},[a._v("#")]),a._v(" 6. 一个对象从出生到消亡的历程")]),a._v(" "),t("p",[t("img",{attrs:{src:"/images/%E4%B8%80%E4%B8%AA%E5%AF%B9%E8%B1%A1%E4%BB%8E%E5%87%BA%E7%94%9F%E5%88%B0%E6%B6%88%E4%BA%A1%E7%9A%84%E5%8E%86%E7%A8%8B.png",alt:"一个对象从出生到消亡的历程"}})]),a._v(" "),t("ul",[t("li",[a._v("栈上分配\n"),t("ul",[t("li",[a._v("线程私有小对象")]),a._v(" "),t("li",[a._v("无逃逸（就在这段代码中使用，出了这段代码，就没有人认识它了）")]),a._v(" "),t("li",[a._v("支持标量替换（用普通的属性代替整个对象）")]),a._v(" "),t("li",[a._v("无需调整")])])]),a._v(" "),t("li",[a._v("线程本地分配TLAB（Thread Local Allocation Buffer）\n"),t("ul",[t("li",[a._v("占用eden，默认1%")]),a._v(" "),t("li",[a._v("多线程的时候不用竞争eden就可以申请空间，提高效率")]),a._v(" "),t("li",[a._v("小对象")]),a._v(" "),t("li",[a._v("无需调整")])])]),a._v(" "),t("li",[a._v("老年代\n"),t("ul",[t("li",[a._v("大对象")])])]),a._v(" "),t("li",[a._v("eden")])]),a._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//-XX:-DoEscapeAnalysis -XX:-EliminateAllocations -XX:-UseTLAB -Xlog:c5_gc*")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 逃逸分析 标量替换 线程专有对象分配")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("TestTLAB")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//User u;")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("User")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),a._v(" id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("String")]),a._v(" name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("User")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),a._v(" id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("String")]),a._v(" name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("id "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("name "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("void")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("alloc")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),a._v(" i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("User")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"name "')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),a._v(" i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("static")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("void")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("main")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" args"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("TestTLAB")]),a._v(" t "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("TestTLAB")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("long")]),a._v(" start "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("currentTimeMillis")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("for")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),a._v(" i"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" i"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1000_0000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" i"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("++")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n            t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("alloc")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("long")]),a._v(" end "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("currentTimeMillis")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("end "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v(" start"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//for(;;);")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n\n")])])]),t("h4",{attrs:{id:"_7-对象分配过程图"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_7-对象分配过程图"}},[a._v("#")]),a._v(" 7. 对象分配过程图")]),a._v(" "),t("p",[t("img",{attrs:{src:"/images/%E5%AF%B9%E8%B1%A1%E5%88%86%E9%85%8D%E8%BF%87%E7%A8%8B%E8%AF%A6%E8%A7%A3.png",alt:"对象分配过程详解"}})]),a._v(" "),t("ul",[t("li",[a._v("动态年龄：\n"),t("ul",[t("li",[a._v("https://www.jianshu.com/p/989d3b06a49d")])])]),a._v(" "),t("li",[a._v("分配担保：\n"),t("ul",[t("li",[a._v("YGC期间 survivor区空间不够了 空间担保直接进入老年代")]),a._v(" "),t("li",[a._v("https://cloud.tencent.com/developer/article/1082730")])])])]),a._v(" "),t("h4",{attrs:{id:"_8-常用jvm参数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_8-常用jvm参数"}},[a._v("#")]),a._v(" 8. 常用JVM参数")]),a._v(" "),t("ul",[t("li",[t("p",[a._v("-XX:-DoEscapeAnalysis：逃逸分析")])]),a._v(" "),t("li",[t("p",[a._v("-XX:-EliminateAllocations：标量替换")])]),a._v(" "),t("li",[t("p",[a._v("-XX:-UseTLAB：线程专有对象分配")])]),a._v(" "),t("li",[t("p",[a._v("-XX:MaxTenuringThreshold：s0-s1之间的复制年龄（YGC次数）超过限制，进入old区的参数；")]),a._v(" "),t("ul",[t("li",[t("p",[a._v("对象头的分代年龄是4bit，最大值是15")])]),a._v(" "),t("li",[t("p",[a._v("如果不指定，Parallel Scavenge 默认值15")])]),a._v(" "),t("li",[t("p",[a._v("如果不指定，CMS 默认6")])]),a._v(" "),t("li",[t("p",[a._v("如果不指定，G1 默认15")])]),a._v(" "),t("li",[t("p",[a._v("动态年龄：s0比s1超过50%时，把年龄最大的放入old区。（年龄1的占用了33%，年龄2的占用了33%，累加和超过默认的TargetSurvivorRatio（50%），年龄2和年龄3的对象都要晋升到老年代）")]),a._v(" "),t("p",[a._v("https://www.jianshu.com/p/989d3b06a49d")])])])]),a._v(" "),t("li",[t("p",[a._v("-Xmn：年轻代内存大小设置")])]),a._v(" "),t("li",[t("p",[a._v("-Xms：老年代内存的最小值")])]),a._v(" "),t("li",[t("p",[a._v("-Xmx：老年代内存的最大值")])])]),a._v(" "),t("blockquote",[t("ul",[t("li",[a._v("命令行输入java：以横杠开头的命令是标准参数，所有java版本都支持")]),a._v(" "),t("li",[a._v("命令行输入java -X：非标准参数")]),a._v(" "),t("li",[a._v("命令行输入java -XX：不稳定参数，有些版本支持这个参数，有些版本支持那个参数，有些版本根本就不支持")]),a._v(" "),t("li",[a._v("命令行输入java -XX:+PrintFlagsFinal -version，得到所有的参数列表，在linux上可以在后面追加 | grep xxx进行搜索")])])]),a._v(" "),t("h2",{attrs:{id:"常见垃圾回收器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#常见垃圾回收器"}},[a._v("#")]),a._v(" "),t("font",{attrs:{color:"red"}},[a._v("常见垃圾回收器")])],1),a._v(" "),t("p",[t("img",{attrs:{src:"/images/%E5%B8%B8%E7%94%A8%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E5%99%A8.png",alt:"常用垃圾回收器"}})]),a._v(" "),t("blockquote",[t("p",[a._v("JDK诞生Serial追随；为了在多线程的情况下提高效率，诞生了Parallel Scavenge（PS）；为了配合CMS，诞生了ParNew（PN）；CMS是1.4版本后期引入，CMS是里程碑式的GC，它开启了并发回收的过程，但是CMS毛病较多，因此目前任何一个JDK版本默认是CMS。并发垃圾回收是因为无法忍受STW（stop the work）。")])]),a._v(" "),t("blockquote",[t("p",[a._v("常见的垃圾回收器的组合：")]),a._v(" "),t("ol",[t("li",[a._v("Serial + Serial Old")]),a._v(" "),t("li",[a._v("Parallel Scavenge + Parallel Old")]),a._v(" "),t("li",[a._v("ParNew  + CMS")])])]),a._v(" "),t("h3",{attrs:{id:"_1-serial-年轻代"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-serial-年轻代"}},[a._v("#")]),a._v(" 1. Serial 年轻代")]),a._v(" "),t("blockquote",[t("p",[a._v("串行回收（单进程 单线程）")])]),a._v(" "),t("p",[t("img",{attrs:{src:"/images/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E5%99%A8-Serial.png",alt:"垃圾回收器-Serial"}})]),a._v(" "),t("h3",{attrs:{id:"_2-serial-old-老年代"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-serial-old-老年代"}},[a._v("#")]),a._v(" 2. Serial Old 老年代")]),a._v(" "),t("blockquote",[t("p",[a._v("串行回收（单进程 单线程）")])]),a._v(" "),t("p",[a._v("![垃圾回收器-Serial Old](/images/垃圾回收器-Serial Old.png)")]),a._v(" "),t("h3",{attrs:{id:"_3-parallel-scavenge-年轻代"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-parallel-scavenge-年轻代"}},[a._v("#")]),a._v(" 3. Parallel Scavenge 年轻代")]),a._v(" "),t("blockquote",[t("p",[a._v("并行回收（多线程）")])]),a._v(" "),t("p",[a._v("![垃圾回收器-Parallel Scavenge](/images/垃圾回收器-Parallel Scavenge.png)")]),a._v(" "),t("h3",{attrs:{id:"_4-parallel-old-老年代"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-parallel-old-老年代"}},[a._v("#")]),a._v(" 4. Parallel Old 老年代")]),a._v(" "),t("blockquote",[t("p",[a._v("并行回收（多线程）")])]),a._v(" "),t("p",[a._v("![垃圾回收器-Parallel Old](/images/垃圾回收器-Parallel Old.png)")]),a._v(" "),t("h3",{attrs:{id:"_5-parnew-年轻代"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-parnew-年轻代"}},[a._v("#")]),a._v(" 5. ParNew 年轻代")]),a._v(" "),t("blockquote",[t("p",[a._v("配合CMS的并行回收（Parallel Scavenge的变种，为了和CMS配合）")])]),a._v(" "),t("p",[t("img",{attrs:{src:"/images/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E5%99%A8-ParNew.png",alt:"垃圾回收器-ParNew"}})]),a._v(" "),t("p",[a._v("Parallel Scavenge 和 ParNew 的区别：")]),a._v(" "),t("ul",[t("li",[a._v("ParNew 响应时间有限，配合CMS")]),a._v(" "),t("li",[a._v("Parallel Scavenge 吞吐量优先")])]),a._v(" "),t("p",[a._v("https://docs.oracle.com/en/java/javase/13/gctuning/ergonomics.html#GUID-3D0BB91E-9BFF-4EBB-B523-14493A860E73")]),a._v(" "),t("h3",{attrs:{id:"_6-cms-老年代"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-cms-老年代"}},[a._v("#")]),a._v(" 6. CMS 老年代")]),a._v(" "),t("blockquote",[t("p",[a._v("ConcurrentMarkSweep 老年代 并发的， 垃圾回收和应用程序同时运行，降低STW的时间(200ms)\nCMS问题比较多，所以现在没有一个版本默认是CMS，只能手工指定。")])]),a._v(" "),t("p",[t("img",{attrs:{src:"/images/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E5%99%A8-CMS.png",alt:"垃圾回收器-CMS"}})]),a._v(" "),t("h4",{attrs:{id:"_1-使用的算法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-使用的算法"}},[a._v("#")]),a._v(" 1. 使用的算法")]),a._v(" "),t("ol",[t("li",[t("p",[a._v("三色标记（白\t灰\t黑）")])]),a._v(" "),t("li",[t("p",[a._v("Incremental Update")]),a._v(" "),t("p",[a._v("当一个白色对象被一个黑色对象引用，将黑色对象重新标记为灰色，让collector重新扫描")])])]),a._v(" "),t("h4",{attrs:{id:"_2-初始标记-stw"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-初始标记-stw"}},[a._v("#")]),a._v(" 2. 初始标记：STW")]),a._v(" "),t("p",[a._v("单线程：找到根对象进行标记")]),a._v(" "),t("h4",{attrs:{id:"_3-并发标记"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-并发标记"}},[a._v("#")]),a._v(" 3. 并发标记")]),a._v(" "),t("p",[a._v("多线程：和应用程序同时运行，进行标记（80%GC的时间都是浪费在这里），一边标记一边会产生新的垃圾")]),a._v(" "),t("h4",{attrs:{id:"_4-重新标记-stw"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-重新标记-stw"}},[a._v("#")]),a._v(" 4. 重新标记：STW")]),a._v(" "),t("p",[a._v("多线程：在并发标记过程中产生的新的垃圾进行重新标记")]),a._v(" "),t("h4",{attrs:{id:"_5-并发清理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-并发清理"}},[a._v("#")]),a._v(" 5. 并发清理")]),a._v(" "),t("p",[a._v("多线程：根据标记的指针进行并行清理，在清理的过程中依然会产生新的垃圾（浮动垃圾，等待下一次GC时进行回收）")]),a._v(" "),t("h4",{attrs:{id:"_6-存在的问题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-存在的问题"}},[a._v("#")]),a._v(" 6. 存在的问题")]),a._v(" "),t("h5",{attrs:{id:"_1-memory-fragmentation-碎片化"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-memory-fragmentation-碎片化"}},[a._v("#")]),a._v(" 1. Memory Fragmentation（碎片化）")]),a._v(" "),t("ol",[t("li",[a._v("-XX:+UseCMSCompactAtFullCollection")]),a._v(" "),t("li",[a._v("-XX:CMSFullGCsBeforeCompaction 默认为0 指的是经过多少次FGC才进行压缩")]),a._v(" "),t("li",[a._v("-XX:CMSInitiatingOccupancyFraction 68%-> 90%（可以降低这个值，让CMS老年代有足够的空间）")])]),a._v(" "),t("p",[a._v("CMS既然是MarkSweep，就一定会有碎片化的问题，碎片到达一定程度，CMS的老年代分配对象分配不下的时候，使用SerialOld 进行老年代回收。")]),a._v(" "),t("h5",{attrs:{id:"_2-floating-garbage-浮动垃圾"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-floating-garbage-浮动垃圾"}},[a._v("#")]),a._v(" 2. Floating Garbage（浮动垃圾）")]),a._v(" "),t("h4",{attrs:{id:"_7-cms日志分析"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_7-cms日志分析"}},[a._v("#")]),a._v(" 7. CMS日志分析")]),a._v(" "),t("h3",{attrs:{id:"_7-g1-10ms"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_7-g1-10ms"}},[a._v("#")]),a._v(" 7. G1（10ms）")]),a._v(" "),t("h4",{attrs:{id:"_1-使用的算法-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-使用的算法-2"}},[a._v("#")]),a._v(" 1. 使用的算法")]),a._v(" "),t("ol",[t("li",[a._v("三色标记（白\t灰\t黑）")]),a._v(" "),t("li",[a._v("STAB\n"),t("ul",[t("li",[a._v("snapshot at the beginning")]),a._v(" "),t("li",[a._v("在起始的时候做一个快照")]),a._v(" "),t("li",[a._v("当B->D消失时，要把这个引用推到GC的堆栈，保证D还能被GC扫描到")])])])]),a._v(" "),t("h3",{attrs:{id:"_8-zgc-1ms-pk-c"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_8-zgc-1ms-pk-c"}},[a._v("#")]),a._v(" 8. ZGC (1ms) PK C++")]),a._v(" "),t("p",[a._v("算法：ColoredPointers + LoadBarrier")]),a._v(" "),t("h3",{attrs:{id:"_9-shenandoah"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_9-shenandoah"}},[a._v("#")]),a._v(" 9. Shenandoah")]),a._v(" "),t("p",[a._v("算法：ColoredPointers + WriteBarrier")]),a._v(" "),t("h3",{attrs:{id:"_10-eplison"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_10-eplison"}},[a._v("#")]),a._v(" 10. Eplison")]),a._v(" "),t("h3",{attrs:{id:"_11-ps-和-pn区别的延伸阅读"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_11-ps-和-pn区别的延伸阅读"}},[a._v("#")]),a._v(" 11. PS 和 PN区别的延伸阅读：")]),a._v(" "),t("p",[a._v("▪"),t("a",{attrs:{href:"https://docs.oracle.com/en/java/javase/13/gctuning/ergonomics.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("https://docs.oracle.com/en/java/javase/13/gctuning/ergonomics.html#GUID-3D0BB91E-9BFF-4EBB-B523-14493A860E73"),t("OutboundLink")],1)]),a._v(" "),t("h3",{attrs:{id:"_12-垃圾收集器跟内存大小的关系"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_12-垃圾收集器跟内存大小的关系"}},[a._v("#")]),a._v(" 12. 垃圾收集器跟内存大小的关系")]),a._v(" "),t("ol",[t("li",[a._v("Serial 几十兆")]),a._v(" "),t("li",[a._v("PS 上百兆 - 几个G")]),a._v(" "),t("li",[a._v("CMS - 20G")]),a._v(" "),t("li",[a._v("G1 - 上百G")]),a._v(" "),t("li",[a._v("ZGC - 4T - 16T（JDK13）")])]),a._v(" "),t("h3",{attrs:{id:"_13-1-8默认的垃圾回收-ps-parallelold"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_13-1-8默认的垃圾回收-ps-parallelold"}},[a._v("#")]),a._v(" 13. 1.8默认的垃圾回收：PS + ParallelOld")]),a._v(" "),t("h2",{attrs:{id:"常见垃圾回收器组合参数设定"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#常见垃圾回收器组合参数设定"}},[a._v("#")]),a._v(" 常见垃圾回收器组合参数设定")]),a._v(" "),t("h3",{attrs:{id:"_1-serial-new-serial-old"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-serial-new-serial-old"}},[a._v("#")]),a._v(" 1. Serial New + Serial Old")]),a._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("XX"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("UseSerialGC")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Serial")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("New")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("DefNew")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Serial")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Old")]),a._v("\n")])])]),t("p",[a._v("小型程序。默认情况下不会是这种选项，HotSpot会根据计算及配置和JDK版本自动选择收集器")]),a._v(" "),t("h3",{attrs:{id:"_2-parnew-serialold"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-parnew-serialold"}},[a._v("#")]),a._v(" 2. ParNew + SerialOld")]),a._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("XX"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("UseParNewGC")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ParNew")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("SerialOld")]),a._v("\n")])])]),t("p",[a._v("这个组合已经很少用（在某些版本中已经废弃）")]),a._v(" "),t("p",[a._v("https://stackoverflow.com/questions/34962257/why-remove-support-for-parnewserialold-anddefnewcms-in-the-future")]),a._v(" "),t("h3",{attrs:{id:"_3-parnew-cms-serial-old"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-parnew-cms-serial-old"}},[a._v("#")]),a._v(" 3. ParNew + CMS + Serial Old")]),a._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("XX"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("UseConc")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("urrent"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("MarkSweepGC")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ParNew")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),a._v(" CMS "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Serial")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Old")]),a._v("\n")])])]),t("h3",{attrs:{id:"_4-parallel-scavenge-parallel-old"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-parallel-scavenge-parallel-old"}},[a._v("#")]),a._v(" 4. Parallel Scavenge + Parallel Old")]),a._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("XX"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("UseParallelGC")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Parallel")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Scavenge")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Parallel")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Old")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1.8")]),a._v("默认"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" 【PS "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("SerialOld")]),a._v("】\n")])])]),t("h3",{attrs:{id:"_5-parallel-scavenge-parallel-old"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-parallel-scavenge-parallel-old"}},[a._v("#")]),a._v(" 5. Parallel Scavenge + Parallel Old")]),a._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("XX"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("UseParallelOldGC")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Parallel")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Scavenge")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Parallel")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Old")]),a._v("\n")])])]),t("h3",{attrs:{id:"_6-g1"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-g1"}},[a._v("#")]),a._v(" 6. G1")]),a._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("XX"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("UseG1GC")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" G1\n")])])]),t("h3",{attrs:{id:"_7-linux中没找到默认gc的查看方法-而windows中会打印useparallelgc"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_7-linux中没找到默认gc的查看方法-而windows中会打印useparallelgc"}},[a._v("#")]),a._v(" 7. Linux中没找到默认GC的查看方法，而windows中会打印UseParallelGC")]),a._v(" "),t("ul",[t("li",[a._v("java +XX:+PrintCommandLineFlags -version")]),a._v(" "),t("li",[a._v("通过GC的日志来分辨")])]),a._v(" "),t("h3",{attrs:{id:"_8-linux下1-8版本默认的垃圾回收器到底是什么"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_8-linux下1-8版本默认的垃圾回收器到底是什么"}},[a._v("#")]),a._v(" 8. Linux下1.8版本默认的垃圾回收器到底是什么？")]),a._v(" "),t("ol",[t("li",[a._v("1.8.0_181 默认（看不出来）Copy MarkCompact")]),a._v(" "),t("li",[a._v("1.8.0_222 默认 PS + PO")])]),a._v(" "),t("h2",{attrs:{id:"jvm调优实战"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#jvm调优实战"}},[a._v("#")]),a._v(" JVM调优实战")]),a._v(" "),t("blockquote",[t("p",[a._v("了解JVM常用命令行参数；JVM的命令行参数参考：https://docs.oracle.com/javase/8/docs/technotes/tools/unix/java.html")])]),a._v(" "),t("h3",{attrs:{id:"_1-hotspot参数分类"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-hotspot参数分类"}},[a._v("#")]),a._v(" 1. HotSpot参数分类")]),a._v(" "),t("ul",[t("li",[a._v("标准： - 开头，所有的HotSpot都支持")]),a._v(" "),t("li",[a._v("非标准：-X 开头，特定版本HotSpot支持特定命令")]),a._v(" "),t("li",[a._v("不稳定：-XX 开头，下个版本可能取消")]),a._v(" "),t("li",[a._v("java -version；java -X")])]),a._v(" "),t("h3",{attrs:{id:"_2-demo示例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-demo示例"}},[a._v("#")]),a._v(" 2. demo示例")]),a._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("import")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token namespace"}},[a._v("java"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("util"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")])]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("List")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("import")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token namespace"}},[a._v("java"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("util"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")])]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("LinkedList")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("HelloGC")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("static")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("void")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("main")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" args"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"HelloGC!"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("List")]),a._v(" list "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("LinkedList")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("for")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("byte")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" b "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("byte")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1024")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1024")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n      list"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("add")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("b"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),t("ol",[t("li",[a._v("区分概念：内存泄漏memory leak，内存溢出out of memory")]),a._v(" "),t("li",[a._v("java -XX:+PrintCommandLineFlags HelloGC")]),a._v(" "),t("li",[a._v("java -Xmn10M -Xms40M -Xmx60M -XX:+PrintCommandLineFlags -XX:+PrintGC  HelloGC\nPrintGCDetails PrintGCTimeStamps PrintGCCauses")]),a._v(" "),t("li",[a._v("java -XX:+UseConcMarkSweepGC -XX:+PrintCommandLineFlags HelloGC")]),a._v(" "),t("li",[a._v("java -XX:+PrintFlagsInitial 默认参数值")]),a._v(" "),t("li",[a._v("java -XX:+PrintFlagsFinal 最终参数值")]),a._v(" "),t("li",[a._v("java -XX:+PrintFlagsFinal | grep xxx 找到对应的参数")]),a._v(" "),t("li",[a._v("java -XX:+PrintFlagsFinal -version | grep GC")])]),a._v(" "),t("h3",{attrs:{id:"_3-ps-gc日志详解"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-ps-gc日志详解"}},[a._v("#")]),a._v(" 3. PS GC日志详解")]),a._v(" "),t("blockquote",[t("p",[a._v("每种垃圾回收器的日志格式是不同的！")])]),a._v(" "),t("p",[a._v("PS日志格式")]),a._v(" "),t("p",[t("img",{attrs:{src:"/images/GC%E6%97%A5%E5%BF%97%E8%AF%A6%E8%A7%A3.png",alt:"GC日志详解"}})]),a._v(" "),t("p",[a._v("heap dump部分：")]),a._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[a._v("eden space "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("5632")]),a._v("K"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("94")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("%")]),a._v(" used "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0x00000000ff980000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0x00000000ffeb3e28")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0x00000000fff00000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n                            后面的内存地址指的是，起始地址，使用空间结束地址，整体空间结束地址\n")])])]),t("p",[t("img",{attrs:{src:"/images/GCHeapDump.png",alt:"GCHeapDump"}})]),a._v(" "),t("p",[a._v("total = eden + 1个survivor")]),a._v(" "),t("h3",{attrs:{id:"_4-调优前的基础概念"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-调优前的基础概念"}},[a._v("#")]),a._v(" 4. 调优前的基础概念")]),a._v(" "),t("ol",[t("li",[a._v("吞吐量：用户代码时间 /（用户代码执行时间 + 垃圾回收时间）")]),a._v(" "),t("li",[a._v("响应时间：STW越短，响应时间越好")])]),a._v(" "),t("blockquote",[t("p",[a._v("所谓调优，首先确定，追求啥？吞吐量优先，还是响应时间优先？还是在满足一定的响应时间的情况下，要求达到多大的吞吐量...")])]),a._v(" "),t("p",[a._v("问题：")]),a._v(" "),t("ol",[t("li",[a._v("科学计算，吞吐量。数据挖掘，thrput。吞吐量优先的一般：（PS + PO）")]),a._v(" "),t("li",[a._v("响应时间：网站 GUI API （1.8 G1）")])]),a._v(" "),t("h3",{attrs:{id:"_5-什么是调优"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-什么是调优"}},[a._v("#")]),a._v(" 5. 什么是调优")]),a._v(" "),t("ol",[t("li",[a._v("根据需求进行JVM规划和预调优")]),a._v(" "),t("li",[a._v("优化运行JVM运行环境（慢，卡顿）")]),a._v(" "),t("li",[a._v("解决JVM运行过程中出现的各种问题(OOM)")])]),a._v(" "),t("h3",{attrs:{id:"_6-调优-从规划开始"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-调优-从规划开始"}},[a._v("#")]),a._v(" 6. 调优，从规划开始")]),a._v(" "),t("h2",{attrs:{id:"jvm常见参数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#jvm常见参数"}},[a._v("#")]),a._v(" JVM常见参数")])])}),[],!1,null,null,null);s.default=e.exports}}]);