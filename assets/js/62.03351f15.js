(window.webpackJsonp=window.webpackJsonp||[]).push([[62],{408:function(a,s,e){"use strict";e.r(s);var t=e(42),r=Object(t.a)({},(function(){var a=this,s=a.$createElement,e=a._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[e("h1",{attrs:{id:"k8s最新版安装过程"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#k8s最新版安装过程"}},[a._v("#")]),a._v(" k8s最新版安装过程")]),a._v(" "),e("h2",{attrs:{id:"克隆虚拟机完成之后的操作步骤"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#克隆虚拟机完成之后的操作步骤"}},[a._v("#")]),a._v(" 克隆虚拟机完成之后的操作步骤")]),a._v(" "),e("h3",{attrs:{id:"更改ip"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#更改ip"}},[a._v("#")]),a._v(" 更改IP")]),a._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[a._v("vi")]),a._v(" /etc/sysconfig/network-scripts/ifcfg-ens33\n")])])]),e("h3",{attrs:{id:"更改主机名"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#更改主机名"}},[a._v("#")]),a._v(" 更改主机名")]),a._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[a._v("hostnamectl set-hostname k8s\n")])])]),e("h2",{attrs:{id:"安装kubernetes必备的配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装kubernetes必备的配置"}},[a._v("#")]),a._v(" 安装kubernetes必备的配置")]),a._v(" "),e("h3",{attrs:{id:"关闭交换分区"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#关闭交换分区"}},[a._v("#")]),a._v(" 关闭交换分区")]),a._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[a._v("swapoff -a\n"),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("vi")]),a._v(" /etc/fstab\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#swap一行注释")]),a._v("\n")])])]),e("h3",{attrs:{id:"配置网桥"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#配置网桥"}},[a._v("#")]),a._v(" 配置网桥")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("cat <<EOF >  /etc/sysctl.d/k8s.conf\nnet.bridge.bridge-nf-call-ip6tables = 1\nnet.bridge.bridge-nf-call-iptables = 1\nEOF\nsysctl --system\n")])])]),e("h3",{attrs:{id:"docker-配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#docker-配置"}},[a._v("#")]),a._v(" docker 配置")]),a._v(" "),e("blockquote",[e("p",[a._v("vi /etc/docker/daemon.json")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v('"exec-opts": ["native.cgroupdriver=systemd"]\n"exec-opts": ["native.cgroupdriver=cgroupfs"]\n')])])]),e("p",[a._v("重新加载并重启docker")]),a._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[a._v("systemctl daemon-reload "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&&")]),a._v(" systemctl restart docker\n")])])])]),a._v(" "),e("h3",{attrs:{id:"kubernetes配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#kubernetes配置"}},[a._v("#")]),a._v(" kubernetes配置")]),a._v(" "),e("blockquote",[e("p",[a._v("配置国内阿里云镜像")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("cat > /etc/yum.repos.d/kubernetes.repo << EOF\n[kubernetes]\nname=Kubernetes\nbaseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64\nenabled=1\ngpgcheck=1\nrepo_gpgcheck=1\ngpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg\nEOF\n")])])])]),a._v(" "),e("h3",{attrs:{id:"执行安装"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#执行安装"}},[a._v("#")]),a._v(" 执行安装")]),a._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[a._v("yum "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" -y kubelet kubeadm kubectl\n")])])]),e("h3",{attrs:{id:"设置开机启动"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#设置开机启动"}},[a._v("#")]),a._v(" 设置开机启动")]),a._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[a._v("systemctl "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("enable")]),a._v(" kubelet\n")])])]),e("h3",{attrs:{id:"查看kubelet版本"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#查看kubelet版本"}},[a._v("#")]),a._v(" 查看kubelet版本")]),a._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[a._v("kubelet --version\n")])])]),e("h3",{attrs:{id:"初始化镜像"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#初始化镜像"}},[a._v("#")]),a._v(" 初始化镜像")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("kubeadm init \\\n--apiserver-advertise-address=192.168.21.131 \\\n--image-repository registry.aliyuncs.com/google_containers \\\n--kubernetes-version v1.17.0 \\\n--service-cidr=10.1.0.0/16 \\\n--pod-network-cidr=10.244.0.0/16\n")])])]),e("h3",{attrs:{id:"初始化完成之后，需要执行的命令"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#初始化完成之后，需要执行的命令"}},[a._v("#")]),a._v(" 初始化完成之后，需要执行的命令")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("mkdir -p $HOME/.kube\n  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config\n  sudo chown $(id -u):$(id -g) $HOME/.kube/config\n\n##其他节点加入时需要执行的命令\nkubeadm join 192.168.21.131:6443 --token splv57.agssym1zwow1rljc \\\n    --discovery-token-ca-cert-hash sha256:3d4d8f3cd36e5a317b88dfd941a154188947a9c850fd20eb98791bb43303adb7\n")])])]),e("h3",{attrs:{id:"查看状态"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#查看状态"}},[a._v("#")]),a._v(" 查看状态")]),a._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[a._v("systemctl status kubelet\n")])])]),e("h3",{attrs:{id:"启动kubelet"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#启动kubelet"}},[a._v("#")]),a._v(" 启动kubelet")]),a._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[a._v("systemctl start kubelet\n")])])]),e("h3",{attrs:{id:"导出镜像"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#导出镜像"}},[a._v("#")]),a._v(" 导出镜像")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("docker save > kubernetes.tar registry.aliyuncs.com/google_containers/kube-proxy:v1.17.0 registry.aliyuncs.com/google_containers/kube-apiserver:v1.17.0 registry.aliyuncs.com/google_containers/kube-controller-manager:v1.17.0 registry.aliyuncs.com/google_containers/kube-scheduler:v1.17.0 registry.aliyuncs.com/google_containers/coredns:1.6.5 registry.aliyuncs.com/google_containers/etcd:3.4.3-0 quay.io/coreos/flannel:v0.11.0-amd64 registry.aliyuncs.com/google_containers/pause:3.1\n")])])]),e("h3",{attrs:{id:"加载镜像"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#加载镜像"}},[a._v("#")]),a._v(" 加载镜像")]),a._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[a._v("docker load "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v(" kubernetes.tar\n")])])]),e("h3",{attrs:{id:"节点加入策略忘记的解决方案"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#节点加入策略忘记的解决方案"}},[a._v("#")]),a._v(" 节点加入策略忘记的解决方案")]),a._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[a._v("kubeadm token list\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#拿到TOKEN的值，从新组织命令如下：")]),a._v("\nkubeadm "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("join")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".163.132:6443 --token kqsyfb.o2ks5zl07b7jope --discovery-token-unsafe-skip-ca-verification\n")])])]),e("h3",{attrs:{id:"查看kubecrl状态"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#查看kubecrl状态"}},[a._v("#")]),a._v(" 查看kubecrl状态")]),a._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[a._v("kubectl get nodes\n")])])]),e("h3",{attrs:{id:"查看所有的pod"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#查看所有的pod"}},[a._v("#")]),a._v(" 查看所有的pod")]),a._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[a._v("kubectl get pod --all-namespaces\n")])])]),e("h3",{attrs:{id:"安装flannel网络组件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装flannel网络组件"}},[a._v("#")]),a._v(" 安装flannel网络组件")]),a._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[a._v("wget")]),a._v(" https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml\nkubectl apply -f kube-flannel.yml\n")])])]),e("h3",{attrs:{id:"安装kubernetes-dashboard"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装kubernetes-dashboard"}},[a._v("#")]),a._v(" 安装kubernetes/dashboard")]),a._v(" "),e("blockquote",[e("p",[a._v("下载dashboard配置文件")]),a._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[a._v("wget")]),a._v(" https://raw.githubusercontent.com/kubernetes/dashboard/v2.0.0-beta8/aio/deploy/recommended.yaml\n")])])]),e("p",[a._v("更改配置，让宿主机能访问")]),a._v(" "),e("p",[a._v("vi recommended.yaml")]),a._v(" "),e("div",{staticClass:"language-yaml extra-class"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("kind")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" Service\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("apiVersion")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" v1\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("metadata")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("labels")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n       "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("k8s-app")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" kubernetes"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("dashboard\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" kubernetes"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("dashboard\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("namespace")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" kubernetes"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("dashboard\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("spec")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("type")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" NodePort   "),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#在这个位子添加这一行")]),a._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("ports")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("port")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("443")]),a._v("\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("targetPort")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("8443")]),a._v("\n      "),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# The range of valid ports is 30000-32767")]),a._v("\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("nodePort")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("31001")]),a._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("selector")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("k8s-app")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" kubernetes"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("dashboard\n")])])]),e("p",[a._v("执行")]),a._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[a._v("kubectl apply -f recommended-update.yaml\n")])])]),e("blockquote",[e("p",[a._v("vi dashboard-create-service-account.yaml")]),a._v(" "),e("div",{staticClass:"language-yaml extra-class"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("apiVersion")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" v1\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("kind")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" ServiceAccount\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("metadata")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n     "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" admin"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("user\n     "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("namespace")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" kubernetes"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("dashboard\n")])])])]),a._v(" "),e("blockquote",[e("p",[a._v("vi dashboard-create-cluster-role-binding.yaml")]),a._v(" "),e("div",{staticClass:"language-yaml extra-class"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("apiVersion")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" rbac.authorization.k8s.io/v1\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("kind")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" ClusterRoleBinding\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("metadata")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n     "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" admin"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("user\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("roleRef")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n     "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("apiGroup")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" rbac.authorization.k8s.io\n     "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("kind")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" ClusterRole\n     "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" cluster"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("admin\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("subjects")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("kind")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" ServiceAccount\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" admin"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("user\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("namespace")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" kubernetes"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("dashboard\n")])])])]),a._v(" "),e("p",[a._v("执行安装")]),a._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[a._v("kubectl apply -f dashboard-create-service-account.yaml\nkubectl apply -f dashboard-create-cluster-role-binding.yaml\n")])])]),e("p",[a._v("查看分配的dashboard service对外访问的端口号")]),a._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[a._v("kubectl get svc -n kubernetes-dashboard\n")])])]),e("p",[a._v("通过火狐浏览器访问")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("https://192.168.21.131:31001\n")])])]),e("p",[a._v("选择使用token登录")]),a._v(" "),e("p",[a._v("找到secret中对应的admin-user，然后通过describe查看到对应的token值")]),a._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[a._v("kubectl get secret -n kubernetes-dashboard\n\nkubectl describe secret admin-user-token-5tcsk -n kubernetes-dashboard\n")])])]),e("p",[a._v("即可登录")])])])}),[],!1,null,null,null);s.default=r.exports}}]);