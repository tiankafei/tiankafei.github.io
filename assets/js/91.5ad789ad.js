(window.webpackJsonp=window.webpackJsonp||[]).push([[91],{362:function(a,s,t){"use strict";t.r(s);var e=t(13),r=Object(e.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"k8s集群搭建"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#k8s集群搭建"}},[a._v("#")]),a._v(" k8s集群搭建")]),a._v(" "),s("blockquote",[s("p",[a._v("kubeadm可以帮助你快速部署一套kubernetes集群。kubeadm设计目的为新用户开始尝试kubernetes提供一种简单的方法。不适用于生产环境")])]),a._v(" "),s("p",[s("strong",[a._v("Kubeadm是kubernetes集群快速构建工具")])]),a._v(" "),s("p",[s("strong",[a._v("Kubelet运行在所有节点上，负责启动POD和容器，以系统服务形式出现")])]),a._v(" "),s("p",[s("strong",[a._v("Kubectl是kubernetes命令行工具，提供指令")])]),a._v(" "),s("h2",{attrs:{id:"设置时区"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#设置时区"}},[a._v("#")]),a._v(" 设置时区")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("timedatectl set-timezone Asia/Shanghai\n")])])]),s("h2",{attrs:{id:"检查docker-确保从cgroups均在同一个从groupfs"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#检查docker-确保从cgroups均在同一个从groupfs"}},[a._v("#")]),a._v(" 检查docker：（确保从cgroups均在同一个从groupfs）")]),a._v(" "),s("blockquote",[s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("docker info | grep cgroup\n")])])]),s("p",[a._v("如果不是groupfs,执行下列语句")]),a._v(" "),s("p",[a._v("vim /etc/docker/daemon.json")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('"exec-opts": ["native.cgroupdriver=cgroupfs"]\n')])])]),s("p",[a._v("重新加载并重启docker")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("systemctl daemon-reload && systemctl restart docker\n")])])])]),a._v(" "),s("h2",{attrs:{id:"安装kubeadm"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装kubeadm"}},[a._v("#")]),a._v(" 安装kubeadm")]),a._v(" "),s("blockquote",[s("p",[a._v("kubeadm是集群部署工具")]),a._v(" "),s("p",[a._v("解压上传安装包")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("tar -zxvf kube114-rpm.tar.gz\n")])])]),s("p",[a._v("执行安装")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("cd kube114-rpm\nyum localinstall -y *.rpm\n")])])])]),a._v(" "),s("h2",{attrs:{id:"启动节点命令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#启动节点命令"}},[a._v("#")]),a._v(" 启动节点命令")]),a._v(" "),s("blockquote",[s("p",[a._v("启动节点的k8s服务")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("systemctl start kubelet\n")])])]),s("p",[a._v("设置开机启动")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("systemctl enable kubelet\n")])])]),s("p",[a._v("查看k8s服务状态")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("systemctl status kubelet\n")])])])]),a._v(" "),s("h2",{attrs:{id:"关闭交换区"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#关闭交换区"}},[a._v("#")]),a._v(" 关闭交换区")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("swapoff -a\nvim /etc/fstab\n#swap一行注释\n")])])]),s("h2",{attrs:{id:"配置网桥"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置网桥"}},[a._v("#")]),a._v(" 配置网桥")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("cat <<EOF >  /etc/sysctl.d/k8s.conf\nnet.bridge.bridge-nf-call-ip6tables = 1\nnet.bridge.bridge-nf-call-iptables = 1\nEOF\nsysctl --system\n")])])]),s("h2",{attrs:{id:"加载本地镜像包"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#加载本地镜像包"}},[a._v("#")]),a._v(" 加载本地镜像包")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("docker load -i k8s-114-images.tar.gz\n")])])]),s("h2",{attrs:{id:"加载图形化仪表盘镜像包"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#加载图形化仪表盘镜像包"}},[a._v("#")]),a._v(" 加载图形化仪表盘镜像包")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("docker load -i flannel-dashboard.tar.gz\n")])])]),s("h2",{attrs:{id:"构建master主服务器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#构建master主服务器"}},[a._v("#")]),a._v(" 构建master主服务器")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("kubeadm init --kubernetes-version=v1.14.1 --pod-network-cidr=10.244.0.0/16\n")])])]),s("blockquote",[s("p",[a._v("初始化完成之后，需要执行以下命令")]),a._v(" "),s("p",[a._v("To start using your cluster, you need to run the following as a regular user:")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("mkdir")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token environment constant"}},[a._v("$HOME")]),a._v("/.kube\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("cp")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-i")]),a._v(" /etc/kubernetes/admin.conf "),s("span",{pre:!0,attrs:{class:"token environment constant"}},[a._v("$HOME")]),a._v("/.kube/config\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("chown")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("id")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-u")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("id")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-g")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v(" "),s("span",{pre:!0,attrs:{class:"token environment constant"}},[a._v("$HOME")]),a._v("/.kube/config\n")])])])]),a._v(" "),s("h2",{attrs:{id:"查看kubecrl状态"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查看kubecrl状态"}},[a._v("#")]),a._v(" 查看kubecrl状态")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("kubectl get nodes\n")])])]),s("h2",{attrs:{id:"查看所有的pod"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查看所有的pod"}},[a._v("#")]),a._v(" 查看所有的pod")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("kubectl get pod --all-namespaces\n")])])]),s("h2",{attrs:{id:"安装flannel网络组件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装flannel网络组件"}},[a._v("#")]),a._v(" 安装flannel网络组件")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("kubectl create -f kube-flannel.yml\n")])])]),s("h2",{attrs:{id:"开启webui仪表盘"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#开启webui仪表盘"}},[a._v("#")]),a._v(" 开启WebUI仪表盘")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#")]),a._v("\nkubectl apply "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-f")]),a._v(" kubernetes-dashboard.yaml\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#WebUI的角色")]),a._v("\nkubectl apply "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-f")]),a._v(" admin-role.yaml\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#控制角色的访问权限")]),a._v("\nkubectl apply "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-f")]),a._v(" kubernetes-dashboard-admin.rbac.yaml\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#获取系统命名空间kube-system下的服务有哪些")]),a._v("\nkubectl "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-n")]),a._v(" kube-system get svc\n")])])]),s("p",[a._v("访问地址")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("http://192.168.21.131:32000\n")])])]),s("h2",{attrs:{id:"node节点加入策略"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#node节点加入策略"}},[a._v("#")]),a._v(" node节点加入策略")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("kubeadm join 192.168.21.131:6443 --token kqsyfb.o2ks5zl07b7jopeh \\\n    --discovery-token-ca-cert-hash sha256:b82ce0b05b2091265567337fc6012d12c07f6ae3457dafaccf053f93f2d068ca \n")])])]),s("h2",{attrs:{id:"节点加入策略忘记的解决方案"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#节点加入策略忘记的解决方案"}},[a._v("#")]),a._v(" 节点加入策略忘记的解决方案")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("kubeadm token list\n\n拿到TOKEN的值，从新组织命令如下：\nkubeadm join 192.168.163.132:6443 --token kqsyfb.o2ks5zl07b7jope --discovery-token-unsafe-skip-ca-verification\n")])])])])}),[],!1,null,null,null);s.default=r.exports}}]);