<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Elasticsearch学习笔记 | tiankafei - java相关技术栈</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="自己写的一些东西的记录，包括代码与笔记，jdk最低支持1.8">
    
    <link rel="preload" href="/assets/css/0.styles.992cb7aa.css" as="style"><link rel="preload" href="/assets/js/app.a5877d94.js" as="script"><link rel="preload" href="/assets/js/2.01d54993.js" as="script"><link rel="preload" href="/assets/js/109.b51b5e28.js" as="script"><link rel="prefetch" href="/assets/js/10.58f35d33.js"><link rel="prefetch" href="/assets/js/100.84acf76d.js"><link rel="prefetch" href="/assets/js/101.e221b0fe.js"><link rel="prefetch" href="/assets/js/102.36f7f518.js"><link rel="prefetch" href="/assets/js/103.09a81bba.js"><link rel="prefetch" href="/assets/js/104.e17749cc.js"><link rel="prefetch" href="/assets/js/105.7544910c.js"><link rel="prefetch" href="/assets/js/106.245ef0b3.js"><link rel="prefetch" href="/assets/js/107.b0baa158.js"><link rel="prefetch" href="/assets/js/108.bde0b667.js"><link rel="prefetch" href="/assets/js/11.8b67ea4c.js"><link rel="prefetch" href="/assets/js/110.ac42c960.js"><link rel="prefetch" href="/assets/js/111.9e55c36b.js"><link rel="prefetch" href="/assets/js/112.98e93921.js"><link rel="prefetch" href="/assets/js/113.730f0c75.js"><link rel="prefetch" href="/assets/js/114.cd1c6b8e.js"><link rel="prefetch" href="/assets/js/12.e4797305.js"><link rel="prefetch" href="/assets/js/13.2d85b92c.js"><link rel="prefetch" href="/assets/js/14.2bc1fdb5.js"><link rel="prefetch" href="/assets/js/15.49ea1e69.js"><link rel="prefetch" href="/assets/js/16.9937b620.js"><link rel="prefetch" href="/assets/js/17.fc4b47cc.js"><link rel="prefetch" href="/assets/js/18.e71556ea.js"><link rel="prefetch" href="/assets/js/19.64c8d43a.js"><link rel="prefetch" href="/assets/js/20.94d72ec6.js"><link rel="prefetch" href="/assets/js/21.6e71044d.js"><link rel="prefetch" href="/assets/js/22.4dfd648a.js"><link rel="prefetch" href="/assets/js/23.2735fc15.js"><link rel="prefetch" href="/assets/js/24.96da47ed.js"><link rel="prefetch" href="/assets/js/25.d3a64953.js"><link rel="prefetch" href="/assets/js/26.49ae9931.js"><link rel="prefetch" href="/assets/js/27.ffe2ff7f.js"><link rel="prefetch" href="/assets/js/28.ceee6202.js"><link rel="prefetch" href="/assets/js/29.5b430924.js"><link rel="prefetch" href="/assets/js/3.351222b0.js"><link rel="prefetch" href="/assets/js/30.9c5198e3.js"><link rel="prefetch" href="/assets/js/31.44022a56.js"><link rel="prefetch" href="/assets/js/32.91854b18.js"><link rel="prefetch" href="/assets/js/33.2741799d.js"><link rel="prefetch" href="/assets/js/34.d61e93c3.js"><link rel="prefetch" href="/assets/js/35.d28b7f5d.js"><link rel="prefetch" href="/assets/js/36.b646bfa4.js"><link rel="prefetch" href="/assets/js/37.675752e5.js"><link rel="prefetch" href="/assets/js/38.b25fe369.js"><link rel="prefetch" href="/assets/js/39.4c13b5b3.js"><link rel="prefetch" href="/assets/js/4.09fd2c39.js"><link rel="prefetch" href="/assets/js/40.e43dd47b.js"><link rel="prefetch" href="/assets/js/41.8021272c.js"><link rel="prefetch" href="/assets/js/42.062a57df.js"><link rel="prefetch" href="/assets/js/43.b98eeccd.js"><link rel="prefetch" href="/assets/js/44.07744a1c.js"><link rel="prefetch" href="/assets/js/45.710abf0f.js"><link rel="prefetch" href="/assets/js/46.03d81f06.js"><link rel="prefetch" href="/assets/js/47.71d843a3.js"><link rel="prefetch" href="/assets/js/48.165ad08f.js"><link rel="prefetch" href="/assets/js/49.c3bdf6cb.js"><link rel="prefetch" href="/assets/js/5.b99a1609.js"><link rel="prefetch" href="/assets/js/50.4cdf3914.js"><link rel="prefetch" href="/assets/js/51.23620db1.js"><link rel="prefetch" href="/assets/js/52.61bcfe7b.js"><link rel="prefetch" href="/assets/js/53.7d6c4853.js"><link rel="prefetch" href="/assets/js/54.266352df.js"><link rel="prefetch" href="/assets/js/55.9c7abe31.js"><link rel="prefetch" href="/assets/js/56.cc13690d.js"><link rel="prefetch" href="/assets/js/57.ad23abd1.js"><link rel="prefetch" href="/assets/js/58.b421ad53.js"><link rel="prefetch" href="/assets/js/59.772d89ce.js"><link rel="prefetch" href="/assets/js/6.ffe6f60a.js"><link rel="prefetch" href="/assets/js/60.cac6aca8.js"><link rel="prefetch" href="/assets/js/61.59fc7ed6.js"><link rel="prefetch" href="/assets/js/62.46487051.js"><link rel="prefetch" href="/assets/js/63.0571f56e.js"><link rel="prefetch" href="/assets/js/64.72dabea2.js"><link rel="prefetch" href="/assets/js/65.41225f22.js"><link rel="prefetch" href="/assets/js/66.4e19dd3e.js"><link rel="prefetch" href="/assets/js/67.2f155615.js"><link rel="prefetch" href="/assets/js/68.96903420.js"><link rel="prefetch" href="/assets/js/69.be7e8a2e.js"><link rel="prefetch" href="/assets/js/7.7600938e.js"><link rel="prefetch" href="/assets/js/70.9015f675.js"><link rel="prefetch" href="/assets/js/71.98690377.js"><link rel="prefetch" href="/assets/js/72.121d7122.js"><link rel="prefetch" href="/assets/js/73.4d3a3fac.js"><link rel="prefetch" href="/assets/js/74.011b1551.js"><link rel="prefetch" href="/assets/js/75.c567ff6d.js"><link rel="prefetch" href="/assets/js/76.6334001e.js"><link rel="prefetch" href="/assets/js/77.67ac655a.js"><link rel="prefetch" href="/assets/js/78.281d465d.js"><link rel="prefetch" href="/assets/js/79.c178a2b9.js"><link rel="prefetch" href="/assets/js/8.c1a7f057.js"><link rel="prefetch" href="/assets/js/80.bd7ebfcf.js"><link rel="prefetch" href="/assets/js/81.c34a169b.js"><link rel="prefetch" href="/assets/js/82.3f41273f.js"><link rel="prefetch" href="/assets/js/83.b01cd471.js"><link rel="prefetch" href="/assets/js/84.7cd30602.js"><link rel="prefetch" href="/assets/js/85.0e12ef40.js"><link rel="prefetch" href="/assets/js/86.8d04b4e9.js"><link rel="prefetch" href="/assets/js/87.5a7c4bcd.js"><link rel="prefetch" href="/assets/js/88.73e54d2e.js"><link rel="prefetch" href="/assets/js/89.f514d46f.js"><link rel="prefetch" href="/assets/js/9.af38beaa.js"><link rel="prefetch" href="/assets/js/90.ec244ad8.js"><link rel="prefetch" href="/assets/js/91.1cc77556.js"><link rel="prefetch" href="/assets/js/92.f6881b21.js"><link rel="prefetch" href="/assets/js/93.3ff97c94.js"><link rel="prefetch" href="/assets/js/94.cfade6b9.js"><link rel="prefetch" href="/assets/js/95.84213e8e.js"><link rel="prefetch" href="/assets/js/96.df85149f.js"><link rel="prefetch" href="/assets/js/97.bb0c49a5.js"><link rel="prefetch" href="/assets/js/98.e24468d8.js"><link rel="prefetch" href="/assets/js/99.291b658f.js">
    <link rel="stylesheet" href="/assets/css/0.styles.992cb7aa.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">tiankafei - java相关技术栈</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/tiankafei-docs-java/Java基础.html" class="nav-link">
  Java
</a></div><div class="nav-item"><a href="/tiankafei-docs-spring/spring学习笔记/" class="nav-link">
  Spring
</a></div><div class="nav-item"><a href="/tiankafei-docs-架构/MySQL调优/" class="nav-link">
  架构
</a></div><div class="nav-item"><a href="/tiankafei-docs-大数据/centos7安装配置Hadoop/" class="nav-link">
  大数据
</a></div><div class="nav-item"><a href="/tiankafei-docs-linux/centos常用命令/" class="nav-link">
  Linux
</a></div><div class="nav-item"><a href="/tiankafei-docs-云/Centos7安装Docker并配置使用/" class="nav-link">
  云
</a></div><div class="nav-item"><a href="/tiankafei-docs-other/git命令/" class="nav-link">
  其他
</a></div><div class="nav-item"><a href="/tiankafei-docs-en/词性语法学习/" class="nav-link">
  英语
</a></div><div class="nav-item"><a href="https://github.com/tiankafei/tiankafei" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/tiankafei-docs-java/Java基础.html" class="nav-link">
  Java
</a></div><div class="nav-item"><a href="/tiankafei-docs-spring/spring学习笔记/" class="nav-link">
  Spring
</a></div><div class="nav-item"><a href="/tiankafei-docs-架构/MySQL调优/" class="nav-link">
  架构
</a></div><div class="nav-item"><a href="/tiankafei-docs-大数据/centos7安装配置Hadoop/" class="nav-link">
  大数据
</a></div><div class="nav-item"><a href="/tiankafei-docs-linux/centos常用命令/" class="nav-link">
  Linux
</a></div><div class="nav-item"><a href="/tiankafei-docs-云/Centos7安装Docker并配置使用/" class="nav-link">
  云
</a></div><div class="nav-item"><a href="/tiankafei-docs-other/git命令/" class="nav-link">
  其他
</a></div><div class="nav-item"><a href="/tiankafei-docs-en/词性语法学习/" class="nav-link">
  英语
</a></div><div class="nav-item"><a href="https://github.com/tiankafei/tiankafei" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>架构</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/tiankafei-docs-架构/MySQL调优.html" class="sidebar-link">MySQL调优</a></li><li><a href="/tiankafei-docs-架构/mysql主从复制安装配置.html" class="sidebar-link">mysql主从复制安装配置</a></li><li><a href="/tiankafei-docs-架构/使用amoeba实现mysql读写分离.html" class="sidebar-link">使用amoeba实现mysql读写分离</a></li><li><a href="/tiankafei-docs-架构/redis学习笔记.html" class="sidebar-link">redis介绍</a></li><li><a href="/tiankafei-docs-架构/zookeeper学习笔记.html" class="sidebar-link">zookeeper学习笔记</a></li><li><a href="/tiankafei-docs-架构/elasticsearch学习笔记.html" class="active sidebar-link">Elasticsearch学习笔记</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/tiankafei-docs-架构/elasticsearch学习笔记.html#帮助文档" class="sidebar-link">帮助文档</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/tiankafei-docs-架构/elasticsearch学习笔记.html#中文官方文档-较老" class="sidebar-link">中文官方文档（较老）</a></li><li class="sidebar-sub-header"><a href="/tiankafei-docs-架构/elasticsearch学习笔记.html#英文最新文档-较新" class="sidebar-link">英文最新文档（较新）</a></li></ul></li><li class="sidebar-sub-header"><a href="/tiankafei-docs-架构/elasticsearch学习笔记.html#es核心概念和原理" class="sidebar-link">ES核心概念和原理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/tiankafei-docs-架构/elasticsearch学习笔记.html#什么是搜索" class="sidebar-link">什么是搜索</a></li><li class="sidebar-sub-header"><a href="/tiankafei-docs-架构/elasticsearch学习笔记.html#如何实现搜索功能" class="sidebar-link">如何实现搜索功能</a></li><li class="sidebar-sub-header"><a href="/tiankafei-docs-架构/elasticsearch学习笔记.html#倒排索引、lucene和全文检索" class="sidebar-link">倒排索引、Lucene和全文检索</a></li><li class="sidebar-sub-header"><a href="/tiankafei-docs-架构/elasticsearch学习笔记.html#倒排索引的特点" class="sidebar-link">倒排索引的特点</a></li><li class="sidebar-sub-header"><a href="/tiankafei-docs-架构/elasticsearch学习笔记.html#elasticsearch" class="sidebar-link">Elasticsearch</a></li><li class="sidebar-sub-header"><a href="/tiankafei-docs-架构/elasticsearch学习笔记.html#es-核心概念" class="sidebar-link">ES 核心概念</a></li></ul></li><li class="sidebar-sub-header"><a href="/tiankafei-docs-架构/elasticsearch学习笔记.html#环境安装" class="sidebar-link">环境安装</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/tiankafei-docs-架构/elasticsearch学习笔记.html#docker-安装配置-es" class="sidebar-link">docker 安装配置 es</a></li><li class="sidebar-sub-header"><a href="/tiankafei-docs-架构/elasticsearch学习笔记.html#docker-安装配置-kibana" class="sidebar-link">docker 安装配置 kibana</a></li><li class="sidebar-sub-header"><a href="/tiankafei-docs-架构/elasticsearch学习笔记.html#es-健康检查" class="sidebar-link">es 健康检查</a></li></ul></li><li class="sidebar-sub-header"><a href="/tiankafei-docs-架构/elasticsearch学习笔记.html#es节点有哪些类型" class="sidebar-link">ES节点有哪些类型</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/tiankafei-docs-架构/elasticsearch学习笔记.html#_1-主节点-master-node" class="sidebar-link">1. 主节点（Master node）</a></li><li class="sidebar-sub-header"><a href="/tiankafei-docs-架构/elasticsearch学习笔记.html#_2-数据节点-data-node" class="sidebar-link">2. 数据节点（Data node）</a></li><li class="sidebar-sub-header"><a href="/tiankafei-docs-架构/elasticsearch学习笔记.html#_3-预处理节点-ingest-node" class="sidebar-link">3. 预处理节点（ingest node）</a></li><li class="sidebar-sub-header"><a href="/tiankafei-docs-架构/elasticsearch学习笔记.html#_4-协调节点-coordinating-node" class="sidebar-link">4. 协调节点（Coordinating node）</a></li><li class="sidebar-sub-header"><a href="/tiankafei-docs-架构/elasticsearch学习笔记.html#_5-部落节点-trible-node" class="sidebar-link">5. 部落节点（Trible node）</a></li><li class="sidebar-sub-header"><a href="/tiankafei-docs-架构/elasticsearch学习笔记.html#_6-投票节点-voting-node" class="sidebar-link">6. 投票节点（voting node）</a></li></ul></li><li class="sidebar-sub-header"><a href="/tiankafei-docs-架构/elasticsearch学习笔记.html#es如何实现高可用" class="sidebar-link">ES如何实现高可用</a></li><li class="sidebar-sub-header"><a href="/tiankafei-docs-架构/elasticsearch学习笔记.html#es容错机制" class="sidebar-link">ES容错机制</a></li><li class="sidebar-sub-header"><a href="/tiankafei-docs-架构/elasticsearch学习笔记.html#如何提高es分布式系统的可用性及性能最大化" class="sidebar-link">如何提高ES分布式系统的可用性及性能最大化</a></li><li class="sidebar-sub-header"><a href="/tiankafei-docs-架构/elasticsearch学习笔记.html#master选举流程" class="sidebar-link">Master选举流程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/tiankafei-docs-架构/elasticsearch学习笔记.html#findmaster" class="sidebar-link">findMaster</a></li></ul></li><li class="sidebar-sub-header"><a href="/tiankafei-docs-架构/elasticsearch学习笔记.html#简单curd" class="sidebar-link">简单CURD</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/tiankafei-docs-架构/elasticsearch学习笔记.html#创建索引" class="sidebar-link">创建索引</a></li><li class="sidebar-sub-header"><a href="/tiankafei-docs-架构/elasticsearch学习笔记.html#查询索引状态" class="sidebar-link">查询索引状态</a></li><li class="sidebar-sub-header"><a href="/tiankafei-docs-架构/elasticsearch学习笔记.html#删除索引" class="sidebar-link">删除索引</a></li><li class="sidebar-sub-header"><a href="/tiankafei-docs-架构/elasticsearch学习笔记.html#查看索引信息" class="sidebar-link">查看索引信息</a></li><li class="sidebar-sub-header"><a href="/tiankafei-docs-架构/elasticsearch学习笔记.html#插入数据" class="sidebar-link">插入数据</a></li><li class="sidebar-sub-header"><a href="/tiankafei-docs-架构/elasticsearch学习笔记.html#查询数据" class="sidebar-link">查询数据</a></li><li class="sidebar-sub-header"><a href="/tiankafei-docs-架构/elasticsearch学习笔记.html#更新数据" class="sidebar-link">更新数据</a></li><li class="sidebar-sub-header"><a href="/tiankafei-docs-架构/elasticsearch学习笔记.html#删除数据" class="sidebar-link">删除数据</a></li></ul></li><li class="sidebar-sub-header"><a href="/tiankafei-docs-架构/elasticsearch学习笔记.html#es-常用查询" class="sidebar-link">ES 常用查询</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/tiankafei-docs-架构/elasticsearch学习笔记.html#_1-search-timeout" class="sidebar-link">1. search timeout</a></li><li class="sidebar-sub-header"><a href="/tiankafei-docs-架构/elasticsearch学习笔记.html#_2-query-string" class="sidebar-link">2. query_string</a></li><li class="sidebar-sub-header"><a href="/tiankafei-docs-架构/elasticsearch学习笔记.html#_3-match-all-匹配所有" class="sidebar-link">3. match_all：匹配所有</a></li><li class="sidebar-sub-header"><a href="/tiankafei-docs-架构/elasticsearch学习笔记.html#_4-match-name中包含-nfc" class="sidebar-link">4. match：name中包含“nfc”</a></li><li class="sidebar-sub-header"><a href="/tiankafei-docs-架构/elasticsearch学习笔记.html#_5-sort-按照加个倒序排序" class="sidebar-link">5. sort：按照加个倒序排序</a></li><li class="sidebar-sub-header"><a href="/tiankafei-docs-架构/elasticsearch学习笔记.html#_6-multi-match-根据多个字段查询一个关键词" class="sidebar-link">6. multi_match：根据多个字段查询一个关键词</a></li><li class="sidebar-sub-header"><a href="/tiankafei-docs-架构/elasticsearch学习笔记.html#_7-source-元数据-想要查询多个字段" class="sidebar-link">7. _source：元数据，想要查询多个字段</a></li><li class="sidebar-sub-header"><a href="/tiankafei-docs-架构/elasticsearch学习笔记.html#_8-分页-查询第一页-每页两条数据" class="sidebar-link">8. 分页：查询第一页（每页两条数据）</a></li><li class="sidebar-sub-header"><a href="/tiankafei-docs-架构/elasticsearch学习笔记.html#_9-term-不会被分词" class="sidebar-link">9. term：不会被分词</a></li><li class="sidebar-sub-header"><a href="/tiankafei-docs-架构/elasticsearch学习笔记.html#_10-全文检索" class="sidebar-link">10. 全文检索</a></li><li class="sidebar-sub-header"><a href="/tiankafei-docs-架构/elasticsearch学习笔记.html#_11-match-phrase-短语搜索-和全文检索相反" class="sidebar-link">11. match_phrase：短语搜索，和全文检索相反</a></li><li class="sidebar-sub-header"><a href="/tiankafei-docs-架构/elasticsearch学习笔记.html#_12-查询过滤" class="sidebar-link">12. 查询过滤</a></li><li class="sidebar-sub-header"><a href="/tiankafei-docs-架构/elasticsearch学习笔记.html#_13-compound-queries组合查询" class="sidebar-link">13. Compound queries组合查询</a></li><li class="sidebar-sub-header"><a href="/tiankafei-docs-架构/elasticsearch学习笔记.html#_14-highlight-search高亮查询" class="sidebar-link">14. Highlight search高亮查询</a></li><li class="sidebar-sub-header"><a href="/tiankafei-docs-架构/elasticsearch学习笔记.html#_15-deep-paging" class="sidebar-link">15. Deep paging</a></li><li class="sidebar-sub-header"><a href="/tiankafei-docs-架构/elasticsearch学习笔记.html#_16-scroll-search" class="sidebar-link">16. Scroll search</a></li><li class="sidebar-sub-header"><a href="/tiankafei-docs-架构/elasticsearch学习笔记.html#_17-filter缓存原理" class="sidebar-link">17. filter缓存原理</a></li></ul></li></ul></li><li><a href="/tiankafei-docs-架构/Tomcat源码分析.html" class="sidebar-link">Tomcat源码分析</a></li><li><a href="/tiankafei-docs-架构/Netty源码分析.html" class="sidebar-link">Netty源码分析</a></li><li><a href="/tiankafei-docs-架构/分布式架构.html" class="sidebar-link">分布式架构</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="elasticsearch学习笔记"><a href="#elasticsearch学习笔记" class="header-anchor">#</a> Elasticsearch学习笔记</h1> <h2 id="帮助文档"><a href="#帮助文档" class="header-anchor">#</a> 帮助文档</h2> <h3 id="中文官方文档-较老"><a href="#中文官方文档-较老" class="header-anchor">#</a> 中文官方文档（较老）</h3> <div class="language-http extra-class"><pre class="language-http"><code><span class="token header-name keyword">https:</span>//www.elastic.co/guide/cn/elasticsearch/guide/current/getting-started.html#getting-started
</code></pre></div><h3 id="英文最新文档-较新"><a href="#英文最新文档-较新" class="header-anchor">#</a> 英文最新文档（较新）</h3> <div class="language-http extra-class"><pre class="language-http"><code><span class="token header-name keyword">https:</span>//www.elastic.co/guide/en/elasticsearch/reference/7.10/getting-started.html
</code></pre></div><h2 id="es核心概念和原理"><a href="#es核心概念和原理" class="header-anchor">#</a> ES核心概念和原理</h2> <h3 id="什么是搜索"><a href="#什么是搜索" class="header-anchor">#</a> 什么是搜索</h3> <p>百度、垂直搜索（站内搜索）。搜索：通过一个<strong>关键词</strong>或一段描述，得到你想要（相关度高）的结果</p> <h3 id="如何实现搜索功能"><a href="#如何实现搜索功能" class="header-anchor">#</a> 如何实现搜索功能</h3> <p>关系型数据库：性能差、不可靠、结果不准确（相关度低）</p> <h3 id="倒排索引、lucene和全文检索"><a href="#倒排索引、lucene和全文检索" class="header-anchor">#</a> 倒排索引、<code>Lucene</code>和全文检索</h3> <ol><li>倒排索引的数据结构（存储的数据）
<ol><li>包含这个关键词的<code>document list</code></li> <li>关键词在每个doc中出现的次数<code>TF term frequency</code></li> <li>关键词在整个索引中出现的次数<code>IDF inverse doc frequency</code>（值越大，代表相关度越低）</li> <li>关键词在当前<code>doc</code>中出现的次数</li> <li>每个<code>doc</code>的长度，越长相关度越低</li> <li>包含这个关键词的所有<code>doc</code>的平均长度</li></ol></li> <li><code>Lucene</code>：<code>jar</code>包，帮我们创建倒排索引，提供了复杂的<code>API</code></li> <li>如果用<code>Luncene</code>做集群，会有哪些问题
<ul><li>节点一旦宕机，节点数据丢失，后果不堪设想，可用性差</li> <li>自己维护，麻烦（自己创建管理索引），单台节点的承载请求的能里是有限的，需要人工做负载。</li></ul></li></ol> <p><img src="/images/%E5%80%92%E6%8E%92%E7%B4%A2%E5%BC%95.png" alt="倒排索引"></p> <h3 id="倒排索引的特点"><a href="#倒排索引的特点" class="header-anchor">#</a> 倒排索引的特点</h3> <ol><li>倒排索引的数据量 &gt; 原始数据量</li> <li>倒排索引做的是完全匹配，不需要全表扫描</li> <li>倒排索引记录着这个词出现在原始数据的那个主键，根据主键去原始数据中查询是很快的</li></ol> <h3 id="elasticsearch"><a href="#elasticsearch" class="header-anchor">#</a> Elasticsearch</h3> <ol><li>特点
<ul><li>分布式</li> <li>高性能</li> <li>高可用</li> <li>可伸缩</li> <li>易维护</li></ul></li> <li>优点
<ul><li>面向开发者友好，屏蔽了Lucene的复杂特性，集群自动发现（cluster discovery）</li> <li>自动维护数据在多个节点上的建立</li> <li>会帮我们做搜索请求的负载均衡</li> <li>自动维护冗余副本，保证了部分节点宕机的情况下仍然不会有任何数据丢失</li> <li><code>ES</code>基于<code>Lucene</code>提供了很多高级功能：复合查询、聚合分析、基于地理位置等</li> <li>对于大公司，可以构建几百台服务器的大型分布式集群，处理PB级别数据；对于小公司，开箱即用，门槛低上手简单</li> <li>相比传统数据库，提供了全文检索，同义词处理（美丽的 cls &gt; 漂亮的 cls），相关度排名。聚合分析以及海量数据的近实时（NTR）处理，这些传统数据库完全做不到</li></ul></li> <li>应用领域
<ul><li>百度（全文检索，高亮、搜索推荐）</li> <li>各大网站的用户行为日志（用户点击、浏览、收藏、评论）</li> <li>BI（business Intelligence商业智能），数据分析，数据挖掘统计</li> <li>Github：代码托管平台，几千亿行代码</li> <li>ELK：Elasticsearch（数据存储）、Logstash（日志采集）、Kibana（可视化）</li></ul></li></ol> <h3 id="es-核心概念"><a href="#es-核心概念" class="header-anchor">#</a> ES 核心概念</h3> <ol><li><code>cluster</code>（集群）：每个集群至少包含两个节点</li> <li><code>node</code>：集群中的每个节点，一个节点不代表一台服务器</li> <li><code>field</code>：一个数据字段，与<code>index</code>和<code>type</code>一起，可以定位一个<code>doc</code></li> <li><code>document</code>：<code>es</code>最小的数据单元，通常是以<code>json</code>的形式存储的</li> <li><code>type</code>：逻辑上的数据分类，<code>es7.x</code>中删除了<code>type</code>的概念</li> <li><code>index</code>：一类相同或者类似的<code>doc</code>，比如一个员工索引，商品索引</li> <li><code>shard</code>分片：P分片，R副本
<ul><li>一个<code>index</code>包含多个<code>shard</code>，默认5个分片，默认每个分片分配一个副本，分片的数量在创建索引的时候设置，如果想修改，需要重建索引</li> <li>每个<code>shard</code>都是一个<code>lucene</code>实例，有完整的创建索引的处理请求能力</li> <li>es会自动在<code>nodes</code>上为我们做<code>shard</code>均衡</li> <li>一个<code>doc</code>是不可能同时存在与多个分片中的，但是可以存在于多个副本中</li> <li>分片和对应的副本不能同时存在于同一个节点，所以最低的可用配置是两个节点，互为主备</li></ul></li></ol> <h2 id="环境安装"><a href="#环境安装" class="header-anchor">#</a> 环境安装</h2> <h3 id="docker-安装配置-es"><a href="#docker-安装配置-es" class="header-anchor">#</a> docker 安装配置 es</h3> <h4 id="拉取镜像"><a href="#拉取镜像" class="header-anchor">#</a> 拉取镜像</h4> <div class="language-sh extra-class"><pre class="language-sh"><code>docker pull elasticsearch:7.6.2
</code></pre></div><h4 id="启动es"><a href="#启动es" class="header-anchor">#</a> 启动es</h4> <div class="language-shell extra-class"><pre class="language-shell"><code>docker run -d -p <span class="token number">9200</span>:9200 -p <span class="token number">9300</span>:9300 --restart<span class="token operator">=</span>always -e <span class="token string">&quot;discovery.type=single-node&quot;</span> --name<span class="token operator">=</span>elasticsearch elasticsearch:7.6.2
</code></pre></div><h4 id="修改配置"><a href="#修改配置" class="header-anchor">#</a> 修改配置</h4> <ol><li><p>进入容器</p> <div class="language-shell extra-class"><pre class="language-shell"><code>docker <span class="token builtin class-name">exec</span> -it elasticsearch <span class="token function">bash</span>
</code></pre></div></li> <li><p>vi config/elasticsearch.yml</p> <div class="language-shell extra-class"><pre class="language-shell"><code>cluster.name: <span class="token string">&quot;my-application&quot;</span>
node.name: <span class="token string">&quot;node-1&quot;</span>
network.host: <span class="token number">0.0</span>.0.0
</code></pre></div></li> <li><p>重启容器</p> <div class="language-shell extra-class"><pre class="language-shell"><code>docker restart elasticsearch
</code></pre></div></li></ol> <h4 id="访问地址"><a href="#访问地址" class="header-anchor">#</a> 访问地址</h4> <div class="language-http extra-class"><pre class="language-http"><code><span class="token header-name keyword">http:</span>//&lt;IP&gt;:&lt;PORT&gt;
<span class="token header-name keyword">http:</span>//192.168.21.123:9200/
</code></pre></div><h3 id="docker-安装配置-kibana"><a href="#docker-安装配置-kibana" class="header-anchor">#</a> docker 安装配置 kibana</h3> <h4 id="拉取镜像-2"><a href="#拉取镜像-2" class="header-anchor">#</a> 拉取镜像</h4> <div class="language-shell extra-class"><pre class="language-shell"><code>docker pull kibana:7.6.2
</code></pre></div><h4 id="启动kibana"><a href="#启动kibana" class="header-anchor">#</a> 启动kibana</h4> <div class="language-shell extra-class"><pre class="language-shell"><code>docker run -d -p <span class="token number">5601</span>:5601 --restart<span class="token operator">=</span>always --name kibana kibana:7.6.2
</code></pre></div><h4 id="出现的问题修改配置"><a href="#出现的问题修改配置" class="header-anchor">#</a> 出现的问题修改配置</h4> <ol><li><p>如果出现以下页面：Kibana server is not ready yet，说明Kibana没有找到ES节点</p></li> <li><p>进入容器</p> <div class="language-shell extra-class"><pre class="language-shell"><code>docker <span class="token builtin class-name">exec</span> -it kibana <span class="token function">bash</span>
</code></pre></div></li> <li><p>vi config/kibana.yml</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token comment">#</span>
<span class="token comment"># ** THIS IS AN AUTO-GENERATED FILE **</span>
<span class="token comment">#</span>

<span class="token comment"># Default Kibana configuration for docker target</span>
<span class="token key atrule">server.name</span><span class="token punctuation">:</span> kibana
<span class="token key atrule">server.host</span><span class="token punctuation">:</span> <span class="token string">&quot;0&quot;</span>
<span class="token comment"># 中文配置</span>
<span class="token key atrule">i18n.locale</span><span class="token punctuation">:</span> <span class="token string">&quot;zh-CN&quot;</span>
<span class="token key atrule">elasticsearch.hosts</span><span class="token punctuation">:</span> <span class="token punctuation">[</span> <span class="token string">&quot;http://192.168.21.123:9200&quot;</span> <span class="token punctuation">]</span>
<span class="token key atrule">xpack.monitoring.ui.container.elasticsearch.enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre></div></li> <li><p>重启容器</p> <div class="language-shell extra-class"><pre class="language-shell"><code>docker restart kibana
</code></pre></div></li></ol> <h4 id="访问地址-2"><a href="#访问地址-2" class="header-anchor">#</a> 访问地址</h4> <div class="language-http extra-class"><pre class="language-http"><code><span class="token header-name keyword">http:</span>//&lt;IP&gt;:&lt;PORT&gt;
<span class="token header-name keyword">http:</span>//192.168.21.123:5601/
</code></pre></div><h3 id="es-健康检查"><a href="#es-健康检查" class="header-anchor">#</a> es 健康检查</h3> <div class="language-http extra-class"><pre class="language-http"><code><span class="token header-name keyword">http:</span>//&lt;IP&gt;:9200/_cluster/health
<span class="token header-name keyword">http:</span>//192.168.21.123:9200/_cluster/health
</code></pre></div><h4 id="集群状态"><a href="#集群状态" class="header-anchor">#</a> 集群状态</h4> <ol><li><code>cluster_name</code>集群名称</li> <li><code>status</code>集群状态<code>green</code>代表健康；<code>yellow</code>代表分配了所有主分片，但至少缺少一个副本，此时集群数据仍旧完整；<code>red</code>代表部分主分片不可用，可能已经丢失数据。</li> <li><code>number_of_nodes</code>代表在线的节点总数量</li> <li><code>number_of_data_nodes</code>代表在线的数据节点的数量</li> <li><code>active_shards</code>存活的分片数量</li> <li><code>active_primary_shards</code>存活的主分片数量 正常情况下 <code>shards</code>的数量是<code>pri</code>的两倍</li> <li><code>relocating_shards</code>迁移中的分片数量，正常情况为 0</li> <li><code>initializing_shards</code>初始化中的分片数量，正常情况为 0</li> <li><code>unassigned_shards</code>未分配的分片，正常情况为 0</li> <li><code>delayed_unassigned_shards</code></li> <li><code>number_of_pending_tasks</code>，准备中的任务，任务指迁移分片等，正常情况为 0</li> <li><code>number_of_in_flight_fetch</code></li> <li><code>task_max_waiting_in_queue_millis</code>任务最长等待时间</li> <li><code>active_shards_percent_as_number</code>正常分片百分比 正常情况为 100%</li></ol> <h4 id="api"><a href="#api" class="header-anchor">#</a> API</h4> <ol><li><code>/_cat/allocation</code>      	#查看单节点的shard分配整体情况</li> <li><code>/_cat/shards</code>          	#查看各shard的详细情况</li> <li><code>/_cat/shards/{index}</code>  	#查看指定分片的详细情况</li> <li><code>/_cat/master</code>          	#查看master节点信息</li> <li><code>/_cat/nodes</code>           	#查看所有节点信息</li> <li><code>/_cat/indices</code>         	#查看集群中所有index的详细信息</li> <li><code>/_cat/indices/{index}</code> 	#查看集群中指定index的详细信息</li> <li><code>/_cat/segments</code>        	#查看各index的segment详细信息,包括segment名, 所属shard, 内存(磁盘)占用大小, 是否刷盘</li> <li><code>/_cat/segments/{index}</code>	#查看指定index的segment详细信息</li> <li><code>/_cat/count</code>           	#查看当前集群的doc数量</li> <li><code>/_cat/count/{index}</code>   	#查看指定索引的doc数量</li> <li><code>/_cat/recovery</code>        	#查看集群内每个shard的recovery过程.调整replica。</li> <li><code>/_cat/recovery/{index}</code>	#查看指定索引shard的recovery过程</li> <li><code>/_cat/health</code>          	#查看集群当前状态：红、黄、绿</li> <li><code>/_cat/pending_tasks</code>   	#查看当前集群的pending task</li> <li><code>/_cat/aliases</code>         	#查看集群中所有alias信息,路由配置等</li> <li><code>/_cat/aliases/{alias}</code> 	#查看指定索引的alias信息</li> <li><code>/_cat/thread_pool</code>     	#查看集群各节点内部不同类型的threadpool的统计信息,</li> <li><code>/_cat/plugins</code>         	#查看集群各个节点上的plugin信息</li> <li><code>/_cat/fielddata</code>       	#查看当前集群各个节点的fielddata内存使用情况</li> <li><code>/_cat/fielddata/{fields}</code>	#查看指定field的内存使用情况,里面传field属性对应的值</li> <li><code>/_cat/nodeattrs</code>			#查看单节点的自定义属性</li> <li><code>/_cat/repositories</code>		#输出集群中注册快照存储库</li> <li><code>/_cat/templates</code>			#输出当前正在存在的模板信息</li></ol> <h4 id="健康值状态"><a href="#健康值状态" class="header-anchor">#</a> 健康值状态</h4> <ol><li>Green：所有Primary和Replica均为active，集群健康</li> <li>Yellow：至少一个Replica不可用，但是所有Primary均为active，数据仍然是可以保证完整性的</li> <li>Red：至少有一个Primary为不可用状态，数据不完整，集群不可用</li></ol> <h2 id="es节点有哪些类型"><a href="#es节点有哪些类型" class="header-anchor">#</a> ES节点有哪些类型</h2> <h3 id="_1-主节点-master-node"><a href="#_1-主节点-master-node" class="header-anchor">#</a> 1. 主节点（Master node）</h3> <ol><li><p>主节点的主要职责是负责集群层面的相关操作，管理集群变更，如创建或删除索引，跟踪哪些节点是集群的一部分，并决定哪些分片分配给哪些相关的节点</p></li> <li><p>主节点也可以作为数据节点，但稳定的主节点对集群的健康是非常重要的，默认情况下任何一个集群中的节点都有可能被选为主节点，索引数据和搜索查询等操作会占用大量的cpu，内存，io资源，为了确保一个集群的稳定，分离主节点和数据节点是一个比较好的选择</p></li> <li><p>通过配置<code>node.master: true</code>(默认)使节点具有被选举为<code>Master</code>的资格。主节点是全局唯一的，从有资格成为<code>Master</code>的节点中选举</p></li> <li><p>为了防止数据丢失，每个主节点应该知道有资格升为主节点的数量，默认为1，为了避免网络分区出现多主的情况，配置<code>discovery.zen.minimun_master_nodes</code>原则上最小值应该为：<code>(master_eligible_nodes/2)+1</code></p></li> <li><div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">node.master</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token key atrule">node.data</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
</code></pre></div></li></ol> <h3 id="_2-数据节点-data-node"><a href="#_2-数据节点-data-node" class="header-anchor">#</a> 2. 数据节点（Data node）</h3> <ol><li><p>数据节点主要是存储索引数据的节点，执行数据相关操作：CRUD、搜索，聚合操作等。数据节点对cpu，内存，I/O要求较高， 在优化的时候需要监控数据节点的状态，当资源不够的时候，需要在集群中添加新的节点。</p></li> <li><p>通过配置<code>node.data: true</code>(默认来是一个节点成为数据节点)，也可以通过下面配置创建一个数据节点</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">node.master</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
<span class="token key atrule">node.data</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token key atrule">node.ingest</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
</code></pre></div></li></ol> <h3 id="_3-预处理节点-ingest-node"><a href="#_3-预处理节点-ingest-node" class="header-anchor">#</a> 3. 预处理节点（ingest node）</h3> <ol><li><p>这是从5.0版本开始引入的概念。预处理操作运行在索引文档之前，即写入数据之前，通过事先定义好的一系列<code>processors</code>(处理器)和<code>pipeline</code>（管道），对数据进行某种转换、富化。<code>processors</code>和<code>pipeline</code>拦截<code>bulk</code>和<code>index</code>请求，在应用相关操作后将文档传回给<code>index</code>或<code>bulk API</code></p></li> <li><p>默认情况下，在所有的节点启用<code>ingest</code>。如果想在某个节点上禁用<code>ingest</code>，则可以填写配置<code>node.ingest: false</code>，也可以通过下面的配置创建一个仅用于预处理的节点：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">node.master</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
<span class="token key atrule">node.data</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
<span class="token key atrule">node.ingest</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre></div></li></ol> <h3 id="_4-协调节点-coordinating-node"><a href="#_4-协调节点-coordinating-node" class="header-anchor">#</a> 4. 协调节点（Coordinating node）</h3> <ol><li><p>客户端请求可以发送到集群的任何节点，每个节点都知道任意文档所处的位置，然后转发这些请求，收集数据并返回给客户端，处理客户端请求的节点称为协调节点。</p></li> <li><p>协调节点将请求转发给保存数据的数据节点。每个数据节点在本地执行请求，并将结果返回给协调节点。协调节点收集完数据后，将每个数据节点的结果合并为单个全局结果。对结果收集和排序的过程可能需要很多CPU和内存资源。</p></li> <li><p>通过下面配置创建一个仅用于协调的节点：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">node.master</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
<span class="token key atrule">node.data</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
<span class="token key atrule">node.ingest</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
</code></pre></div></li></ol> <h3 id="_5-部落节点-trible-node"><a href="#_5-部落节点-trible-node" class="header-anchor">#</a> 5. 部落节点（Trible node）</h3> <ol><li><code>tribes</code>功能允许部落节点在多个集群之间充当联合客户端</li> <li>部落节点是一个单独的节点，其主要工作是嗅探远程集群的集群状态，并将它们合并在一起。为了做到这一点，它加入了所有的远程集群，使它成为一个非特殊的节点，它不属于自己的集群，而是加入了多个集群。</li> <li>也被称为<code>跨集群搜索</code>的功能，该功能<code>允许用户不仅跨本地索引，而且跨集群撰写搜索</code>。这意味着可以搜索属于其他远程集群的数据。</li></ol> <h3 id="_6-投票节点-voting-node"><a href="#_6-投票节点-voting-node" class="header-anchor">#</a> 6. 投票节点（voting node）</h3> <ol><li><code>node.voting_only: true</code>（仅投票节点，即使配置了<code>data.master: true</code>，也不会参选</li> <li>仍然可以作为数据节点<code>node.data: true</code></li></ol> <h2 id="es如何实现高可用"><a href="#es如何实现高可用" class="header-anchor">#</a> ES如何实现高可用</h2> <ol><li>ES在分配单个索引的分片时会将每个分片尽可能分配到更多的节点上。但是，实际情况取决于集群拥有的分片和索引的数量以及它们的大小，不一定总是能均匀地分布</li> <li>ES不允许Primary和它的Replica放在同一个节点中，并且同一个节点不接受完全相同的两个Replica</li> <li>同一个节点允许多个索引的分片同时存在</li></ol> <h2 id="es容错机制"><a href="#es容错机制" class="header-anchor">#</a> ES容错机制</h2> <ol><li>Master选举（假如宕机节点是Master）
<ul><li>脑裂：可能会产生多个Master节点</li> <li>解决：discovery.zen.minimum_master_nodes=N/2+1</li></ul></li> <li><code>Replica</code>容错，新的（或者原有）Master节点会将丢失的Primary对应的某个副本提升为Primary</li> <li>Master节点会尝试重启故障机</li> <li>数据同步，Master会将宕机期间丢失的数据同步到重启机器对应的分片上去</li></ol> <h2 id="如何提高es分布式系统的可用性及性能最大化"><a href="#如何提高es分布式系统的可用性及性能最大化" class="header-anchor">#</a> 如何提高ES分布式系统的可用性及性能最大化</h2> <ol><li>每台节点的<code>shard</code>数量越少，每个<code>shard</code>分配的CPU、内存和IO资源越多，单个<code>shard</code>的性能越好，当一台机器一个<code>shard</code>时，单个<code>shard</code>性能最好</li> <li>稳定的<code>Master节点</code>对于集群的健康非常重要！理论上讲，应该尽可能的减轻<code>Master节点</code>的压力，分片数量越多，<code>Master节点</code>维护管理<code>shard</code>的任务越重，并且节点可能就要承担更多的数据转发任务，可增加<code>仅协调节点</code>来缓解<code>Master节点</code>和<code>Data节点</code>的压力，但是在集群中添加过多的<code>仅协调节点</code>会增加整个集群的负担，因为选择的主节点必须等待每个节点的集群状态更新确认。</li> <li>反过来说，如果相同资源分配相同的前提下，<code>shard</code>数量越少，单个<code>shard</code>的体积越大，查询性能越低，速度越慢，这个取舍应根据实际集群状况和结合应用场景等因素综合考虑</li> <li><code>data节点</code>和<code>Master节点</code>一定要分开，集群规模越大，这样做的意义也就越大</li> <li><code>data节点</code>处理与数据相关的操作，例如<code>CRUD</code>，搜索和聚合。这些操作是<code>I/O</code>，内存和<code>CPU</code>密集型的，所以他们需要更高配置的服务器以及更高的带宽，并且集群的性能冗余非常重要</li> <li>由于<code>仅投票节</code>不参与<code>Master</code>竞选，所以和真正的<code>Master</code>节点相比，它需要的内存和CPU较少。但是，所有<code>候选节点</code>以及<code>仅投票节点</code>都可能是<code>数据节点</code>，所以他们都需要快速稳定低延迟的网络</li> <li>高可用性（HA）群集至少需要三个主节点，其中<code>至少两个不是仅投票节点</code>。即使其中一个节点发生故障，这样的群集也将能够选举一个主节点。生产环境最好设置3台仅Master候选节点（node.master = true	 node.data = true）</li> <li>为确保集群仍然可用，集群不能同时停止投票配置中的一半或更多节点。只要有一半以上的投票节点可用，集群仍可以正常工作。这意味着，如果存在三个或四个主节点合格的节点，则集群可以容忍其中一个节点不可用。如果有两个或更少的主机资格节点，则它们必须都保持可用</li></ol> <h2 id="master选举流程"><a href="#master选举流程" class="header-anchor">#</a> Master选举流程</h2> <h3 id="findmaster"><a href="#findmaster" class="header-anchor">#</a> findMaster</h3> <h2 id="简单curd"><a href="#简单curd" class="header-anchor">#</a> 简单CURD</h2> <h3 id="创建索引"><a href="#创建索引" class="header-anchor">#</a> 创建索引</h3> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># 格式</span>
PUT /<span class="token punctuation">{</span>indexName<span class="token punctuation">}</span>?pretty
<span class="token comment"># demo</span>
PUT /product?pretty
</code></pre></div><h3 id="查询索引状态"><a href="#查询索引状态" class="header-anchor">#</a> 查询索引状态</h3> <div class="language-shell extra-class"><pre class="language-shell"><code>GET /_cat/indices?v
</code></pre></div><h3 id="删除索引"><a href="#删除索引" class="header-anchor">#</a> 删除索引</h3> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># 格式</span>
DELETE /<span class="token punctuation">{</span>indexName<span class="token punctuation">}</span>?pretty
<span class="token comment"># demo</span>
DELETE /product?pretty
</code></pre></div><h3 id="查看索引信息"><a href="#查看索引信息" class="header-anchor">#</a> 查看索引信息</h3> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># 查看索引 map 映射信息</span>
GET /product
<span class="token comment"># 查看索引数据</span>
GET /product/_search
</code></pre></div><h3 id="插入数据"><a href="#插入数据" class="header-anchor">#</a> 插入数据</h3> <div class="language-shell extra-class"><pre class="language-shell"><code>PUT /product/_doc/1
<span class="token punctuation">{</span>
    <span class="token string">&quot;name&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;xiaomi phone&quot;</span>,
    <span class="token string">&quot;desc&quot;</span> <span class="token builtin class-name">:</span>  <span class="token string">&quot;shouji zhong de zhandouji&quot;</span>,
    <span class="token string">&quot;price&quot;</span> <span class="token builtin class-name">:</span>  <span class="token number">3999</span>,
    <span class="token string">&quot;tags&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span> <span class="token string">&quot;xingjiabi&quot;</span>, <span class="token string">&quot;fashao&quot;</span>, <span class="token string">&quot;buka&quot;</span> <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
PUT /product/_doc/2
<span class="token punctuation">{</span>
    <span class="token string">&quot;name&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;xiaomi nfc phone&quot;</span>,
    <span class="token string">&quot;desc&quot;</span> <span class="token builtin class-name">:</span>  <span class="token string">&quot;zhichi quangongneng nfc,shouji zhong de jianjiji&quot;</span>,
    <span class="token string">&quot;price&quot;</span> <span class="token builtin class-name">:</span>  <span class="token number">4999</span>,
    <span class="token string">&quot;tags&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span> <span class="token string">&quot;xingjiabi&quot;</span>, <span class="token string">&quot;fashao&quot;</span>, <span class="token string">&quot;gongjiaoka&quot;</span> <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
PUT /product/_doc/3
<span class="token punctuation">{</span>
    <span class="token string">&quot;name&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;nfc phone&quot;</span>,
    <span class="token string">&quot;desc&quot;</span> <span class="token builtin class-name">:</span>  <span class="token string">&quot;shouji zhong de hongzhaji&quot;</span>,
    <span class="token string">&quot;price&quot;</span> <span class="token builtin class-name">:</span>  <span class="token number">2999</span>,
    <span class="token string">&quot;tags&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span> <span class="token string">&quot;xingjiabi&quot;</span>, <span class="token string">&quot;fashao&quot;</span>, <span class="token string">&quot;menjinka&quot;</span> <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
PUT /product/_doc/4
<span class="token punctuation">{</span>
    <span class="token string">&quot;name&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;xiaomi erji&quot;</span>,
    <span class="token string">&quot;desc&quot;</span> <span class="token builtin class-name">:</span>  <span class="token string">&quot;erji zhong de huangmenji&quot;</span>,
    <span class="token string">&quot;price&quot;</span> <span class="token builtin class-name">:</span>  <span class="token number">999</span>,
    <span class="token string">&quot;tags&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span> <span class="token string">&quot;low&quot;</span>, <span class="token string">&quot;bufangshui&quot;</span>, <span class="token string">&quot;yinzhicha&quot;</span> <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
PUT /product/_doc/5
<span class="token punctuation">{</span>
    <span class="token string">&quot;name&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;hongmi erji&quot;</span>,
    <span class="token string">&quot;desc&quot;</span> <span class="token builtin class-name">:</span>  <span class="token string">&quot;erji zhong de kendeji&quot;</span>,
    <span class="token string">&quot;price&quot;</span> <span class="token builtin class-name">:</span>  <span class="token number">399</span>,
    <span class="token string">&quot;tags&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span> <span class="token string">&quot;lowbee&quot;</span>, <span class="token string">&quot;xuhangduan&quot;</span>, <span class="token string">&quot;zhiliangx&quot;</span> <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="查询数据"><a href="#查询数据" class="header-anchor">#</a> 查询数据</h3> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># 查询单个document</span>
<span class="token comment"># 格式</span>
GET /<span class="token punctuation">{</span>indexName<span class="token punctuation">}</span>/_doc/<span class="token punctuation">{</span>id<span class="token punctuation">}</span>
<span class="token comment"># demo</span>
GET /product/_doc/1

<span class="token comment"># 查看所有的document</span>
<span class="token comment"># 格式</span>
GET /<span class="token punctuation">{</span>indexName<span class="token punctuation">}</span>/_search
<span class="token comment"># demo</span>
GET /product/_search

<span class="token comment"># 查询多个结果的排序</span>
<span class="token comment"># 格式</span>
GET /<span class="token punctuation">{</span>indexName<span class="token punctuation">}</span>/_search?sort<span class="token operator">=</span>排序的字段:<span class="token operator">&lt;</span>asc<span class="token operator">&gt;</span><span class="token operator">&lt;</span>desc<span class="token operator">&gt;</span>
<span class="token comment"># demo</span>
GET /product/_search?sort<span class="token operator">=</span>price
GET /product/_search?sort<span class="token operator">=</span>price:asc
GET /product/_search?sort<span class="token operator">=</span>price:desc
GET /product/_search?q<span class="token operator">=</span>price:2999<span class="token operator">&amp;</span><span class="token assign-left variable">sort</span><span class="token operator">=</span>price:desc
</code></pre></div><h3 id="更新数据"><a href="#更新数据" class="header-anchor">#</a> 更新数据</h3> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># 全量更新（完全覆盖）</span>
<span class="token comment"># 格式</span>
PUT /<span class="token punctuation">{</span>indexName<span class="token punctuation">}</span>/_doc/<span class="token punctuation">{</span>id<span class="token punctuation">}</span>
json格式的数据

<span class="token comment"># demo</span>
PUT /product/_doc/1
<span class="token punctuation">{</span>
    <span class="token string">&quot;name&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;xiaomi phone&quot;</span>,
    <span class="token string">&quot;desc&quot;</span> <span class="token builtin class-name">:</span>  <span class="token string">&quot;shouji zhong de zhandouji&quot;</span>,
    <span class="token string">&quot;price&quot;</span> <span class="token builtin class-name">:</span>  <span class="token number">3999</span>,
    <span class="token string">&quot;tags&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span> <span class="token string">&quot;xingjiabi&quot;</span>, <span class="token string">&quot;fashao&quot;</span>, <span class="token string">&quot;buka&quot;</span> <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># 增量更新</span>
<span class="token comment"># 格式</span>
POST /<span class="token punctuation">{</span>indexName<span class="token punctuation">}</span>/_doc/<span class="token punctuation">{</span>id<span class="token punctuation">}</span>/_update
<span class="token punctuation">{</span>
    <span class="token string">&quot;doc&quot;</span><span class="token builtin class-name">:</span> json格式的数据
<span class="token punctuation">}</span>

<span class="token comment"># demo</span>
POST /product/_doc/1/_update
<span class="token punctuation">{</span>
    <span class="token string">&quot;doc&quot;</span>:<span class="token punctuation">{</span>
        <span class="token string">&quot;price&quot;</span> <span class="token builtin class-name">:</span>  <span class="token number">23999</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="删除数据"><a href="#删除数据" class="header-anchor">#</a> 删除数据</h3> <blockquote><p>先逻辑删除，没有立即删除，后续才会物理删除</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># 格式</span>
DELETE /<span class="token punctuation">{</span>indexName<span class="token punctuation">}</span>/_doc/<span class="token punctuation">{</span>id<span class="token punctuation">}</span>
<span class="token comment"># demo</span>
DELETE /product/_doc/1
</code></pre></div><h2 id="es-常用查询"><a href="#es-常用查询" class="header-anchor">#</a> ES 常用查询</h2> <h3 id="_1-search-timeout"><a href="#_1-search-timeout" class="header-anchor">#</a> 1. search timeout</h3> <ol><li>设置：默认没有<code>timeout</code>，如果设置了<code>timeout</code>，那么会执行<code>timeout</code>机制</li> <li><code>timeout</code>机制：假设用户查询结果有1W条数据，但是需要10s才能查询完毕，但是用户设置了1s的<code>timeout</code>，那么不管当前一共查询到了多少数据，都会在1s后停止查询，并返回当前数据</li> <li>用法：GET /product/_search?timeout=1s/ms/m</li></ol> <h3 id="_2-query-string"><a href="#_2-query-string" class="header-anchor">#</a> 2. query_string</h3> <ol><li>查询所有：GET /product/_search</li> <li>带参数：GET /product/_search?q=name:xiaomi</li> <li>分页+排序：GET /product/_search?from=0&amp;size=2&amp;sort=price:asc</li></ol> <h3 id="_3-match-all-匹配所有"><a href="#_3-match-all-匹配所有" class="header-anchor">#</a> 3. match_all：匹配所有</h3> <div class="language-http extra-class"><pre class="language-http"><code>GET /product/_search
{
  &quot;query&quot;:{
    &quot;match_all&quot;: {}
  }
}
</code></pre></div><h3 id="_4-match-name中包含-nfc"><a href="#_4-match-name中包含-nfc" class="header-anchor">#</a> 4. match：name中包含“nfc”</h3> <div class="language-http extra-class"><pre class="language-http"><code>GET /product/_search
{
  &quot;query&quot;: {
    &quot;match&quot;: {
      &quot;name&quot;: &quot;nfc&quot;
    }
  }
}
</code></pre></div><h3 id="_5-sort-按照加个倒序排序"><a href="#_5-sort-按照加个倒序排序" class="header-anchor">#</a> 5. sort：按照加个倒序排序</h3> <div class="language-http extra-class"><pre class="language-http"><code>GET /product/_search
{
  &quot;query&quot;: {
    &quot;multi_match&quot;: {
      &quot;query&quot;: &quot;nfc&quot;,
      &quot;fields&quot;: [&quot;name&quot;,&quot;desc&quot;]
    }
  },
  &quot;sort&quot;: [
    {
      &quot;price&quot;: &quot;desc&quot;
    }
  ]
}
</code></pre></div><h3 id="_6-multi-match-根据多个字段查询一个关键词"><a href="#_6-multi-match-根据多个字段查询一个关键词" class="header-anchor">#</a> 6. multi_match：根据多个字段查询一个关键词</h3> <blockquote><p>name和desc中包含“nfc”</p></blockquote> <div class="language-http extra-class"><pre class="language-http"><code>GET /product/_search
{
  &quot;query&quot;: {
    &quot;multi_match&quot;: {
      &quot;query&quot;: &quot;nfc&quot;,
      &quot;fields&quot;: [&quot;name&quot;,&quot;desc&quot;]
    }
  },
  &quot;sort&quot;: [
    {
      &quot;price&quot;: &quot;desc&quot;
    }
  ]
}
</code></pre></div><h3 id="_7-source-元数据-想要查询多个字段"><a href="#_7-source-元数据-想要查询多个字段" class="header-anchor">#</a> 7. _source：元数据，想要查询多个字段</h3> <blockquote><p>① 例子中为只查询“name”和“price”字段。</p></blockquote> <div class="language-http extra-class"><pre class="language-http"><code>GET /product/_search
{
  &quot;query&quot;:{
    &quot;match&quot;: {
      &quot;name&quot;: &quot;nfc&quot;
    }
  },
  &quot;_source&quot;: [&quot;name&quot;,&quot;price&quot;]
}
</code></pre></div><h3 id="_8-分页-查询第一页-每页两条数据"><a href="#_8-分页-查询第一页-每页两条数据" class="header-anchor">#</a> 8. 分页：查询第一页（每页两条数据）</h3> <div class="language-http extra-class"><pre class="language-http"><code>GET /product/_search
{
  &quot;query&quot;:{
    &quot;match_all&quot;: {}
  },
  &quot;sort&quot;: [
    {
      &quot;price&quot;: &quot;asc&quot;
    }
  ], 
  &quot;from&quot;: 0,
  &quot;size&quot;: 2
}
</code></pre></div><h3 id="_9-term-不会被分词"><a href="#_9-term-不会被分词" class="header-anchor">#</a> 9. term：不会被分词</h3> <div class="language-http extra-class"><pre class="language-http"><code>GET /product/_search
{
  &quot;query&quot;: {
    &quot;term&quot;: {
      &quot;name&quot;: &quot;nfc&quot;
    }
  }
}
GET /product/_search
{
  &quot;query&quot;: {
    &quot;term&quot;: {
      &quot;name&quot;: &quot;nfc phone&quot; 这里因为没有分词，所以查询没有结果
    }
  }
}
</code></pre></div><h3 id="_10-全文检索"><a href="#_10-全文检索" class="header-anchor">#</a> 10. 全文检索</h3> <div class="language-http extra-class"><pre class="language-http"><code>GET /product/_search
{
  &quot;query&quot;: {
    &quot;match&quot;: {
      &quot;name&quot;: &quot;xiaomi nfc zhineng phone&quot;
    }
  }
}
#验证分词
GET /_analyze 
{
  &quot;analyzer&quot;: &quot;standard&quot;,
  &quot;text&quot;:&quot;xiaomi nfc zhineng phone&quot;
}
</code></pre></div><h3 id="_11-match-phrase-短语搜索-和全文检索相反"><a href="#_11-match-phrase-短语搜索-和全文检索相反" class="header-anchor">#</a> 11. match_phrase：短语搜索，和全文检索相反</h3> <div class="language-http extra-class"><pre class="language-http"><code>GET /product/_search
{
  &quot;query&quot;: {
    &quot;match_phrase&quot;: {
      &quot;name&quot;: &quot;nfc phone&quot;
    }
  }
}
</code></pre></div><h3 id="_12-查询过滤"><a href="#_12-查询过滤" class="header-anchor">#</a> 12. 查询过滤</h3> <ol><li><code>bool</code>：可以<code>组合多个查询条件</code>，<code>bool</code>查询也是采用<code>more_matches_is_better</code>的机制，因此满足<code>must</code>和<code>should</code>子句的文档将会合并起来计算分值</li> <li><code>must</code>：<code>必须满足</code>（子查询必须出现在匹配的文档中，并将有助于得分）</li> <li><code>should</code>：<code>可能满足</code> <code>or</code>（子查询可能会出现在匹配的文档中）</li> <li><code>must_not</code>：<code>必须不满足</code> <code>不计算相关度分数</code> <code>not</code>（子查询不得出现在匹配的文档中，子句在过滤器上下文中执行，这意味着计分被忽略，并且子句被视为用于缓存）</li> <li><code>filter</code>：<code>过滤器</code> <code>不计算相关度分数</code>，<code>cache</code>（子查询必须出现在匹配的文档中，但是不像<code>must</code>查询的分数将忽略。<code>filter</code>子句在<code>filter</code>上下文中执行，这意味着计分被忽略，并且子句被考虑用于缓存）</li> <li><code>minimum_should_match</code>：参数指定<code>should</code>返回的文档必须匹配的子句的数量或百分比。如果<code>bool</code>查询包含至少一个<code>should</code>子句，而没有<code>must</code>或<code>filter</code>子句，则默认值为1。否则，默认值为0</li></ol> <h4 id="_1-bool单条件查询"><a href="#_1-bool单条件查询" class="header-anchor">#</a> 1. bool单条件查询</h4> <blockquote><p>首先筛选<code>name</code>包含<code>xiaomi phone</code>并且价格大于1999的数据（不排序），然后搜索<code>name</code>包含<code>xiaomi</code>and <code>desc</code> 包含<code>shouji</code></p></blockquote> <div class="language-http extra-class"><pre class="language-http"><code>GET /product/_search
{
  &quot;query&quot;: {
    &quot;bool&quot;:{
      &quot;must&quot;: [
        {&quot;match&quot;: { &quot;name&quot;: &quot;xiaomi&quot;}},
        {&quot;match&quot;: {&quot;desc&quot;: &quot;shouji&quot;}}
      ],
      &quot;filter&quot;: [
        {&quot;match_phrase&quot;:{&quot;name&quot;:&quot;xiaomi phone&quot;}},
        {&quot;range&quot;: {
          &quot;price&quot;: {
            &quot;gt&quot;: 1999
          }
        }}
      ]
    }
  }
}
</code></pre></div><h4 id="_2-bool多条件"><a href="#_2-bool多条件" class="header-anchor">#</a> 2. bool多条件</h4> <blockquote><p>name包含xiaomi 不包含erji 描述里包不包含nfc都可以，价钱要大于等于4999</p></blockquote> <div class="language-http extra-class"><pre class="language-http"><code>GET /product/_search
{
  &quot;query&quot;: {
    &quot;bool&quot;: {
      # name中必须包含&quot;xiaomi&quot;
      &quot;must&quot;: [
        {
          &quot;match&quot;: {&quot;name&quot;: &quot;xiaomi&quot;}
        }
      ],
      # name中必须不能包含&quot;erji&quot;
      &quot;must_not&quot;: [
        {
          &quot;match&quot;: {&quot;name&quot;: &quot;erji&quot;}
        }
      ],
      # should中至少满足0个条件，参见下面的 minimum_should_match 的解释
      &quot;should&quot;: [
        {
          &quot;match&quot;: {&quot;desc&quot;: &quot;nfc&quot;}
        }
      ],
      # 筛选价格大于4999的doc
      &quot;filter&quot;: [
        {
          &quot;range&quot;: {
            &quot;price&quot;: {&quot;gt&quot;: 4999}
          }
        }
      ]
    }
  }
}
</code></pre></div><h4 id="_3-minimum-should-match的嵌套查询"><a href="#_3-minimum-should-match的嵌套查询" class="header-anchor">#</a> 3. minimum_should_match的嵌套查询</h4> <div class="language-http extra-class"><pre class="language-http"><code>GET /product/_search
{
  &quot;query&quot;: {
    &quot;bool&quot;:{
      &quot;must&quot;: [
        {&quot;match&quot;: { &quot;name&quot;: &quot;nfc&quot;}}
      ],
      &quot;should&quot;: [
        {&quot;range&quot;: {
          &quot;price&quot;: {&quot;gt&quot;:1999}
        }},
         {&quot;range&quot;: {
          &quot;price&quot;: {&quot;gt&quot;:3999}
        }}
      ],
      &quot;minimum_should_match&quot;: 1
    }
  }
}
# 
GET /product/_search
{
  &quot;query&quot;: {
    &quot;bool&quot;: {
      &quot;filter&quot;: {
        &quot;bool&quot;: {
          &quot;should&quot;: [
            { &quot;range&quot;: {&quot;price&quot;: {&quot;gt&quot;: 1999}}},
            { &quot;range&quot;: {&quot;price&quot;: {&quot;gt&quot;: 3999}}}
          ],
          &quot;must&quot;: [
            { &quot;match&quot;: {&quot;name&quot;: &quot;nfc&quot;}}
          ]
        }
      }
    }
  }
}
</code></pre></div><h3 id="_13-compound-queries组合查询"><a href="#_13-compound-queries组合查询" class="header-anchor">#</a> 13. Compound queries组合查询</h3> <blockquote><p>想要一台带<code>NFC</code>功能的 或者 小米的手机 但是不要耳机</p></blockquote> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">from</span> product <span class="token keyword">where</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>name<span class="token punctuation">`</span> <span class="token operator">like</span> <span class="token string">&quot;%xiaomi%&quot;</span> <span class="token operator">or</span> <span class="token punctuation">`</span>name<span class="token punctuation">`</span> <span class="token operator">like</span> <span class="token string">'%nfc%'</span><span class="token punctuation">)</span> <span class="token operator">AND</span> <span class="token punctuation">`</span>name<span class="token punctuation">`</span> <span class="token operator">not</span> <span class="token operator">LIKE</span> <span class="token string">'%erji%'</span>
</code></pre></div><div class="language-http extra-class"><pre class="language-http"><code>GET /product/_search
{
  &quot;query&quot;: {
    &quot;constant_score&quot;:{
      &quot;filter&quot;: {
        &quot;bool&quot;: {
          &quot;should&quot;:[
            {&quot;term&quot;:{&quot;name&quot;:&quot;xiaomi&quot;}},
            {&quot;term&quot;:{&quot;name&quot;:&quot;nfc&quot;}}
            ],
          &quot;must_not&quot;:[
            {&quot;term&quot;:{&quot;name&quot;:&quot;erji&quot;}}
            ]
        }
      },
      &quot;boost&quot;: 1.2
    }
  }
}
</code></pre></div><blockquote><p>搜索一台xiaomi nfc phone或者一台满足 是一台手机 并且 价格小于等于2999</p></blockquote> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> product <span class="token keyword">WHERE</span> NAME <span class="token operator">LIKE</span> <span class="token string">'%xiaomi nfc phone%'</span> <span class="token operator">OR</span> <span class="token punctuation">(</span>NAME <span class="token operator">LIKE</span> <span class="token string">'%phone%'</span> <span class="token operator">AND</span> price <span class="token operator">&gt;</span> <span class="token number">399</span> <span class="token operator">AND</span> price <span class="token operator">&lt;=</span><span class="token number">999</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-http extra-class"><pre class="language-http"><code>GET /product/_search
{
  &quot;query&quot;: {
    &quot;constant_score&quot;: {
      &quot;filter&quot;: { 
        &quot;bool&quot;:{
          &quot;should&quot;:[
            {
              &quot;match_phrase&quot;: {
                &quot;name&quot;:&quot;xiaomi nfc phone&quot;
              }
            },
            {
              &quot;bool&quot;:{
                &quot;must&quot;:[
                  {&quot;term&quot;:{&quot;name&quot;:&quot;phone&quot;}},
                  {&quot;range&quot;:{&quot;price&quot;:{&quot;lte&quot;:&quot;2999&quot;}}}
                  ]
              }
            }
          ]
        }
      }
    }
  }
}
</code></pre></div><h3 id="_14-highlight-search高亮查询"><a href="#_14-highlight-search高亮查询" class="header-anchor">#</a> 14. Highlight search高亮查询</h3> <div class="language-http extra-class"><pre class="language-http"><code>GET /product/_search
{
    &quot;query&quot; : {
        &quot;match_phrase&quot; : {
            &quot;name&quot; : &quot;nfc phone&quot;
        }
    },
    &quot;highlight&quot;:{
      &quot;fields&quot;:{
         &quot;name&quot;:{}
      }
    }
}
</code></pre></div><h3 id="_15-deep-paging"><a href="#_15-deep-paging" class="header-anchor">#</a> 15. Deep paging</h3> <h3 id="_16-scroll-search"><a href="#_16-scroll-search" class="header-anchor">#</a> 16. Scroll search</h3> <h3 id="_17-filter缓存原理"><a href="#_17-filter缓存原理" class="header-anchor">#</a> 17. filter缓存原理</h3></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">12/25/2020, 7:02:25 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/tiankafei-docs-架构/zookeeper学习笔记.html" class="prev">
        zookeeper学习笔记
      </a></span> <span class="next"><a href="/tiankafei-docs-架构/Tomcat源码分析.html">
        Tomcat源码分析
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.a5877d94.js" defer></script><script src="/assets/js/2.01d54993.js" defer></script><script src="/assets/js/109.b51b5e28.js" defer></script>
  </body>
</html>
