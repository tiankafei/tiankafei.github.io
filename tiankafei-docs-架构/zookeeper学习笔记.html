<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>zookeeper学习笔记 | tiankafei - java相关技术栈</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="自己写的一些东西的记录，包括代码与笔记，jdk最低支持1.8">
    
    <link rel="preload" href="/assets/css/0.styles.992cb7aa.css" as="style"><link rel="preload" href="/assets/js/app.5ca7b408.js" as="script"><link rel="preload" href="/assets/js/2.70424c2b.js" as="script"><link rel="preload" href="/assets/js/110.1dd35753.js" as="script"><link rel="prefetch" href="/assets/js/10.58f35d33.js"><link rel="prefetch" href="/assets/js/100.aaabef70.js"><link rel="prefetch" href="/assets/js/101.d110e6fd.js"><link rel="prefetch" href="/assets/js/102.fe3d88fc.js"><link rel="prefetch" href="/assets/js/103.77a02446.js"><link rel="prefetch" href="/assets/js/104.59921985.js"><link rel="prefetch" href="/assets/js/105.d2287a20.js"><link rel="prefetch" href="/assets/js/106.eefcad45.js"><link rel="prefetch" href="/assets/js/107.1ac1aa13.js"><link rel="prefetch" href="/assets/js/108.8fb0134b.js"><link rel="prefetch" href="/assets/js/109.e07c0361.js"><link rel="prefetch" href="/assets/js/11.8b67ea4c.js"><link rel="prefetch" href="/assets/js/111.6f0cf8b8.js"><link rel="prefetch" href="/assets/js/112.7ec6a266.js"><link rel="prefetch" href="/assets/js/113.83e1aaed.js"><link rel="prefetch" href="/assets/js/12.e4797305.js"><link rel="prefetch" href="/assets/js/13.2d85b92c.js"><link rel="prefetch" href="/assets/js/14.2bc1fdb5.js"><link rel="prefetch" href="/assets/js/15.49ea1e69.js"><link rel="prefetch" href="/assets/js/16.9937b620.js"><link rel="prefetch" href="/assets/js/17.fc4b47cc.js"><link rel="prefetch" href="/assets/js/18.e71556ea.js"><link rel="prefetch" href="/assets/js/19.64c8d43a.js"><link rel="prefetch" href="/assets/js/20.94d72ec6.js"><link rel="prefetch" href="/assets/js/21.6e71044d.js"><link rel="prefetch" href="/assets/js/22.4dfd648a.js"><link rel="prefetch" href="/assets/js/23.2735fc15.js"><link rel="prefetch" href="/assets/js/24.96da47ed.js"><link rel="prefetch" href="/assets/js/25.d3a64953.js"><link rel="prefetch" href="/assets/js/26.49ae9931.js"><link rel="prefetch" href="/assets/js/27.ffe2ff7f.js"><link rel="prefetch" href="/assets/js/28.ceee6202.js"><link rel="prefetch" href="/assets/js/29.5b430924.js"><link rel="prefetch" href="/assets/js/3.7bf9e059.js"><link rel="prefetch" href="/assets/js/30.9c5198e3.js"><link rel="prefetch" href="/assets/js/31.44022a56.js"><link rel="prefetch" href="/assets/js/32.91854b18.js"><link rel="prefetch" href="/assets/js/33.2741799d.js"><link rel="prefetch" href="/assets/js/34.d61e93c3.js"><link rel="prefetch" href="/assets/js/35.d28b7f5d.js"><link rel="prefetch" href="/assets/js/36.b646bfa4.js"><link rel="prefetch" href="/assets/js/37.675752e5.js"><link rel="prefetch" href="/assets/js/38.b25fe369.js"><link rel="prefetch" href="/assets/js/39.4c13b5b3.js"><link rel="prefetch" href="/assets/js/4.09fd2c39.js"><link rel="prefetch" href="/assets/js/40.e43dd47b.js"><link rel="prefetch" href="/assets/js/41.8021272c.js"><link rel="prefetch" href="/assets/js/42.062a57df.js"><link rel="prefetch" href="/assets/js/43.b98eeccd.js"><link rel="prefetch" href="/assets/js/44.07744a1c.js"><link rel="prefetch" href="/assets/js/45.710abf0f.js"><link rel="prefetch" href="/assets/js/46.03d81f06.js"><link rel="prefetch" href="/assets/js/47.71d843a3.js"><link rel="prefetch" href="/assets/js/48.165ad08f.js"><link rel="prefetch" href="/assets/js/49.c3bdf6cb.js"><link rel="prefetch" href="/assets/js/5.fc791712.js"><link rel="prefetch" href="/assets/js/50.4cdf3914.js"><link rel="prefetch" href="/assets/js/51.23620db1.js"><link rel="prefetch" href="/assets/js/52.61bcfe7b.js"><link rel="prefetch" href="/assets/js/53.7d6c4853.js"><link rel="prefetch" href="/assets/js/54.266352df.js"><link rel="prefetch" href="/assets/js/55.9c7abe31.js"><link rel="prefetch" href="/assets/js/56.cc13690d.js"><link rel="prefetch" href="/assets/js/57.ad23abd1.js"><link rel="prefetch" href="/assets/js/58.b421ad53.js"><link rel="prefetch" href="/assets/js/59.3a5179aa.js"><link rel="prefetch" href="/assets/js/6.ffe6f60a.js"><link rel="prefetch" href="/assets/js/60.75a6e133.js"><link rel="prefetch" href="/assets/js/61.a4341911.js"><link rel="prefetch" href="/assets/js/62.374d536f.js"><link rel="prefetch" href="/assets/js/63.6278201d.js"><link rel="prefetch" href="/assets/js/64.9567f11c.js"><link rel="prefetch" href="/assets/js/65.454d03df.js"><link rel="prefetch" href="/assets/js/66.fc2f0954.js"><link rel="prefetch" href="/assets/js/67.4bc20938.js"><link rel="prefetch" href="/assets/js/68.5b3dc811.js"><link rel="prefetch" href="/assets/js/69.cda19dd0.js"><link rel="prefetch" href="/assets/js/7.7600938e.js"><link rel="prefetch" href="/assets/js/70.f5ec89b4.js"><link rel="prefetch" href="/assets/js/71.31443d6c.js"><link rel="prefetch" href="/assets/js/72.c6c65a50.js"><link rel="prefetch" href="/assets/js/73.b0be74f4.js"><link rel="prefetch" href="/assets/js/74.86829d8b.js"><link rel="prefetch" href="/assets/js/75.560d9836.js"><link rel="prefetch" href="/assets/js/76.11b202f3.js"><link rel="prefetch" href="/assets/js/77.a106d07d.js"><link rel="prefetch" href="/assets/js/78.74747269.js"><link rel="prefetch" href="/assets/js/79.09eb113b.js"><link rel="prefetch" href="/assets/js/8.c1a7f057.js"><link rel="prefetch" href="/assets/js/80.6f6ee5db.js"><link rel="prefetch" href="/assets/js/81.05905176.js"><link rel="prefetch" href="/assets/js/82.3a067ba4.js"><link rel="prefetch" href="/assets/js/83.7f6662e9.js"><link rel="prefetch" href="/assets/js/84.7cd30602.js"><link rel="prefetch" href="/assets/js/85.0e12ef40.js"><link rel="prefetch" href="/assets/js/86.b2ab3722.js"><link rel="prefetch" href="/assets/js/87.7936fab9.js"><link rel="prefetch" href="/assets/js/88.02402041.js"><link rel="prefetch" href="/assets/js/89.fa90b5e7.js"><link rel="prefetch" href="/assets/js/9.af38beaa.js"><link rel="prefetch" href="/assets/js/90.f325cb5b.js"><link rel="prefetch" href="/assets/js/91.2fa0cf51.js"><link rel="prefetch" href="/assets/js/92.b4927cb1.js"><link rel="prefetch" href="/assets/js/93.e4ac458f.js"><link rel="prefetch" href="/assets/js/94.2868b61f.js"><link rel="prefetch" href="/assets/js/95.84cc6dff.js"><link rel="prefetch" href="/assets/js/96.b0923900.js"><link rel="prefetch" href="/assets/js/97.11c5b43e.js"><link rel="prefetch" href="/assets/js/98.63f98279.js"><link rel="prefetch" href="/assets/js/99.be11a50b.js">
    <link rel="stylesheet" href="/assets/css/0.styles.992cb7aa.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">tiankafei - java相关技术栈</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/tiankafei-docs-java/Java基础.html" class="nav-link">
  Java
</a></div><div class="nav-item"><a href="/tiankafei-docs-spring/spring学习笔记/" class="nav-link">
  Spring
</a></div><div class="nav-item"><a href="/tiankafei-docs-架构/MySQL调优/" class="nav-link">
  架构
</a></div><div class="nav-item"><a href="/tiankafei-docs-大数据/centos7安装配置Hadoop/" class="nav-link">
  大数据
</a></div><div class="nav-item"><a href="/tiankafei-docs-linux/centos常用命令/" class="nav-link">
  Linux
</a></div><div class="nav-item"><a href="/tiankafei-docs-云/Centos7安装Docker并配置使用/" class="nav-link">
  云
</a></div><div class="nav-item"><a href="/tiankafei-docs-other/git上fork后再更新/" class="nav-link">
  其他
</a></div><div class="nav-item"><a href="/tiankafei-docs-en/词性语法学习/" class="nav-link">
  英语
</a></div><div class="nav-item"><a href="https://github.com/tiankafei/tiankafei" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/tiankafei-docs-java/Java基础.html" class="nav-link">
  Java
</a></div><div class="nav-item"><a href="/tiankafei-docs-spring/spring学习笔记/" class="nav-link">
  Spring
</a></div><div class="nav-item"><a href="/tiankafei-docs-架构/MySQL调优/" class="nav-link">
  架构
</a></div><div class="nav-item"><a href="/tiankafei-docs-大数据/centos7安装配置Hadoop/" class="nav-link">
  大数据
</a></div><div class="nav-item"><a href="/tiankafei-docs-linux/centos常用命令/" class="nav-link">
  Linux
</a></div><div class="nav-item"><a href="/tiankafei-docs-云/Centos7安装Docker并配置使用/" class="nav-link">
  云
</a></div><div class="nav-item"><a href="/tiankafei-docs-other/git上fork后再更新/" class="nav-link">
  其他
</a></div><div class="nav-item"><a href="/tiankafei-docs-en/词性语法学习/" class="nav-link">
  英语
</a></div><div class="nav-item"><a href="https://github.com/tiankafei/tiankafei" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>架构</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/tiankafei-docs-架构/MySQL调优.html" class="sidebar-link">MySQL调优</a></li><li><a href="/tiankafei-docs-架构/mysql主从复制安装配置.html" class="sidebar-link">mysql主从复制安装配置</a></li><li><a href="/tiankafei-docs-架构/使用amoeba实现mysql读写分离.html" class="sidebar-link">使用amoeba实现mysql读写分离</a></li><li><a href="/tiankafei-docs-架构/redis学习笔记.html" class="sidebar-link">redis介绍</a></li><li><a href="/tiankafei-docs-架构/zookeeper学习笔记.html" class="active sidebar-link">zookeeper学习笔记</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/tiankafei-docs-架构/zookeeper学习笔记.html#zookeeper-分布式协调服务" class="sidebar-link">Zookeeper：分布式协调服务</a></li><li class="sidebar-sub-header"><a href="/tiankafei-docs-架构/zookeeper学习笔记.html#官方网站" class="sidebar-link">官方网站</a></li><li class="sidebar-sub-header"><a href="/tiankafei-docs-架构/zookeeper学习笔记.html#下载地址" class="sidebar-link">下载地址</a></li><li class="sidebar-sub-header"><a href="/tiankafei-docs-架构/zookeeper学习笔记.html#文档地址" class="sidebar-link">文档地址</a></li><li class="sidebar-sub-header"><a href="/tiankafei-docs-架构/zookeeper学习笔记.html#集群特征" class="sidebar-link">集群特征</a></li><li class="sidebar-sub-header"><a href="/tiankafei-docs-架构/zookeeper学习笔记.html#性能测试" class="sidebar-link">性能测试</a></li><li class="sidebar-sub-header"><a href="/tiankafei-docs-架构/zookeeper学习笔记.html#数据结构" class="sidebar-link">数据结构</a></li><li class="sidebar-sub-header"><a href="/tiankafei-docs-架构/zookeeper学习笔记.html#优势" class="sidebar-link">优势</a></li><li class="sidebar-sub-header"><a href="/tiankafei-docs-架构/zookeeper学习笔记.html#配置文件属性描述" class="sidebar-link">配置文件属性描述</a></li><li class="sidebar-sub-header"><a href="/tiankafei-docs-架构/zookeeper学习笔记.html#主节点选举流程" class="sidebar-link">主节点选举流程</a></li><li class="sidebar-sub-header"><a href="/tiankafei-docs-架构/zookeeper学习笔记.html#数据时二进制安全的" class="sidebar-link">数据时二进制安全的</a></li><li class="sidebar-sub-header"><a href="/tiankafei-docs-架构/zookeeper学习笔记.html#全局事务id" class="sidebar-link">全局事务id</a></li><li class="sidebar-sub-header"><a href="/tiankafei-docs-架构/zookeeper学习笔记.html#原语api支持" class="sidebar-link">原语api支持</a></li></ul></li><li><a href="/tiankafei-docs-架构/elasticsearch学习笔记.html" class="sidebar-link">Elasticsearch学习笔记</a></li><li><a href="/tiankafei-docs-架构/Tomcat源码分析.html" class="sidebar-link">Tomcat源码分析</a></li><li><a href="/tiankafei-docs-架构/Netty源码分析.html" class="sidebar-link">Netty源码分析</a></li><li><a href="/tiankafei-docs-架构/分布式事务.html" class="sidebar-link">事务</a></li><li><a href="/tiankafei-docs-架构/分布式锁.html" class="sidebar-link">分布式三把锁</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="zookeeper学习笔记"><a href="#zookeeper学习笔记" class="header-anchor">#</a> zookeeper学习笔记</h1> <h2 id="zookeeper-分布式协调服务"><a href="#zookeeper-分布式协调服务" class="header-anchor">#</a> Zookeeper：分布式协调服务</h2> <ol><li>配置管理（1M的数据）</li> <li>分布式同步（临时节点）
<ul><li>分布式锁（设置一个临时节点，不能是序列节点）；</li> <li>锁依托一个父节点，且具备 -s ，说明这个父节点可以有多把锁，后面的锁盯着前面的锁（带队列或者事务模式的锁）</li> <li>集群管理，HA高可用选择主节点</li> <li>分布式ID生成器</li></ul></li> <li>分组管理（path结构，父子节点）</li> <li>命名（序列节点）</li></ol> <h2 id="官方网站"><a href="#官方网站" class="header-anchor">#</a> 官方网站</h2> <div class="language-http extra-class"><pre class="language-http"><code><span class="token header-name keyword">https:</span>//zookeeper.apache.org/
</code></pre></div><h2 id="下载地址"><a href="#下载地址" class="header-anchor">#</a> 下载地址</h2> <div class="language-http extra-class"><pre class="language-http"><code><span class="token header-name keyword">https:</span>//zookeeper.apache.org/releases.html
</code></pre></div><h2 id="文档地址"><a href="#文档地址" class="header-anchor">#</a> 文档地址</h2> <div class="language-http extra-class"><pre class="language-http"><code><span class="token header-name keyword">https:</span>//zookeeper.apache.org/doc/r3.6.2/zookeeperOver.html
</code></pre></div><h2 id="集群特征"><a href="#集群特征" class="header-anchor">#</a> 集群特征</h2> <p>zookeeper实现非常注重高性能、高可用性、严格有序的访问。可以在大型分布式系统中使用，可靠性使其不会成为单点故障，严格有序意味着可以在客户端实现复杂的同步原语。</p> <p>zookeeper可以当作集群使用，很少会使用单实例。集群的两种方式：1.主从复制集群，2.无主集群（redis cluster无主模型，且数据是分片的）；对于数据来说：1.数据同步集群（每个节点存储全量数据），2.数据分片集群。</p> <p>zookeeper是主从复制集群，每个节点的数据是完全一样的。写（增删改）只能发生在leader上，查可以发生在所有的节点上。主是单点，依然会存在单点的问题；</p> <p><img src="/images%5Czookeeper%E9%9B%86%E7%BE%A4.png" alt="zookeeper集群"></p> <h2 id="性能测试"><a href="#性能测试" class="header-anchor">#</a> 性能测试</h2> <p>ZooKeeper吞吐量，随读/写比的变化而定。在读取数量超过写入次数的应用程序中，由于写入涉及同步所有服务器的状态，因此该性能特别高。（对于协调服务来说，读取次数多于写入次数）。ZooKeeper应用程序可在数千台计算机上运行，并且在读取比写入更常见的情况下，其性能最佳，比率约为10：1。</p> <p><img src="/images%5CZooKeeper%E5%90%9E%E5%90%90%E9%87%8F-%E9%9A%8F%E8%AF%BB-%E5%86%99%E6%AF%94%E7%9A%84%E5%8F%98%E5%8C%96%E8%80%8C%E5%AE%9A.jpg" alt="ZooKeeper吞吐量-随读-写比的变化而定"></p> <p>横轴：读取所占的比例，纵轴：每秒的查询量。当全是读取的时候，就算是3个节点的集群也能喉住80000+的请求数量。</p> <p>存在错误时的可靠性表明部署如何响应各种故障。图中标记的事件如下：</p> <ol><li>追随者的失败和恢复</li> <li>失败和其他追随者的恢复</li> <li>领导者的失败</li> <li>两个追随者的失败和恢复</li> <li>另一个领导者的失败</li></ol> <p><img src="/images%5Czookeeper%E5%AD%98%E5%9C%A8%E9%94%99%E8%AF%AF%E6%97%B6%E7%9A%84%E5%8F%AF%E9%9D%A0%E6%80%A7.jpg" alt="zookeeper存在错误时的可靠性"></p> <ol><li>追随者失败并迅速恢复，则ZooKeeper能够在失败的情况下维持高吞吐量。</li> <li>领导者选举算法允许 leader 恢复得足够快，ZooKeeper只需不到200毫秒即可选出新的领导者。</li> <li>随着追随者的恢复，ZooKeeper能够在开始处理请求后再次提高吞吐量。</li></ol> <h2 id="数据结构"><a href="#数据结构" class="header-anchor">#</a> 数据结构</h2> <p>Zookeeper 的数据结构类似于文件系统，不同的是 zookeeper 的每个节点都可以存储少量的数据，最大支持存储1M的数据。zookeeper数据保存在内存中，可以实现高吞吐量和低延迟数量。</p> <p><img src="/images%5Czookeeper%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84.jpg" alt="zookeeper数据结构"></p> <ul><li>目录树结构
<ul><li>持久节点（PERSISTENT）：节点创建后，一直存在，直到主动删除了该节点。</li> <li>临时节点（EPHEMERAL）：生命周期和客户端会话绑定，一旦客户端会话失效，这个节点就会自动删除。</li> <li>序列节点（SEQUENTIAL）：多个线程创建同一个顺序节点时候，每个线程会得到一个带有编号的节点，节点编号是递增不重复的</li></ul></li></ul> <h2 id="优势"><a href="#优势" class="header-anchor">#</a> 优势</h2> <p>ZooKeeper非常快速且非常简单。但是，由于其目标是作为构建更复杂的服务（例如同步）的基础，因此它提供了一组保证。这些是：</p> <ul><li>顺序一致性：来自客户端的更新将按照发送的顺序应用（写请求由主节点进行）</li> <li>原子性：更新成功或失败，没有部分结果（过半成功，并同步节点和数据）</li> <li>单个系统映像：无论客户端连接到哪个服务器，客户端都将看到相同的服务视图（主从复制模型决定的）</li> <li>可靠性：应用更新后，此更新将一直持续到客户端覆盖更新为止（持久性）</li> <li>及时性：确保系统的客户视图在特定时间范围内是最新的（最终一致性，过半）</li></ul> <h2 id="配置文件属性描述"><a href="#配置文件属性描述" class="header-anchor">#</a> 配置文件属性描述</h2> <ol><li><p>tickTime：默认2000，单位ms，主从之间心跳的时间间隔</p></li> <li><p>initLimit：默认10次，从节点和主节点建立连接的时候，主节点允许 initLimit * tickTime 的时间延迟</p></li> <li><p>syncLimit：默认5次，主节点下发同步任务时，从节点如果在 syncLimit * tickTime 的时间内没有返回的时候，就认为有问题</p></li> <li><p>dataDir：数据持久化存储路径</p></li> <li><p>clientPort：默认2181，客户端连接服务端的端口</p></li> <li><p>maxClientCnxnx：最大客户端连接数，默认60</p></li> <li><p>集群配置：过半数：行数/2+1</p> <ul><li>server.1=node01:2888:3888</li> <li>server.2=node02:2888:3888</li> <li>server.3=node03:2888:3888</li> <li>server.4=node04:2888:3888</li></ul> <p>2888端口的作用：当是leader的时候，开启的和从节点建立通信的端口，用于数据同步。</p> <p>3888端口的作用：当无主的时候，通过这个端口建立连接，进行投票，选择一个leader，让这个leader开启一个2888的端口，其他节点连接这个leader的2888的端口进行通信</p></li> <li><p>启动zookeeper之前，准备myid，并配置环境变量；具体安装过程参考【大数据中的安全过程】</p> <p>echo 1 &gt; dataDir/myid</p> <p>echo 2 &gt; dataDir/myid</p> <p>echo 3 &gt; dataDir/myid</p> <p>echo 4 &gt; dataDir/myid</p></li></ol> <h2 id="主节点选举流程"><a href="#主节点选举流程" class="header-anchor">#</a> 主节点选举流程</h2> <blockquote><p>第一次启动：按照启动顺序，当达到过半数时，server.n中n最大的那台机器就是leader。后面再启动其他节点时，即使有server.n比当前leader的n大，也只能追随当前leader节点。</p> <p>运行一段时间时候，再启动时leader的选择逻辑时，先看哪些节点的数据最完整（看事务id的最大值进行比较），如果都比较完整，再看server.n中n的最大值，是leader。</p></blockquote> <p><img src="/images%5Czookeeper%E5%BB%BA%E7%AB%8B%E8%BF%9E%E6%8E%A5%E7%9A%84%E8%BF%87%E7%A8%8B.png" alt="zookeeper建立连接的过程"></p> <h2 id="数据时二进制安全的"><a href="#数据时二进制安全的" class="header-anchor">#</a> 数据时二进制安全的</h2> <p>外面的客户端给我推送什么样的字节数据，我原封不动的给你存进来，你那边的编解码器我不关心</p> <h2 id="全局事务id"><a href="#全局事务id" class="header-anchor">#</a> 全局事务id</h2> <blockquote><p>zookeeper是顺序执行的，体现在这个id身上的，所有的这种增删改这种写操作，他们都会递交给leader，因为leader是单机，所以单机维护一个单调递增的计数器很容器。</p></blockquote> <ol><li>事务id：一个64位的字节；0x代表16进制，16进制的每一位代表4个2进制位，那么两位代表一个字节(8位)，低32位是事务递增序列，高32位表示的是第几代leader。每次leader更新换代，后面的事务id从0开始重新计算。</li> <li>cZxid：创建节点的事务id</li> <li>mZxid：修改节点的事务id</li> <li>pZxid：当前节点创建的最后那一个的节点的事务id</li> <li>ephemeralOwner：没有归属谁，则说明不是临时节点；有值说明是临时节点，归属一个sessionID</li> <li>客户端连接服务端之后，客户端挂了sessionID就没了，那么临时节点就会被删除掉</li> <li>客户端连接服务端之后，服务端挂了，那么临时节点是否会丢失？
<ul><li>不会丢失</li> <li>因为zookeeper统一了视图（单个系统影像），连sessionID都会被同步到所有的集群节点里</li> <li>一个新的客户端连接进来，会消耗一个事务id，说明client的sessionID会写给所有节点</li> <li>客户端断开连接时，会走一个删除的逻辑，要进行统一视图，所有节点都会删，会再次消耗一个事务id</li></ul></li></ol> <h2 id="原语api支持"><a href="#原语api支持" class="header-anchor">#</a> 原语api支持</h2> <ul><li><em>create</em> : 在树中的某个位置创建一个节点
<ul><li>-e 表示创建的是一个临时节点</li> <li>-s 多个线程创建同一个顺序节点时，每个线程会得到一个带有编号的节点，节点编号是递增不重复的（不会覆盖创建，分布式情况下统一命名）</li></ul></li> <li><em>delete</em> : 删除节点</li> <li><em>exists</em> : 测试某个节点是否存在于某个位置</li> <li><em>get data</em> : 从节点读取数据</li> <li><em>set data</em> : 将数据写入节点</li> <li><em>get children</em> : 检索节点的子节点列表</li> <li><em>sync</em> : 等待数据传播</li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">11/28/2020, 7:45:47 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/tiankafei-docs-架构/redis学习笔记.html" class="prev">
        redis介绍
      </a></span> <span class="next"><a href="/tiankafei-docs-架构/elasticsearch学习笔记.html">
        Elasticsearch学习笔记
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.5ca7b408.js" defer></script><script src="/assets/js/2.70424c2b.js" defer></script><script src="/assets/js/110.1dd35753.js" defer></script>
  </body>
</html>
